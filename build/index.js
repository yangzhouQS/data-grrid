/*!
 * 
 *   @hodgef/ts-library-boilerplate-basic v1.0.155
 *
 *   Copyright (c)  and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MyLibrary=e():t.MyLibrary=e()}(self,(function(){return(()=>{"use strict";var t={748:(t,e,o)=>{function n(t){return Math.sqrt(t[0]**2+t[1]**2)}function r(t,e){let o=1;return t[0]*e[1]-t[1]*e[0]<0&&(o=-1),o*Math.acos((r=function(t,e){return function(t,e){return t[0]*e[0]+t[1]*e[1]}(t,e)/(n(t)*n(e))}(t,e),s=-1,i=1,Math.min(Math.max(r,s),i)));var r,s,i}function s(t,e,o,n,s,i,l,c,a,h){if(0===n||0===s)return void t.lineTo(a,e);i*=Math.PI/180,n=Math.abs(n),s=Math.abs(s);const u=function(t,e){const o=Math.cos(e),n=Math.sin(e);return[o*t[0]+n*t[1],-1*n*t[0]+o*t[1]]}([((d=[e,o])[0]-(g=[a,h])[0])/2,(d[1]-g[1])/2],i);var d,g;const f=function(t,e){return[t[0]*e[0],t[1]*e[1]]}(u,u);let p=n**2,C=s**2;const _=Math.sqrt(f[0]/p+f[1]/C);_>1&&(p=(n*=_)**2,C=(s*=_)**2);let w=Math.sqrt(Math.abs(p*C-p*f[1]-C*f[0])/(p*f[1]+C*f[0]));l===c&&(w*=-1);const m=function(t,e){return[t*e[0],t*e[1]]}(w,[n*u[1]/s,-s*u[0]/n]),y=function(t,e){return[t[0]+e[0],t[1]+e[1]]}(function(t,e){const o=Math.cos(e),n=Math.sin(e);return[o*t[0]-n*t[1],n*t[0]+o*t[1]]}(m,i),function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}([e,o],[a,h])),b=[(u[0]-m[0])/n,(u[1]-m[1])/s],x=[(-1*u[0]-m[0])/n,(-1*u[1]-m[1])/s],v=r([1,0],b),E=v,I=v+r(b,x);t.save(),t.translate(y[0],y[1]),t.rotate(i),t.scale(n,s),t.arc(0,0,1,E,I,!c),t.restore()}o.d(e,{w:()=>a});class i{M;m;L;l;H;h;V;v;Z;z;C;c;S;s;Q;q;T;t;A;a;constructor(t){let e,o,n,r=0,i=0,l="";function c(){return"CcSsQqTt".indexOf(l)<0?{x:r,y:i}:n}this.M=(n,s)=>(t.moveTo(n,s),e=n,o=s,r=n,i=s,l="M",this),this.m=(t,e)=>this.M(t+r,e+i),this.L=(e,o)=>(t.lineTo(e,o),r=e,i=o,l="L",this),this.l=(t,e)=>this.L(t+r,e+i),this.H=t=>this.L(t,i),this.h=t=>this.H(t+r),this.V=t=>this.L(r,t),this.v=t=>this.V(t+i),this.Z=()=>(t.closePath(),r=e,i=o,l="Z",this),this.z=()=>this.Z(),this.C=(e,o,s,c,a,h)=>(t.bezierCurveTo(e,o,s,c,a,h),r=a,i=h,n={x:2*a-s,y:2*h-c},l="C",this),this.c=(t,e,o,n,s,l)=>this.C(t+r,e+i,o+r,n+i,s+r,l+i),this.S=(t,e,o,n)=>{const{x:r,y:s}=c();return this.C(r,s,t,e,o,n)},this.s=(t,e,o,n)=>this.S(t+r,e+i,o+r,n+i),this.Q=(e,o,s,c)=>(t.quadraticCurveTo(e,o,s,c),r=s,i=c,n={x:2*s-e,y:2*c-o},l="Q",this),this.q=(t,e,o,n)=>this.Q(t+r,e+i,o+r,n+i),this.T=(t,e)=>{const{x:o,y:n}=c();return this.Q(o,n,t,e)},this.t=(t,e)=>this.T(t+r,e+i),this.A=(e,o,n,c,a,h,u)=>(s(t,r,i,e,o,n,c,a,h,u),r=h,i=u,l="A",this),this.a=(t,e,o,n,s,l,c)=>this.A(t,e,o,n,s,l+r,c+i)}}function l(t,e,o){return"M"===e.toUpperCase()||"L"===e.toUpperCase()||"T"===e.toUpperCase()?(t.command(e,o.next(),o.next()),"M"===e?"L":"m"===e?"l":e):"H"===e.toUpperCase()||"V"===e.toUpperCase()?(t.command(e,o.next()),e):"Z"===e.toUpperCase()?(t.command(e),e):"C"===e.toUpperCase()?(t.command(e,o.next(),o.next(),o.next(),o.next(),o.next(),o.next()),e):"S"===e.toUpperCase()||"Q"===e.toUpperCase()?(t.command(e,o.next(),o.next(),o.next(),o.next()),e):"A"===e.toUpperCase()?(t.command(e,o.next(),o.next(),o.next(),o.next(),o.next(),o.next(),o.next()),e):(console.warn(`unsupported:${e}`),null)}const c=new class{moveTo;lineTo;closePath;bezierCurveTo;quadraticCurveTo;save;translate;rotate;scale;arc;restore;arcTo;ellipse;rect;_commands;_ops=[];constructor(){this._commands=new i(this);const t=t=>(...e)=>{this._ops.push({op:t,args:e})};this.moveTo=t("moveTo"),this.lineTo=t("lineTo"),this.closePath=t("closePath"),this.bezierCurveTo=t("bezierCurveTo"),this.quadraticCurveTo=t("quadraticCurveTo"),this.save=t("save"),this.translate=t("translate"),this.rotate=t("rotate"),this.scale=t("scale"),this.arc=t("arc"),this.restore=t("restore"),this.arcTo=t("arcTo"),this.ellipse=t("ellipse"),this.rect=t("rect")}command(t,...e){const o=e||[];for(let t=0;t<e.length;t++)o[t]-=0;this._commands[t].apply(this,o)}parse(t){const e=this._ops=[],o=function(t){let e=0;return{next(){let o="";for(;t.length>e;){const n=t[e];if(e++," ,\n\r\t".indexOf(n)>-1){if(o)return o}else{if("str"==(".+-1234567890".indexOf(n)>-1?"num":"str"))return o?(e--,o):n;if("-+".indexOf(n)>-1&&o)return e--,o;if("."===n&&o.indexOf(".")>-1)return e--,o;o+=n}}return o||null}}}(t);try{let t,e="Z";for(;t=o.next();)if(isNaN(Number(t)))e=l(this,t,o)||"Z";else{let n=!0;e=l(this,e,{next:()=>n?(n=!1,t):o.next()})||"Z"}}catch(e){throw console.log(`Error: ${t}`),e}return e}};class a{_ops;arc(...t){this._ops.push({op:"arc",args:t})}arcTo(...t){this._ops.push({op:"arcTo",args:t})}bezierCurveTo(...t){this._ops.push({op:"bezierCurveTo",args:t})}closePath(...t){this._ops.push({op:"closePath",args:t})}ellipse(...t){this._ops.push({op:"ellipse",args:t})}lineTo(...t){this._ops.push({op:"lineTo",args:t})}moveTo(...t){this._ops.push({op:"moveTo",args:t})}quadraticCurveTo(...t){this._ops.push({op:"quadraticCurveTo",args:t})}rect(...t){this._ops.push({op:"rect",args:t})}constructor(t){if(this._ops=[],void 0!==t)if("string"==typeof t)this._ops=c.parse(t);else{if(!t.hasOwnProperty("_ops"))throw new Error(`Error: ${typeof t} is not a valid argument to Path`);this._ops=[...t._ops]}}}const{CanvasRenderingContext2D:h}=window,u=h.prototype.fill;h.prototype.fill=function(...t){if(t[0]instanceof a){const e=t[0];this.beginPath(),e._ops.forEach((t=>{this[t.op].apply(this,t.args)})),u.apply(this,Array.prototype.slice.call(t,1))}else u.apply(this,t)}}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,o),s.exports}o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{o.r(n),o.d(n,{default:()=>Al});var t={};o.r(t),o.d(t,{BaseStyle:()=>Xt,ButtonStyle:()=>Jt,CheckStyle:()=>te,EVENT_TYPE:()=>he,IconStyle:()=>ee,ImageStyle:()=>oe,MenuStyle:()=>ne,MultilineTextStyle:()=>re,NumberStyle:()=>se,PercentCompleteBarStyle:()=>le,RadioStyle:()=>ae,Style:()=>Qt,of:()=>ue});var e={};o.r(e),o.d(e,{BranchGraphColumn:()=>Re,ButtonColumn:()=>Ne,CheckColumn:()=>He,Column:()=>Fe,IconColumn:()=>$e,ImageColumn:()=>Xe,MenuColumn:()=>Je,MultilineTextColumn:()=>to,NumberColumn:()=>oo,PercentCompleteBarColumn:()=>no,RadioColumn:()=>so,of:()=>lo});var r={};o.r(r),o.d(r,{ACTIONS:()=>ko,Action:()=>$,BaseAction:()=>P,ButtonAction:()=>Q,CheckEditor:()=>it,Editor:()=>J,InlineInputEditor:()=>It,InlineMenuEditor:()=>fo,RadioEditor:()=>wo,SmallDialogInputEditor:()=>Ao,of:()=>Do});var s={};o.r(s),o.d(s,{canvasHelper:()=>Cr,drawButton:()=>pr,drawCheckbox:()=>gr,drawInlineImageRect:()=>hr,drawRadioButton:()=>fr,fillCircle:()=>lr,fillRoundRect:()=>sr,fillTextRect:()=>ar,measureCheckbox:()=>ur,measureRadioButton:()=>dr,roundRect:()=>rr,strokeCircle:()=>cr,strokeColorsRect:()=>nr,strokeRoundRect:()=>ir});const i="undefined"==typeof window||void 0===window.window;let l,c;const a={get find(){return l||(l=Array.prototype.find?(t,e)=>Array.prototype.find.call(t,e):(t,e)=>{const o=a.findIndex(t,e);return o>=0?t[o]:void 0},l)},get findIndex(){return c||(c=Array.prototype.findIndex?(t,e)=>Array.prototype.findIndex.call(t,e):(t,e)=>{const{length:o}=t;for(let n=0;n<o;n++){if(e(t[n],n,t))return n}return-1},c)}};const{IE:h,Chrome:u,Firefox:d,Edge:g,Safari:f}=function(){if(i)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};{const t=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(t),Edge:t.indexOf("edge")>-1,Chrome:t.indexOf("chrome")>-1&&-1===t.indexOf("edge"),Firefox:t.indexOf("firefox")>-1,Safari:t.indexOf("safari")>-1&&-1===t.indexOf("edge")}}}();function p(t,e){for(const o in t)e(t[o],o,t)}function C(t,e){const o=[],n={};for(const r in t)o.push(r),Object.defineProperty(n,r,{get(){const o=t[r];return void 0===o?e[r]:o},set(e){t[r]=e},configurable:!0,enumerable:!0});for(const r in e)o.indexOf(r)>=0||Object.defineProperty(n,r,{get(){const o=t[r];return void 0===o?e[r]:o},set(e){t[r]=e},configurable:!0,enumerable:!0});return n}function _(...t){const e={};return t.forEach((t=>{for(const o in t)Object.defineProperty(e,o,{get:()=>t[o],set(e){t[o]=e},configurable:!0,enumerable:!0})})),e}function w(t,e){for(;e.parentElement;){const o=e.parentElement;if(t===o)return!0;e=o}return!1}function m(t,e,...o){let n=t;for(let t=0;t<o.length&&null!=n;t++)n=e(n,o[t]);return n}function y(t,...e){return m(t,((t,e)=>t[e]),...e)}function b(t,...e){return"function"==typeof t?t(...e):t}function x(t){return Boolean(t&&"function"==typeof t.then)}function v(t,e){return x(t)?t.then((t=>e(t))):e(t)}function E(t,e){return t.col===e.col&&t.row===e.row}function I(t,e,o){return t.start.col<=e&&e<=t.end.col&&t.start.row<=o&&o<=t.end.row}const L=h,R=g,B=u?33554431:d?17895588:10737433,M={setReadonly:function(t,e,o){Object.defineProperty(t,e,{enumerable:!1,configurable:!0,value:o})},isObject:function(t){return t===Object(t)}},S={endsWith:function(t,e,o){const n=t.toString();("number"!=typeof o||!isFinite(o)||Math.floor(o)!==o||o>n.length)&&(o=n.length),o-=e.length;const r=n.lastIndexOf(e,o);return-1!==r&&r===o},genChars:function(t){const e=/([\uD800-\uDBFF][\uDC00-\uDFFF]|\r\n|[^\uD800-\uDFFF])([\u180B-\u180D]|[\uFE00-\uFE0F]|\uDB40[\uDD00-\uDDEF])?/g;return{next(){const o=e.exec(t);return null!==o?o[0]:null}}},genWords:function(t){const e=/[!-~]+|[^!-~\s]+|\s+/g;return{next(){const o=e.exec(t);return null!==o?o[0]:null}}}},T={getMouseButtons:function(t){return null!=t.buttons?t.buttons:null!=t.which?3===t.which||2===t.which?4:t.which:0===t.button||1===t.button?1:2===t.button?2:0},getKeyCode:function(t){return t.keyCode||t.which},isTouchEvent:function(t){return!!t.changedTouches},cancel:function(t){t.preventDefault(),t.stopPropagation()}},A={toBoxArray:function(t){return Array.isArray(t)?3===t.length?[t[0],t[1],t[2],t[1]]:2===t.length?[t[0],t[1],t[0],t[1]]:1===t.length?[t[0],t[0],t[0],t[0]]:t:[t,t,t,t]}},k=Function.prototype,D={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",DBLTAP_CELL:"dbltap_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",KEYDOWN:"keydown",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",MOUSEOVER_CELL:"mouseover_cell",MOUSEOUT_CELL:"mouseout_cell",CONTEXTMENU_CELL:"contextmenu_cell",INPUT_CELL:"input_cell",PASTE_CELL:"paste_cell",DELETE_CELL:"delete_cell",EDITABLEINPUT_CELL:"editableinput_cell",MODIFY_STATUS_EDITABLEINPUT_CELL:"modify_status_editableinput_cell",RESIZE_COLUMN:"resize_column",SCROLL:"scroll",FOCUS_GRID:"focus_grid",BLUR_GRID:"blur_grid"};function O(t,e,{action:o,mouseOver:n,mouseOut:r}){function s(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(D.CLICK_CELL,(e=>{s(e.col,e.row)&&(x(t.getRowRecord(e.row))||o({col:e.col,row:e.row}))})),t.listen(D.MOUSEOVER_CELL,(e=>{s(e.col,e.row)&&(x(t.getRowRecord(e.row))||n&&!n({col:e.col,row:e.row})||(t.getElement().style.cursor="pointer"))})),t.listen(D.MOUSEOUT_CELL,(e=>{s(e.col,e.row)&&(r&&r({col:e.col,row:e.row}),t.getElement().style.cursor="")}))]}function F(t,e,{action:o,acceptKeys:n=[]}){return n=[...n,13,32],[t.listen(D.KEYDOWN,(r=>{if(-1===n.indexOf(r.keyCode))return;if(t.keyboardOptions?.moveCellOnEnter&&13===r.keyCode)return;const s=t.selection.select;var i,l;(i=s.col,l=s.row,t.getLayoutCellId(i,l)===e)&&(x(t.getRowRecord(s.row))||(o({col:s.col,row:s.row}),T.cancel(r.event)))}))]}class P{_disabled;constructor(t={}){this._disabled=t.disabled||!1}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.onChangeDisabledInternal()}onChangeDisabledInternal(){}}function N(t,e,o){return!!e.disabled||H(t,e,o)}function W(t,e,o){return!!e.readOnly||H(t,e,o)}function z(t){if("number"==typeof t)return 0===t?1:0;if("string"==typeof t){if("false"===t)return"true";if("off"===t)return"on";if(/^0+$/.exec(t))return t.replace(/^(0*)0$/,"$11");if("true"===t)return"false";if("on"===t)return"off";if(/^0*1$/.exec(t))return t.replace(/^(0*)1$/,"$10")}return!t}function H(t,e,o){if("function"==typeof t){const n=e.getRowRecord(o);return!!x(n)||!!t(n)}return!!t}class $ extends P{_action;constructor(t={}){super(t),this._action=t.action||(()=>{})}get editable(){return!1}get action(){return this._action}set action(t){this._action=t}clone(){return new $(this)}getState(t){return{}}bindGridEvent(t,e){const o=this.getState(t),n=e=>{if(N(this.disabled,t,e.row))return;const o=t.getRowRecord(e.row);this._action(o,_(e,{grid:t}))};return[...O(t,e,{action:n,mouseOver:e=>{if(N(this.disabled,t,e.row))return!1;o.mouseActiveCell={col:e.col,row:e.row};const n=t.getCellRange(e.col,e.row);return t.invalidateCellRange(n),!0},mouseOut:e=>{delete o.mouseActiveCell;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),...F(t,e,{action:n})]}onPasteCellRangeBox(){}onDeleteCellRangeBox(){}}const j=i?o.g.Symbol:window.Symbol?window.Symbol:(()=>{function t(){const t="abcdefghijklmnopqrstuvwxyz0123456789",e=t.length;let o="";for(let n=0;n<10;n++)o+=t[Math.floor(Math.random()*e)];return o}return e=>e?`#${e}_${t()}`:`#_${t()}`})(),V={};function U(t){return t?V[t]?V[t]:V[t]=j(t):j()}function G(){return U("protected")}function K(){return U("chkcol.stateID")}function Y(){return U("rdcol.stateID")}function Z(){return U("btncol.stateID")}function X(){return U("check_header.stateID")}const q=Z();class Q extends ${getState(t){let e=t[q];return e||(e={},M.setReadonly(t,q,e)),e}}class J extends P{_readOnly;constructor(t={}){super(t),this._readOnly=t.readOnly||!1}get editable(){return!0}get readOnly(){return this._readOnly}set readOnly(t){this._readOnly=t,this.onChangeReadOnlyInternal()}onChangeReadOnlyInternal(){}}function tt(t,e,o,n){let r;return t*=3,e*=3,o*=3,n*=3,function(s){let i,l,c,a,h,u,d;if(s<0||1<s)throw new Error(`${s}`);i=r||s;do{l=1-i,c=l*l,a=i*i,h=a*i,u=t*c*i+o*l*a+h,d=s-u,i+=.5*d}while(1e-4<Math.abs(d));return r=i,e*c*i+n*l*a+h}}const et={linear:t=>t,easeIn:tt(.42,0,1,1),easeOut:tt(0,0,.58,1),easeInOut:tt(.42,0,.58,1)},ot=i?()=>{}:window.requestAnimationFrame||(t=>setTimeout(t,1));function nt(){return Date.now()}function rt(t,e,o){const n=nt(),r=null==o?et.easeInOut:"string"==typeof o?et[o]:o;let s=!1;const i=(o,i)=>{const l=()=>{const c=nt()-n;s?i&&i():c>=t?(e(1),o&&o()):(e(r(c/t)),ot(l))};return l},l=()=>{s=!0};if("undefined"!=typeof Promise){const t=new Promise(((t,o)=>{const n=i(t,o);e(0),n()}));return t.cancel=l,t}{const t=i((()=>{}),(()=>{}));return e(0),t(),{cancel:l}}}const st=K();class it extends J{clone(){return new it(this)}bindGridEvent(t,e){let o=t[st];o||(o={block:{},elapsed:{}},M.setReadonly(t,st,o));const n=o,r=e=>{const o=t.getCellRange(e.col,e.row),r=`${o.start.col}:${o.start.row}`;if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||n.block[r])return;const s=t.doChangeValue(e.col,e.row,z);if(s){const e=()=>{rt(200,(e=>{1===e?delete n.elapsed[r]:n.elapsed[r]=e,t.invalidateCellRange(o)}))};x(s)?(n.block[r]=!0,s.then((()=>{delete n.block[r],e()}))):e()}};function s(o,n){return t.getLayoutCellId(o,n)===e}return[...O(t,e,{action:r,mouseOver:e=>{if(N(this.disabled,t,e.row))return!1;n.mouseActiveCell={col:e.col,row:e.row};const o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:e=>{delete n.mouseActiveCell;const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)}}),...F(t,e,{action:e=>{const o=t.selection.range,{col:n}=t.selection.select;for(let{row:t}=o.start;t<=o.end.row;t++)s(n,t)&&r({col:n,row:t})}}),t.listen(D.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;if(!E(o.start,o.end))return;if(!s(e.col,e.row))return;const n=e.normalizeValue.trim();t.doGetCellValue(e.col,e.row,(t=>{`${z(t)}`.trim()===n&&(T.cancel(e.event),r({col:e.col,row:e.row}))}))}))]}onPasteCellRangeBox(t,e,o){if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row))return;const n=o.trim();t.doGetCellValue(e.col,e.row,(o=>{`${z(o)}`.trim()===n&&t.doChangeValue(e.col,e.row,z)}))}onDeleteCellRangeBox(){}}class lt extends J{constructor(t={}){super(t)}bindGridEvent(t,e){const o=e=>!W(this.readOnly,t,e.row)&&!N(this.disabled,t,e.row)&&(this.onOpenCellInternal(t,e),!0),n=(e,o)=>{W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||this.onInputCellInternal(t,e,o)};function r(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(D.INPUT_CELL,(t=>{r(t.col,t.row)&&n({col:t.col,row:t.row},t.value)})),t.listen(D.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;E(o.start,o.end)&&r(e.col,e.row)&&(T.cancel(e.event),n({col:e.col,row:e.row},e.normalizeValue))})),t.listen(D.DBLCLICK_CELL,(t=>{r(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(D.DBLTAP_CELL,(t=>{r(t.col,t.row)&&(o({col:t.col,row:t.row}),T.cancel(t.event))})),t.listen(D.KEYDOWN,(e=>{if(113!==e.keyCode&&13!==e.keyCode)return;const n=t.selection.select;r(n.col,n.row)&&o({col:n.col,row:n.row})&&e.stopCellMoving()})),t.listen(D.SELECTED_CELL,(e=>{this.onChangeSelectCellInternal(t,{col:e.col,row:e.row},e.selected)})),t.listen(D.SCROLL,(()=>{this.onGridScrollInternal(t)})),t.listen(D.EDITABLEINPUT_CELL,(e=>!!r(e.col,e.row)&&(!W(this.readOnly,t,e.row)&&!N(this.disabled,t,e.row)))),t.listen(D.MODIFY_STATUS_EDITABLEINPUT_CELL,(e=>{if(!r(e.col,e.row))return;if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row))return;const o=t.getCellRange(e.col,e.row);if(o.start.col!==o.end.col||o.start.row!==o.end.row){const{input:n}=e,r=t.getCellRect(e.col,e.row),s=t.getCellRangeRect(o);n.style.top=`${(parseFloat(n.style.top)+(s.top-r.top)).toFixed()}px`,n.style.left=`${(parseFloat(n.style.left)+(s.left-r.left)).toFixed()}px`,n.style.width=`${s.width.toFixed()}px`,n.style.height=`${s.height.toFixed()}px`}this.onSetInputAttrsInternal(t,{col:e.col,row:e.row},e.input)}))]}onPasteCellRangeBox(t,e,o){W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(()=>o))}onDeleteCellRangeBox(t,e){W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||t.doChangeValue(e.col,e.row,(()=>""))}}let ct=1;class at{_listeners={};on(t,e,o,...n){t.addEventListener&&t.addEventListener(e,o,...n);const r={target:t,type:e,listener:o,options:n},s=ct++;return this._listeners[s]=r,s}once(t,e,o,...n){const r=this.on(t,e,((...t)=>{this.off(r),o(...t)}),...n);return r}tryWithOffEvents(t,e,o){const n=[];try{p(this._listeners,(o=>{o.target===t&&o.type===e&&(o.target.removeEventListener&&o.target.removeEventListener(o.type,o.listener,...o.options),n.push(o))})),o()}finally{n.forEach((t=>{t.target.addEventListener&&t.target.addEventListener(t.type,t.listener,...t.options)}))}}off(t){if(null==t)return;const e=this._listeners[t];e&&(delete this._listeners[t],e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options))}fire(t,e,...o){p(this._listeners,(n=>{n.target===t&&n.type===e&&n.listener.call(n.target,...o)}))}hasListener(t,e){let o=!1;return p(this._listeners,(n=>{n.target===t&&n.type===e&&(o=!0)})),o}clear(){p(this._listeners,(t=>{t.target.removeEventListener&&t.target.removeEventListener(t.type,t.listener,...t.options)})),this._listeners={}}dispose(){this.clear(),this._listeners=null}}function ht(t,{classList:e,text:o,html:n}={}){const r=document.createElement(t);return e&&(Array.isArray(e)?r.classList.add(...e):r.classList.add(e)),o?r.textContent=o:n&&(r.innerHTML=n),r}function ut(t){if(Array.isArray(t)){const e=[];return t.forEach((t=>{e.push(...ut(t))})),e}const e=function(t){if(function(t){return!(!t.nodeType||!t.nodeName)}(t))return t;const e=ht("div",{html:t});return Array.prototype.slice.call(e.childNodes)}(t);return Array.isArray(e)?e:[e]}function dt(t){t.dataset.disableBeforeTabIndex=`${t.tabIndex}`,t.tabIndex=-1,Array.prototype.slice.call(t.children,0).forEach(dt)}function gt(t){return null!=t.tabIndex&&t.tabIndex>-1}function ft(t){let e=t.previousSibling;for(;e&&!gt(e);)e=e.previousSibling;return e}function pt(t){let e=t.nextSibling;for(;e&&!gt(e);)e=e.nextSibling;return e}function Ct(t,e){if("number"===t.type&&"-"===e){t.type="";let e=new at;const o=()=>{e&&(e.dispose(),e=null)};e.once(t,"input",(e=>{t.type="number",o()})),e.once(t,"blur",(t=>{o()}))}t.value=e??""}function _t(t,e,o){const{classList:n,type:r}=t;n&&o.classList.add(...n),o.type=r||""}class wt{_handler;_input;_beforePropEditor;_activeData;_attaching;static setInputAttrs(t,e,o){_t(t,0,o)}constructor(){this._handler=new at,this._input=ht("input",{classList:"cheetah-grid__inline-input"}),this._bindInputEvents()}dispose(){const t=this._input;this.detach(),this._handler.dispose(),delete this._input,this._beforePropEditor=null,t.parentElement?.removeChild(t)}attach(t,e,o,n,r){const s=this._input,i=this._handler;if(this._beforePropEditor){const{classList:t}=this._beforePropEditor;t&&s.classList.remove(...t)}s.style.font=t.font||"16px sans-serif";const{element:l,rect:c}=t.getAttachCellsArea(t.getCellRange(o,n));s.style.top=`${c.top.toFixed()}px`,s.style.left=`${c.left.toFixed()}px`,s.style.width=`${c.width.toFixed()}px`,s.style.height=`${c.height.toFixed()}px`,l.appendChild(s),_t(e,0,s),Ct(s,r),this._activeData={grid:t,col:o,row:n,editor:e},this._beforePropEditor=e;i.tryWithOffEvents(s,"blur",(()=>{(()=>{s.focus();const t=s.value.length;try{if(void 0!==s.selectionStart)return s.selectionStart=t,void(s.selectionEnd=t)}catch(t){}if(document.selection){const e=s.createTextRange();e.collapse(),e.moveEnd("character",t),e.moveStart("character",t),e.select()}})()})),this._attaching=!0,setTimeout((()=>{delete this._attaching}))}detach(t){if(this._isActive()){const{grid:e,col:o,row:n}=this._activeData,r=this._input;this._handler.tryWithOffEvents(r,"blur",(()=>{r.parentElement?.removeChild(r)}));const s=e.getCellRange(o,n);e.invalidateCellRange(s),t&&e.focus()}this._activeData=null}doChangeValue(){if(!this._isActive())return;const t=this._input,{value:e}=t,{grid:o,col:n,row:r}=this._activeData;o.doChangeValue(n,r,(()=>e))}_isActive(){const t=this._input;return!(!t||!t.parentElement)&&!!this._activeData}_bindInputEvents(){const t=this._handler,e=this._input,o=t=>t.stopPropagation();t.on(e,"click",o),t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"compositionstart",(t=>{e.classList.add("composition")})),t.on(e,"compositionend",(t=>{e.classList.remove("composition")})),t.on(e,"keydown",(t=>{if(e.classList.contains("composition"))return;const o=T.getKeyCode(t);13===o?this._onKeydownEnter(t):9===o&&this._onKeydownTab(t)})),t.on(e,"blur",(t=>{this.doChangeValue(),this.detach()}))}_onKeydownEnter(t){if(!this._isActive()||this._attaching)return;const{grid:e}=this._activeData;this.doChangeValue(),this.detach(!0),T.cancel(t),e.keyboardOptions?.moveCellOnEnter&&e.onKeyDownMove(t)}_onKeydownTab(t){if(!this._isActive())return;const{grid:e}=this._activeData;e.keyboardOptions?.moveCellOnTab&&(this.doChangeValue(),this.detach(!0),e.onKeyDownMove(t))}}const mt=U("inline_input_editor.stateID");let yt=null,bt=0;function xt(t,e,o,n){const r=function(t){let e=t[mt];return e||(e={},M.setReadonly(t,mt,e)),e}(t);yt||(yt=new wt),r.element||(r.element=yt,bt++,t.addDisposable({dispose(){bt--,bt||(yt?.dispose(),yt=null,r.element=null)}})),yt.attach(t,o,e.col,e.row,n)}function vt(t){yt&&yt.detach(t)}function Et(t){yt&&yt.doChangeValue()}class It extends lt{_classList;_type;constructor(t={}){super(t),this._classList=t.classList,this._type=t.type}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get type(){return this._type}set type(t){this._type=t}clone(){return new It(this)}onInputCellInternal(t,e,o){xt(t,e,this,o)}onOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{xt(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){Et(),vt()}onGridScrollInternal(t){Et(),vt(!0)}onChangeDisabledInternal(){vt(!0)}onChangeReadOnlyInternal(){vt(!0)}onSetInputAttrsInternal(t,e,o){wt.setInputAttrs(this,t,o)}}const Lt="cheetah-grid__inline-menu",Rt="cheetah-grid__inline-menu__menu-item",Bt="cheetah-grid__inline-menu--hidden",Mt="cheetah-grid__inline-menu--shown",St=`${Rt}--empty`;function Tt(t){let e=t;for(;e&&!e.classList.contains(Rt);)if(e=e.parentElement,!e||e.classList.contains(Lt))return null;return e}function At(t,e,o){o.style.top=`${e.top.toFixed()}px`,o.style.left=`${e.left.toFixed()}px`,o.style.width=`${e.width.toFixed()}px`,o.style.lineHeight=`${e.height.toFixed()}px`,t.appendChild(o)}function kt({classList:t,label:e,value:o,html:n},r){const s=ht("li",{classList:Rt});if(s.tabIndex=0,s.dataset.valueindex=`${r}`,t&&s.classList.add(...Array.isArray(t)?t:[t]),e){const t=ht("span",{text:e});s.appendChild(t)}else n&&(i=s,ut(n).forEach((t=>{i.appendChild(t)})));var i;return""!==o&&null!=o||s.classList.add(St),s}class Dt{_handler;_menu;_beforePropEditor;_activeData;constructor(){this._handler=new at,this._menu=ht("ul",{classList:Lt}),this._bindMenuEvents()}dispose(){const t=this._menu;this.detach(),this._handler.dispose(),delete this._menu,this._beforePropEditor=null,t.parentElement?.removeChild(t)}attach(t,e,o,n,r,s){const i=this._menu;if(this._beforePropEditor){const{classList:t}=this._beforePropEditor;t&&i.classList.remove(...t)}const l=e.options(s);!function(t,e,o,n,r,s,i){const{classList:l}=e;i.classList.remove(Mt),i.classList.add(Bt),function(t){let e;for(;e=t.firstChild;)t.removeChild(e)}(i),i.style.font=t.font||"16px sans-serif";let c=null,a=null;s.forEach(((t,e)=>{const o=kt(t,e);i.appendChild(o),t.value===r&&(a=o,o.dataset.select="select"),o.classList.contains(St)&&(c=o)}));const h=a||c||i.children[0];l&&i.classList.add(...l);const u=Array.prototype.slice.call(i.children,0),d=u.indexOf(h),{element:g,rect:f}=t.getAttachCellsArea(t.getCellRange(o,n));f.width++,At(g,f,i);let p=0,C=0;for(let t=0;t<u.length;t++){const{offsetHeight:e}=u[t];t<d&&(p+=e),C+=e}f.offsetTop(-p),i.style.transformOrigin=`center ${p+Math.ceil(u[d].offsetHeight/2)}px 0px`,At(g,f,i);const _=i.getBoundingClientRect(),w=(C-_.height)/2,m=_.top-w;let y=m;const b=y+C,x=window.innerHeight;b>x-20&&(y-=b-x+20);y<20&&(y=20),y!==m&&(f.offsetTop(-(m-y)),At(g,f,i)),h&&h.focus(),i.classList.remove(Bt),i.classList.add(Mt)}(t,e,o,n,r,l,i),this._activeData={grid:t,col:o,row:n,editor:e,options:l},this._beforePropEditor=e}detach(t){if(this._isActive()){const{grid:e,col:o,row:n}=this._activeData;!function(t,e,o,n){n.classList.remove(Mt),n.classList.add(Bt),dt(n)}(0,0,0,this._menu);const r=e.getCellRange(o,n);e.invalidateCellRange(r),t&&e.focus()}this._activeData=null}_doChangeValue(t){if(!this._isActive())return;const{grid:e,col:o,row:n,options:r}=this._activeData,s=r[Number(t)];if(s){const{value:t}=s;e.doChangeValue(o,n,(()=>t))}}_isActive(){const t=this._menu;return!(!t||!t.parentElement)&&!!this._activeData}_bindMenuEvents(){const t=this._handler,e=this._menu,o=t=>t.stopPropagation();t.on(e,"mousedown",o),t.on(e,"touchstart",o),t.on(e,"dblclick",o),t.on(e,"click",(t=>{t.stopPropagation();const e=Tt(t.target);if(!e)return;const{valueindex:o}=e.dataset;this._doChangeValue(o||""),this.detach(!0)})),t.on(e,"keydown",(t=>{const o=Tt(t.target);if(!o)return;const n=T.getKeyCode(t);if(13===n)this._onKeydownEnter(e,o,t);else if(27===n)this.detach(!0),T.cancel(t);else if(38===n){const e=ft(o);e&&(e.focus(),T.cancel(t))}else if(40===n){const e=pt(o);e&&(e.focus(),T.cancel(t))}else 9===n&&this._onKeydownTab(e,o,t)}))}_onKeydownEnter(t,e,o){const n=this._isActive()?this._activeData.grid:null,{valueindex:r}=e.dataset;this._doChangeValue(r||""),this.detach(!0),T.cancel(o),n&&n.keyboardOptions?.moveCellOnEnter&&n.onKeyDownMove(o)}_onKeydownTab(t,e,o){if(this._isActive()){const{grid:t}=this._activeData;if(t.keyboardOptions?.moveCellOnTab){const{valueindex:n}=e.dataset;return this._doChangeValue(n||""),this.detach(!0),void t.onKeyDownMove(o)}}if(o.shiftKey){if(!ft(e)){const e=t.querySelectorAll(`.${Rt}`);let n=e[e.length-1];gt(n)||(n=ft(n)),n&&(n.focus(),T.cancel(o))}}else if(!pt(e)){let e=t.querySelector(`.${Rt}`);gt(e)||(e=pt(e)),e&&(e.focus(),T.cancel(o))}}}const Ot=U();let Ft=1;class Pt{[Ot]={listeners:{},listenerData:{}};listen(t,e){const o=this[Ot].listeners[t]||(this[Ot].listeners[t]=[]);o.push(e);const n=Ft++;return this[Ot].listenerData[n]={type:t,listener:e,remove:()=>{delete this[Ot].listenerData[n];const r=o.indexOf(e);o.splice(r,1),this[Ot].listeners[t].length||delete this[Ot].listeners[t]}},n}unlisten(t){this[Ot]&&this[Ot].listenerData[t].remove()}addEventListener(t,e){this.listen(t,e)}removeEventListener(t,e){this[Ot]&&p(this[Ot].listenerData,((o,n)=>{o.type===t&&o.listener===e&&this.unlisten(n)}))}hasListeners(t){return!!this[Ot]&&!!this[Ot].listeners[t]}fireListeners(t,...e){if(!this[Ot])return[];const o=this[Ot].listeners[t];return o?o.map((t=>t.call(this,...e))).filter((t=>null!=t)):[]}dispose(){delete this[Ot]}}const Nt={CHANGE_STYLE:"change_style"};let Wt,zt,Ht,$t,jt,Vt,Ut,Gt,Kt,Yt,Zt;class Xt extends Pt{_bgColor;static get EVENT_TYPE(){return Nt}static get DEFAULT(){return Wt||(Wt=new Xt)}constructor({bgColor:t}={}){super(),this._bgColor=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this.doChangeStyle()}doChangeStyle(){this.fireListeners(Nt.CHANGE_STYLE)}clone(){return new Xt(this)}}class qt extends Xt{_textAlign;_textBaseline;static get DEFAULT(){return zt||(zt=new qt)}constructor(t={}){super(t),this._textAlign=t.textAlign||"left",this._textBaseline=t.textBaseline||"middle"}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t,this.doChangeStyle()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.doChangeStyle()}clone(){return new qt(this)}}class Qt extends qt{_color;_font;_padding;_textOverflow;static get DEFAULT(){return Ht||(Ht=new Qt)}constructor(t={}){super(t),this._color=t.color,this._font=t.font,this._padding=t.padding,this._textOverflow=t.textOverflow||"clip"}get color(){return this._color}set color(t){this._color=t,this.doChangeStyle()}get font(){return this._font}set font(t){this._font=t,this.doChangeStyle()}get padding(){return this._padding}set padding(t){this._padding=t,this.doChangeStyle()}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t,this.doChangeStyle()}clone(){return new Qt(this)}}class Jt extends Qt{_buttonBgColor;static get DEFAULT(){return $t||($t=new Jt)}constructor(t={}){super(C(t,{textAlign:"center"}));const{buttonBgColor:e}=t;this._buttonBgColor=e}get buttonBgColor(){return this._buttonBgColor}set buttonBgColor(t){this._buttonBgColor=t,this.doChangeStyle()}clone(){return new Jt(this)}}class te extends qt{_uncheckBgColor;_checkBgColor;_borderColor;static get DEFAULT(){return jt||(jt=new te)}constructor(t={}){super(C(t,{textAlign:"center"}));const{uncheckBgColor:e,checkBgColor:o,borderColor:n}=t;this._uncheckBgColor=e,this._checkBgColor=o,this._borderColor=n}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.doChangeStyle()}clone(){return new te(this)}}class ee extends Qt{static get DEFAULT(){return Vt||(Vt=new ee)}constructor(t={}){super(C(t,{textAlign:"center"}))}clone(){return new ee(this)}}class oe extends qt{_imageSizing;_margin;static get DEFAULT(){return Ut||(Ut=new oe)}constructor(t={}){super(C(t,{textAlign:"center"})),this._imageSizing=t.imageSizing,this._margin=t.margin||4}get imageSizing(){return this._imageSizing}set imageSizing(t){this._imageSizing=t,this.doChangeStyle()}get margin(){return this._margin}set margin(t){this._margin=t,this.doChangeStyle()}clone(){return new oe(this)}}class ne extends Qt{_appearance;static get DEFAULT(){return Gt||(Gt=new ne)}constructor(t={}){super(t);const{appearance:e}=t;this._appearance=e}get appearance(){return this._appearance||"menulist-button"}set appearance(t){this._appearance=t,this.doChangeStyle()}clone(){return new ne(this)}}class re extends Qt{_lineHeight;_autoWrapText;_lineClamp;static get DEFAULT(){return Kt||(Kt=new re)}constructor(t={}){super(C(t,{textBaseline:"top"})),this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp}clone(){return new re(this)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}}class se extends Qt{static get DEFAULT(){return Yt||(Yt=new se)}constructor(t={}){super(C(t,{textAlign:"right"}))}clone(){return new se(this)}}const ie=t=>t>80?"#20a8d8":t>50?"#4dbd74":t>20?"#ffc107":"#f86c6b";class le extends Qt{_barColor;_barBgColor;_barHeight;static get DEFAULT(){return Zt||(Zt=new le)}constructor(t={}){super(t),this._barColor=t.barColor||ie,this._barBgColor=t.barBgColor||"#f0f3f5",this._barHeight=t.barHeight||3}get barColor(){return this._barColor}set barColor(t){this._barColor=t,this.doChangeStyle()}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t,this.doChangeStyle()}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t,this.doChangeStyle()}clone(){return new le(this)}}let ce;class ae extends qt{_checkColor;_uncheckBorderColor;_checkBorderColor;_uncheckBgColor;_checkBgColor;static get DEFAULT(){return ce||(ce=new ae)}constructor(t={}){super(C(t,{textAlign:"center"}));const{checkColor:e,uncheckBorderColor:o,checkBorderColor:n,uncheckBgColor:r,checkBgColor:s}=t;this._checkColor=e,this._uncheckBorderColor=o,this._checkBorderColor=n,this._uncheckBgColor=r,this._checkBgColor=s}get checkColor(){return this._checkColor}set checkColor(t){this._checkColor=t,this.doChangeStyle()}get uncheckBorderColor(){return this._uncheckBorderColor}set uncheckBorderColor(t){this._uncheckBorderColor=t,this.doChangeStyle()}get checkBorderColor(){return this._checkBorderColor}set checkBorderColor(t){this._checkBorderColor=t,this.doChangeStyle()}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}clone(){return new ae(this)}}const{EVENT_TYPE:he}=Xt;function ue(t,e,o=Qt){return t?t instanceof Xt?t:"function"==typeof t?ue(t(e),e,o):e&&t in e?ue(e[t],e,o):new o(t):o.DEFAULT}const{setReadonly:de}=M,ge=U("col.fadein_stateID");function fe(t){let e=t[ge];return e||(e={cells:{}},de(t,ge,e)),e}function pe(t,e,o,n,r,s){return i=>{const l=fe(t),c=`${o}:${e}`;1===i?delete l.cells[c]:l.cells[c]={opacity:i},s(),r();const a=l.cells[c];if(a){const t=n.getContext();t.globalAlpha=1-a.opacity;try{s()}finally{t.globalAlpha=1}}}}const Ce={animate(t,e,o,n,r,s){const i=fe(t),l=[pe(t,e,o,n,r,s)];i.activeFadeins=l,rt(500,(t=>{l.forEach((e=>e(t))),1===t&&delete i.activeFadeins}))},margeAnimate(t,e,o,n,r,s){const i=fe(t);i.activeFadeins?i.activeFadeins.push(pe(t,e,o,n,r,s)):r()}};class _e{_fadeinWhenCallbackInPromise;constructor(t){this.onDrawCell=this.onDrawCell.bind(this),this._fadeinWhenCallbackInPromise=t?.fadeinWhenCallbackInPromise}get fadeinWhenCallbackInPromise(){return this._fadeinWhenCallbackInPromise}get StyleClass(){return Xt}onDrawCell(t,e,o,n){const{style:r,getRecord:s,drawCellBase:i}=e,l=n.getGridCanvasHelper();i();const c=s();let a;if(x(c))a=c;else if(x(t))a=t;else{const t=e.getMessage();x(t)&&(a=t)}if(a){const s=Date.now();return Promise.all([c,t,a.then((()=>t)).then((()=>e.getMessage()))]).then((({0:t,1:c,2:a})=>{if(!o.toCurrentContext().getDrawRect())return;const h=Date.now()-s,u=()=>{const s=o.toCurrentContext();if(!s.getDrawRect())return;const i=ue(r,t,this.StyleClass);this.drawInternal(this.convertInternal(c),s,i,l,n,e),this.drawMessageInternal(a,s,i,l,n,e)};if(function(t,e){return null!=t.fadeinWhenCallbackInPromise?t.fadeinWhenCallbackInPromise:!!e.configure("fadeinWhenCallbackInPromise")}(this,n)){const{col:t,row:e}=o;h<80?Ce.margeAnimate(n,t,e,o,u,i):Ce.animate(n,t,e,o,u,i)}else u()}))}{const s=ue(r,c,this.StyleClass);this.drawInternal(this.convertInternal(t),o,s,l,n,e),this.drawMessageInternal(e.getMessage(),o,s,l,n,e);const{col:a,row:h}=o,u=`${a}:${h}`,d=n[ge]?.cells[u];if(d){const t=o.getContext();t.globalAlpha=1-d.opacity;try{i()}finally{t.globalAlpha=1}}return}}convertInternal(t){return null!=t?t:""}drawMessageInternal(t,e,o,n,r,s){s.messageHandler.drawCellMessage(t,e,o,n,r,s)}bindGridEvent(t,e){return[]}getCopyCellValue(t,e,o){return t}}let we;const me=(t,e)=>{switch(e%3){case 0:return"#979797";case 1:return"#008fb5";case 2:return"#f1c109"}return"#979797"};class ye extends Xt{_branchColors;_margin;_circleSize;_branchLineWidth;_mergeStyle;static get DEFAULT(){return we||(we=new ye)}constructor(t={}){super(t),this._branchColors=t.branchColors||me,this._margin=t.margin||4,this._circleSize=t.circleSize||16,this._branchLineWidth=t.branchLineWidth||4,this._mergeStyle="straight"===t.mergeStyle?"straight":"bezier"}get branchColors(){return this._branchColors}set branchColors(t){this._branchColors=t,this.doChangeStyle()}get margin(){return this._margin}set margin(t){this._margin=t,this.doChangeStyle()}get circleSize(){return this._circleSize}set circleSize(t){this._circleSize=t,this.doChangeStyle()}get branchLineWidth(){return this._branchLineWidth}set branchLineWidth(t){this._branchLineWidth=t,this.doChangeStyle()}get mergeStyle(){return this._mergeStyle}set mergeStyle(t){this._mergeStyle=t,this.doChangeStyle()}clone(){return new ye(this)}}const be=U("branch_graph_col.stateID");class xe{fromIndex;toIndex;colorIndex;point;constructor({fromIndex:t,toIndex:e,colorIndex:o,point:n}){this.fromIndex=t,this.toIndex=e,this.colorIndex=o,this.point=n}}class ve{index;commit;lines;tag;constructor({index:t,commit:e=!1,lines:o=[],tag:n}){this.index=t,this.commit=e,this.lines=o,this.tag=n}static mergeLines(t){const e=t.filter((t=>null!=t.fromIndex&&null!=t.toIndex)),o=t.filter((t=>null!=t.fromIndex&&null==t.toIndex)),n=t.filter((t=>null==t.fromIndex&&null!=t.toIndex));return o.forEach((t=>{for(let e=0;e<n.length;e++){const o=n[e];if(!o.point&&t.colorIndex===o.colorIndex){t.toIndex=o.toIndex,n.splice(e,1);break}}e.push(t)})),e.concat(n)}static merge(t,e){return t?new ve({index:t.index,commit:t.commit||e.commit,lines:ve.mergeLines(t.lines.concat(e.lines)),tag:t.tag||e.tag}):e}}function Ee(t,e){const o=[...t].reverse();for(let t=0;t<o.length;t++){const n=o[t][e];if(n){n.lines=ve.mergeLines(n.lines.concat([new xe({toIndex:e,colorIndex:e})]));for(let n=0;n<t;n++){o[n][e]=new ve({index:e,lines:[new xe({fromIndex:e,toIndex:e,colorIndex:e})]})}return!0}}return!1}function Ie(t,e){const{timeline:o}=t,n=[];(Array.isArray(e)?e:[e]).forEach((e=>{if(!e)return;let o;if("branch"===e.command){const n=M.isObject(e.branch)?e.branch.from:null,r=M.isObject(e.branch)?e.branch.to:e.branch;o=function({timeline:t,branches:e},o,n){const r=null!=o?e.indexOf(o):-1;let s=e.indexOf(n);if(s<0&&(s=e.length,e.push(n)),r<0)return new ve({index:s});{const e=function(){for(let e=t.length-1;e>=0;e--){const o=t[e][r];if(o&&o.commit)return e}return-1}();if(-1===e)return null;const o=e+1,n=new ve({index:s,lines:[new xe({fromIndex:r,colorIndex:s})]});let i,l=null;if(o<t.length){const e=t[o];i=e[s]=ve.merge(e[s],n)}else i=n,l=n;const c=t[e][r];return c.lines=ve.mergeLines(c.lines.concat([new xe({toIndex:s,colorIndex:s,point:i})])),l}}(t,n,r)}else if("commit"===e.command){const{branch:n}=e;o=function({timeline:t,branches:e},o){const n=e.indexOf(o);if(n<0)return null;const r=new ve({index:n,commit:!0});return Ee(t,n)&&(r.lines=ve.mergeLines(r.lines.concat([new xe({fromIndex:n,colorIndex:n})]))),r}(t,n)}else if("merge"===e.command){const{from:n,to:r}=e.branch;o=function({timeline:t,branches:e},o,n){const r=e.indexOf(o),s=e.indexOf(n);if(s<0||r<0)return new ve({index:s,commit:!0});const i=new ve({index:s,commit:!0,lines:[new xe({fromIndex:r,colorIndex:r}),new xe({fromIndex:s,colorIndex:s})]}),l=[...t],c=l.pop();return c&&(c[r]=ve.merge(c[r],new ve({index:s,lines:[new xe({toIndex:s,colorIndex:r})]}))),Ee(l,r)&&c&&(c[r].lines=ve.mergeLines(c[r].lines.concat([new xe({fromIndex:r,colorIndex:r})]))),Ee(t,s),i}(t,n,r)}else if("tag"===e.command){const{branch:n,tag:r}=e;o=function({branches:t},e,o){let n=t.indexOf(e);return n<0&&(n=t.length,t.push(e)),new ve({index:n,tag:o})}(t,n,r)}o&&o.index>-1&&(n[o.index]=ve.merge(n[o.index],o))})),o.push(n)}function Le(t,e,o){const n={branches:[],timeline:[]};return function(t,e,o){const{dataSource:n}=t,r=[];let s;for(let t=0;t<n.length;t++){const o=n.getField(t,e);if(x(o)){const t=r.length;r.push(void 0),s=s?s.then((()=>o)).then((e=>{r[t]=e})):o.then((e=>{r[t]=e}))}else r.push(o)}s?s.then((()=>o(r))):o(r)}(e,o,(e=>{"top"!==t&&(e=[...e].reverse()),e.forEach((t=>{Ie(n,t)}))})),n}class Re extends _e{_start;_cache;constructor(t={}){super(t),this._start=t.start||"bottom",this._cache=null!=t.cache&&t.cache}get StyleClass(){return ye}clearCache(t){delete t[be]}onDrawCell(t,e,o,n){if(this._cache){const t=n[be]||(n[be]=new Map),{col:e,row:r}=o,s=n.getField(e,r);t.has(s)||t.set(s,Le(this._start,n,s))}return super.onDrawCell(t,e,o,n)}clone(){return new Re(this)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{col:i,row:l}=e,c=r.getField(i,l),{timeline:a,branches:h}=(this._cache?r[be]?.get(c):null)??Le(this._start,r,c),{upLineIndexKey:u,downLineIndexKey:d}="top"!==this._start?{upLineIndexKey:"toIndex",downLineIndexKey:"fromIndex"}:{upLineIndexKey:"fromIndex",downLineIndexKey:"toIndex"},g="top"!==this._start?a[a.length-(l-r.frozenRowCount)-1]:a[l-r.frozenRowCount],{branchColors:f,branchLineWidth:p,circleSize:C,mergeStyle:_,margin:w,bgColor:m}=o;m&&s({bgColor:m});const y=e.getRect(),x=C/2,v=y.width-2*w;n.drawWithClip(e,(t=>{t.textAlign="left",t.textBaseline="middle";const e=function(t,e,o,n,r,s){let i=Math.max(o/r.length+1,5);s.forEach((e=>{e.forEach(((e,r)=>{if(!(r<=0)&&e.tag){const s=t.measureText(e.tag).width;i*r+2*n+4+s>o&&(i=Math.max((o-2*n-4-s)/r,5))}}))}));const l=[];let c=e;return r.forEach((()=>{l.push(Math.ceil(c+n)),c+=i})),l}(t,y.left+w,v,x,h,a),o=y.top+y.height/2;g.map(((t,e)=>t?t.lines.map((t=>({colorIndex:t.colorIndex,upLineIndex:t[u],downLineIndex:t[d],pointIndex:e}))):[])).reduce(((t,e)=>t.concat(e)),[]).sort(((t,e)=>e.colorIndex-t.colorIndex)).forEach((n=>{const s=e[n.pointIndex];!function(t,e,o,n,r,s,i,{branchXPoints:l,branchColors:c,branchLineWidth:a,mergeStyle:h},{col:u,row:d,branches:g}){if(null!=r||null!=s){if(e.strokeStyle=b(c,g[i],i),e.lineWidth=a,e.lineCap="round",e.beginPath(),null!=r){const s=l[r],i=t.getCellRelativeRect(u,d-1),c=i.top+i.height/2;e.moveTo(s,c),"bezier"===h?e.bezierCurveTo(s,(n+c)/2,o,(n+c)/2,o,n):e.lineTo(o,n)}else e.moveTo(o,n);if(null!=s){const r=l[s],i=t.getCellRelativeRect(u,d+1),c=i.top+i.height/2;"bezier"===h?e.bezierCurveTo(o,(n+c)/2,r,(n+c)/2,r,c):e.lineTo(r,c)}e.stroke()}}(r,t,s,o,n.upLineIndex,n.downLineIndex,n.colorIndex,{margin:w,branchXPoints:e,branchLineWidth:p,branchColors:f,mergeStyle:_},{width:v,col:i,row:l,branches:h})})),g.forEach(((n,r)=>{if(n&&n.commit){const n=e[r];t.fillStyle=b(f,h[r],r),t.beginPath(),t.arc(n,o,x,0,2*Math.PI,!0),t.fill(),t.closePath()}})),g.forEach(((n,r)=>{n&&n.tag&&(t.fillStyle=b(f,h[r],r),t.fillText(n.tag,e[r]+x+4,o))}))}))}}const Be=["content","font","color","className","tagName","isLiga","width","src","svg","name","path"];const Me={},Se={};function Te(t){if(!t)return t;if(Array.isArray(t))return t;const e={};let o=0;Be.forEach((e=>{const n=t[e];n&&(o=Array.isArray(n)?Math.max(o,n.length):Math.max(o,1))})),Be.forEach((n=>{const r=function(t,e){const o=[];if(Array.isArray(t)){o.push(...t);for(let n=t.length;n<e;n++)o.push(null)}else for(let n=0;n<e;n++)o.push(t);return o}(t[n],o);e[n]=r}));const n=[];for(let t=0;t<o;t++){const o={};Be.forEach((n=>{const r=e[n][t];o[n]=r})),n.push(o)}return n}function Ae(t){const e={};for(const o in t)"className"!==o&&De(o)&&(e[o]=t[o]);if(t.className){const o=function(t,e){const o=Se[t]||(Se[t]={});if(o[e])return o[e];const n=Me[t]||(Me[t]=document.createElement(t));n.className=e,document.body.appendChild(n);try{const t=(document.defaultView||window).getComputedStyle(n,"::before");let r=t.getPropertyValue("content");r.length>=3&&('"'===r[0]||"'"===r[0])&&r[0]===r[r.length-1]&&(r=r.substr(1,r.length-2));let s=t.getPropertyValue("font");s||(s=`${t.getPropertyValue("font-style")} ${t.getPropertyValue("font-variant")} ${t.getPropertyValue("font-weight")} ${t.getPropertyValue("font-size")}/${t.getPropertyValue("line-height")} ${function(t){const e=[],o=t.split(/,\s*/);for(let t=0;t<o.length;t++){const n=o[t].replace(/['"]/g,"");-1!==n.indexOf(" ")||/^\d/.test(n)?e.push(`'${n}'`):e.push(n)}return e.join(",")}(t.getPropertyValue("font-family"))}`);const i=t.getPropertyValue("color"),l=n.clientWidth,c=(t.getPropertyValue("font-feature-settings")||"").indexOf("liga")>-1;return o[e]={content:r,font:s,color:i,width:l,isLiga:c}}finally{document.body.removeChild(n)}}(t.tagName||"i",t.className);for(const n in o)De(n)&&null==t[n]&&(e[n]=o[n])}return e}const ke=Be;function De(t){return Be.indexOf(t)>=0}function Oe(t,e,o,n){let r;if(t)if(x(t))t.then((t=>{Oe(t,e.toCurrentContext(),o,n)}));else{const n=function(t){const e=Te(t);return e?e.map((t=>Ae(t))):e}(t);n.forEach((t=>{t.font&&t.content&&o.testFontLoad(t.font,t.content,e)})),r=n}n(r,e)}class Fe extends _e{get StyleClass(){return Qt}clone(){return new Fe(this)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,color:a,font:h,bgColor:u,padding:d,textOverflow:g}=o;u&&s({bgColor:u}),n.testFontLoad(h,t,e),Oe(i(),e,n,((e,o)=>{n.text(t,o,{textAlign:l,textBaseline:c,color:a,font:h,padding:d,textOverflow:g,icons:e})}))}}const Pe=Z();class Ne extends Fe{_caption;constructor(t={}){super(t),this._caption=t.caption}get StyleClass(){return Jt}get caption(){return this._caption}withCaption(t){const e=this.clone();return e._caption=t,e}clone(){return new Ne(this)}convertInternal(t){return this._caption||super.convertInternal(t)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,bgColor:a,color:h,buttonBgColor:u,font:d,padding:g,textOverflow:f}=o;a&&s({bgColor:a}),n.testFontLoad(d,t,e);const{col:p,row:C}=e,_=r.getCellRange(p,C);let w=!1;const m=r[Pe];if(m)if(m.mouseActiveCell&&I(_,m.mouseActiveCell.col,m.mouseActiveCell.row))w=!0;else{const{select:t}=e.getSelection();I(_,t.col,t.row)&&(w=!0)}Oe(i(),e,n,((e,o)=>{n.button(t,o,{textAlign:l,textBaseline:c,bgColor:u,color:h,font:d,padding:g,shadow:w?{color:"rgba(0, 0, 0, 0.48)",blur:6,offsetY:3}:{},textOverflow:f,icons:e})}))}}function We(t){if("string"==typeof t){if("false"===t)return!1;if("off"===t)return!1;if(/^0+$/.exec(t))return!1}return Boolean(t)}const ze=K();class He extends _e{get StyleClass(){return te}clone(){return new He(this)}convertInternal(t){return We(t)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,borderColor:c,checkBgColor:a,uncheckBgColor:h,bgColor:u}=o;u&&s({bgColor:u});const{col:d,row:g}=e,f=r.getCellRange(d,g),p=`${f.start.col}:${f.start.row}`,C=r[ze]?.elapsed[p],_={textAlign:i,textBaseline:l,borderColor:c,checkBgColor:a,uncheckBgColor:h};null!=C&&(_.animElapsedTime=C),n.checkbox(t,e,_)}}class $e extends Fe{_tagName;_className;_content;_name;_iconWidth;constructor(t={}){super(t),this._tagName=t.tagName||"i",this._className=t.className,this._content=t.content,this._name=t.name,this._iconWidth=t.iconWidth}get StyleClass(){return ee}clone(){return new $e(this)}drawInternal(t,e,o,n,r,s){const i=Number(t);if(isNaN(i))s.getIcon=()=>null;else{const t={};ke.forEach((e=>{t[e]=o[e]})),t.className=this._className,t.tagName=this._tagName,this._content&&(t.content=this._content),t.name=this._name,this._iconWidth&&(t.width=this._iconWidth),s.getIcon=()=>function(t,e){e===1/0&&(e=0);const o=[];for(let n=0;n<e;n++)o.push(t);return o}(t,i)}super.drawInternal("",e,o,n,r,s)}}const je={};function Ve(t,e){const o=e||t.font;if(je[o])return je[o];const n=t.font;try{t.font=o;const e=t.measureText("あ").width;return je[o]={width:e,height:e}}finally{t.font=n}}function Ue(t,e,o,n,{offset:r=0,padding:{left:s=0,right:i=0,top:l=0,bottom:c=0}={}}={}){const a=t.textAlign||"left",h=t.textBaseline||"middle";t.textAlign=a,t.textBaseline=h;let u=e.left+r+s;"right"===a||"end"===a?u=e.right-o-r-i:"center"===a&&(u=e.left+(e.width-o+s-i)/2);let d=e.top+r+l;return"bottom"===h||"alphabetic"===h||"ideographic"===h?d=e.bottom-n-r-c:"middle"===h&&(d=e.top+(e.height-n+l-c)/2),{x:u,y:d}}class Ge{_list;_map;_cacheSize;constructor(t){this._list=[],this._map={},this._cacheSize=t||50}get(t){const e=this._map[t];if(e){const e=this._list,o=e.indexOf(t);e.splice(o,1),e.push(t)}return e}put(t,e){const o=this._list,n=this._map;if(n[t]){const e=o.indexOf(t);o.splice(e,1)}if(n[t]=e,o.push(t),o.length>this._cacheSize){delete n[o.shift()||""]}}}const Ke={};function Ye(t,e){return v(e,(e=>{const o=t.get(e);if(o)return o;const n=function(t){if("undefined"==typeof Promise)return console.error("Promise is not loaded. load Promise before this process."),{then(){return this}};const e=new Image,o=new Promise((t=>{e.onload=()=>{t(e)}}));return e.onerror=()=>{const e=t.length>200?`${t.substr(0,200)}...`:t;throw console.warn(`cannot load: ${e}`),new Error(`IMAGE LOAD ERROR: ${e}`)},e.src=t,o}(e).then((o=>(t.put(e,o),o)));return t.put(e,n),n}))}function Ze(t,e,o){return Ye(Ke[t]||(Ke[t]=new Ge(e)),o)}class Xe extends _e{get StyleClass(){return oe}onDrawCell(t,e,o,n){return super.onDrawCell(Ze("ImageColumn",50,t),e,o,n)}clone(){return new Xe(this)}drawInternal(t,e,o,n,r,{drawCellBase:s}){if(t){const{textAlign:r,textBaseline:i,margin:l,bgColor:c}=o;c&&s({bgColor:c}),n.drawWithClip(e,(n=>{n.textAlign=r,n.textBaseline=i;const s=e.getRect();if("keep-aspect-ratio"===o.imageSizing){const{width:e,height:o}=function(t,e,o,n){let r=t,s=e;return r>o&&(r=o,s=r*e/t),s>n&&(s=n,r=s*t/e),{width:r,height:s}}(t.width,t.height,s.width-2*l,s.height-2*l),r=Ue(n,s,e,o,{offset:l});n.drawImage(t,0,0,t.width,t.height,r.x,r.y,e,o)}else n.drawImage(t,0,0,t.width,t.height,s.left+l,s.top+l,s.width-2*l,s.height-2*l)}))}}}function qe(t){if(!t)return[];if(Array.isArray(t))return t.map((t=>function(t,e){const o={};for(const e in t)o[e]=t[e];for(const t in e)o[t]=e[t];return o}(t,{label:t.caption||t.label})));if("string"==typeof t)return qe(JSON.parse(t));const e=[];for(const o in t)e.push({value:o,label:t[o]});return e}function Qe(t){return"function"==typeof t?e=>qe(t(e)):()=>qe(t)}class Je extends _e{_options;constructor(t={}){super(t),this._options=qe(t.options)}get StyleClass(){return ne}clone(){return new Je(this)}get options(){return this._options}withOptions(t){const e=this.clone();return e._options=qe(t),e}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,font:a,bgColor:h,padding:u,textOverflow:d,appearance:g}=o;let{color:f}=o;h&&s({bgColor:h});const p=this._convertInternal(t);n.testFontLoad(a,p,e),Oe(i(),e,n,((e,o)=>{const r=n.toBoxPixelArray(u||0,o,a),s=r.slice(0);s[1]+=26;const i=r.slice(0);i[1]+=8,null!=f||null!=t&&""!==t||(f="rgba(0, 0, 0, .38)"),n.text(p,o,{textAlign:l,textBaseline:c,color:f,font:a,padding:s,textOverflow:d,icons:e}),"menulist-button"===g?n.text("",o,{textAlign:"right",textBaseline:c,color:f,font:a,icons:[{path:"M0 2 5 7 10 2z",width:10,color:"rgba(0, 0, 0, .54)"}],padding:i}):"none"!==g&&console.warn(`unsupported appearance:${g}`)}))}convertInternal(t){return t}_convertInternal(t){const e=this._options;for(let o=0;o<e.length;o++){const n=e[o];if(n.value===t){t=n.label;break}}return super.convertInternal(t)}getCopyCellValue(t){return this._convertInternal(t)}}class to extends _e{constructor(t={}){super(t)}get StyleClass(){return re}clone(){return new to(this)}drawInternal(t,e,o,n,r,{drawCellBase:s,getIcon:i}){const{textAlign:l,textBaseline:c,color:a,font:h,bgColor:u,padding:d,lineHeight:g,autoWrapText:f,lineClamp:p,textOverflow:C}=o;u&&s({bgColor:u});const _=t.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(h,t,e),Oe(i(),e,n,((t,e)=>{n.multilineText(_,e,{textAlign:l,textBaseline:c,color:a,font:h,padding:d,lineHeight:g,autoWrapText:f,lineClamp:p,textOverflow:C,icons:t})}))}}let eo;class oo extends Fe{_format;static get defaultFotmat(){return eo||(eo=new Intl.NumberFormat)}static set defaultFotmat(t){eo=t}constructor(t={}){super(t),this._format=t.format}get StyleClass(){return se}clone(){return new oo(this)}get format(){return this._format}withFormat(t){const e=this.clone();return e._format=t,e}convertInternal(t){const e=Number(t);if(isNaN(e))return super.convertInternal(t);return(this._format||oo.defaultFotmat).format(e)}}class no extends Fe{_min;_max;_formatter;constructor(t={}){super(t),this._min=t.min||0,this._max=t.max||this._min+100,this._formatter=t.formatter||(t=>t)}get StyleClass(){return le}clone(){return new no(this)}drawInternal(t,e,o,n,r,s){super.drawInternal(this._formatter(t),e,o,n,r,s);const{barColor:i,barBgColor:l,barHeight:c}=o;let a=`${t}`;S.endsWith(a,"%")&&(a=a.substr(0,a.length-1));const h=Number(a);if(isNaN(h))return;const u=h<this._min?0:h>this._max?1:(h-this._min)/(this._max-this._min);n.drawWithClip(e,(t=>{const o=e.getRect(),n=o.width-4-1,r=o.bottom-2-c-1,s=o.left+2;t.fillStyle=b(l,100*u)||"#f0f3f5",t.beginPath(),t.rect(s,r,n,c),t.fill();const a=Math.min(n*u,n);t.fillStyle=b(i,100*u)||"#20a8d8",t.beginPath(),t.rect(s,r,a,c),t.fill()}))}}const ro=Y();class so extends _e{get StyleClass(){return ae}clone(){return new so(this)}convertInternal(t){return We(t)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,checkColor:c,uncheckBorderColor:a,checkBorderColor:h,uncheckBgColor:u,checkBgColor:d,bgColor:g}=o;g&&s({bgColor:g});const{col:f,row:p}=e,C=r.getCellRange(f,p),_=`${C.start.col}:${C.start.row}`,w=r[ro]?.elapsed[_],m={textAlign:i,textBaseline:l,checkColor:c,uncheckBorderColor:a,checkBorderColor:h,uncheckBgColor:u,checkBgColor:d};null!=w&&(m.animElapsedTime=w),n.radioButton(t,e,m)}}const io={DEFAULT:new Fe,NUMBER:new oo,CHECK:new He,RADIO:new so,BUTTON:new Ne,IMAGE:new Xe,MULTILINETEXT:new to};function lo(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return io[e]||lo(null)}return t}return io.DEFAULT}const co=U("inline_menu_editor.stateID");let ao=null,ho=0;function uo(t,e,o,n,r){const s=function(t){let e=t[co];return e||(e={},M.setReadonly(t,co,e)),e}(t);ao||(ao=new Dt),s.element||(s.element=ao,ho++,t.addDisposable({dispose(){ho--,ho||(ao?.dispose(),ao=null,s.element=null)}})),ao.attach(t,o,e.col,e.row,n,r)}function go(t){ao&&ao.detach(t)}class fo extends J{_classList;_options;constructor(t={}){super(t),this._classList=t.classList,this._options=Qe(t.options)}dispose(){}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get options(){return this._options}set options(t){this._options=Qe(t)}clone(){return new fo(this)}onChangeDisabledInternal(){go(!0)}onChangeReadOnlyInternal(){go(!0)}bindGridEvent(t,e){const o=e=>!W(this.readOnly,t,e.row)&&!N(this.disabled,t,e.row)&&(t.doGetCellValue(e.col,e.row,(o=>{const n=t.getRowRecord(e.row);x(n)||uo(t,e,this,o,n)})),!0);function n(o,n){return t.getLayoutCellId(o,n)===e}return[t.listen(D.CLICK_CELL,(t=>{n(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(D.KEYDOWN,(e=>{if(113!==e.keyCode&&13!==e.keyCode)return;const r=t.selection.select;n(r.col,r.row)&&o({col:r.col,row:r.row})&&e.stopCellMoving()})),t.listen(D.SELECTED_CELL,(t=>{go()})),t.listen(D.SCROLL,(()=>{go(!0)})),t.listen(D.MOUSEOVER_CELL,(e=>{n(e.col,e.row)&&(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||(t.getElement().style.cursor="pointer"))})),t.listen(D.MOUSEMOVE_CELL,(e=>{n(e.col,e.row)&&(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||t.getElement().style.cursor||(t.getElement().style.cursor="pointer"))})),t.listen(D.MOUSEOUT_CELL,(e=>{n(e.col,e.row)&&(t.getElement().style.cursor="")})),t.listen(D.PASTE_CELL,(e=>{if(e.multi)return;const o=t.selection.range;if(!E(o.start,o.end))return;if(!n(e.col,e.row))return;if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row))return;const r=t.getRowRecord(e.row);if(x(r))return;const s=this._pasteDataToOptionValue(e.normalizeValue,t,e,r);s&&(T.cancel(e.event),v(t.doChangeValue(e.col,e.row,(()=>s.value)),(()=>{const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)})))}))]}onPasteCellRangeBox(t,e,o){if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row))return;const n=t.getRowRecord(e.row);if(x(n))return;const r=this._pasteDataToOptionValue(o,t,e,n);r&&t.doChangeValue(e.col,e.row,(()=>r.value))}onDeleteCellRangeBox(t,e){if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row))return;const o=t.getRowRecord(e.row);if(x(o))return;const n=this._pasteDataToOptionValue("",t,e,o);n&&t.doChangeValue(e.col,e.row,(()=>n.value))}_pasteDataToOptionValue(t,e,o,n){const r=this._options(n),s=po(t,r);if(s)return s;const i=e.getColumnType(o.col,o.row);if(function(t){if(t instanceof Je)return!0;if(Array.isArray(t.options))return!0;return!1}(i)){const e=Co(t),o=a.find(i.options,(t=>Co(t.label)===e));if(o)return po(o.value,r)}}}function po(t,e){const o=Co(t),n=a.find(e,(t=>Co(t.value)===o));if(n)return n}function Co(t){return null==t?"":`${t}`.trim()}const _o=Y();class wo extends J{_group;_checkAction;constructor(t={}){super(t),this._group=t.group,this._checkAction=t.checkAction}clone(){return new wo(this)}get group(){return this._group}set group(t){this._group=t}get checkAction(){return this._checkAction}set checkAction(t){this._checkAction=t}bindGridEvent(t,e){let o=t[_o];o||(o={block:{},elapsed:{}},M.setReadonly(t,_o,o));const n=o,r=e=>{this._action(t,e)};return[...O(t,e,{action:r,mouseOver:e=>{if(N(this.disabled,t,e.row))return!1;n.mouseActiveCell={col:e.col,row:e.row};const o=t.getCellRange(e.col,e.row);return t.invalidateCellRange(o),!0},mouseOut:e=>{delete n.mouseActiveCell;const o=t.getCellRange(e.col,e.row);t.invalidateCellRange(o)}}),...F(t,e,{action:r}),t.listen(D.PASTE_CELL,(o=>{if(o.multi)return;const n=t.selection.range;if(!E(n.start,n.end))return;if(s=o.col,i=o.row,t.getLayoutCellId(s,i)!==e)return;var s,i;We(o.normalizeValue.trim())&&(T.cancel(o.event),r({col:o.col,row:o.row}))}))]}onPasteCellRangeBox(t,e,o){if(W(this.readOnly,t,e.row)||N(this.disabled,t,e.row))return;We(o.trim())&&this._action(t,{col:e.col,row:e.row})}onDeleteCellRangeBox(){}_action(t,e){const o=t[_o],n=t.getCellRange(e.col,e.row),r=`${n.start.col}:${n.start.row}`;W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||o.block[r]||t.doGetCellValue(e.col,e.row,(o=>{if(We(o))return;if(this._checkAction){const o=t.getRowRecord(e.row);return void this._checkAction(o,_(e,{grid:t}))}if(this._group){const o=t[_o];return void this._group({grid:t,col:e.col,row:e.row}).forEach((({col:n,row:r})=>{const s=t.getCellRange(n,r),i=`${s.start.col}:${s.start.row}`;W(this.readOnly,t,e.row)||N(this.disabled,t,e.row)||o.block[i]||mo(t,n,r,n===e.col&&r===e.row)}))}const n=t.getField(e.col,e.row),r=t.getRecordStartRowByRecordIndex(t.getRecordIndexByRow(e.row)),{dataSource:s}=t.dataSource,i=function(t){const e=[],{rowCount:o,recordRowCount:n}=t;for(let r=t.frozenRowCount;r<o;r+=n){const o=t.getRowRecord(r);e.push({row:r,record:o})}return e}(t);for(let o=0;o<s.length;o++){const l=s.get(o),c=i.find((t=>t.record===l));c?mo(t,e.col,c.row,c.row===r):v(s.getField(o,n),(t=>{We(t)&&s.setField(o,n,z(t))}))}}))}}function mo(t,e,o,n){t.doGetCellValue(e,o,(r=>{if(We(r)===n)return;const s=t[_o],i=t.getCellRange(e,o),l=`${i.start.col}:${i.start.row}`,c=t.doChangeValue(e,o,z);if(c){const e=()=>{rt(200,(e=>{1===e?delete s.elapsed[l]:s.elapsed[l]=e,t.invalidateCellRange(i)}))};x(c)?(s.block[l]=!0,c.then((()=>{delete s.block[l],e()}))):e()}}))}const yo="cheetah-grid__small-dialog-input",bo="cheetah-grid__small-dialog-input__input",xo="cheetah-grid__small-dialog-input--hidden",vo="cheetah-grid__small-dialog-input--shown";function Eo(t,e){e.tryWithOffEvents(t,"blur",(()=>{(()=>{t.focus();const e=t.value.length;try{if(void 0!==t.selectionStart)return t.selectionStart=e,void(t.selectionEnd=e)}catch(t){}if(document.selection){const o=t.createTextRange();o.collapse(),o.moveEnd("character",e),o.moveStart("character",e),o.select()}})()}))}function Io(t,e,o){const{type:n}=t;o.type=n||""}class Lo{_handler;_dialog;_input;_beforePropEditor;_activeData;_attaching;_beforeValue;static setInputAttrs(t,e,o){Io(t,0,o)}constructor(){this._handler=new at,this._dialog=function(){const t=ht("div",{classList:[yo,xo]}),e=ht("input",{classList:bo});return e.readOnly=!0,e.tabIndex=-1,t.appendChild(e),t}(),this._input=this._dialog.querySelector(`.${bo}`),this._bindDialogEvents()}dispose(){const t=this._dialog;this.detach(),this._handler.dispose(),delete this._dialog,delete this._input,this._beforePropEditor=null,t.parentElement&&t.parentElement.removeChild(t)}attach(t,e,o,n,r){const s=this._handler,i=this._dialog,l=this._input;this._beforePropEditor&&function(t,e,o,n){const{classList:r}=n;r&&e.classList.remove(...r),delete e.dataset.helperText,o.type=""}(0,i,l,this._beforePropEditor),delete i.dataset.errorMessage,i.classList.remove(vo),i.classList.add(xo),l.readOnly=!0,l.tabIndex=0;const{element:c,rect:a}=t.getAttachCellsArea(t.getCellRange(o,n));i.style.top=`${a.top.toFixed()}px`,i.style.left=`${a.left.toFixed()}px`,i.style.width=`${a.width.toFixed()}px`,l.style.height=`${a.height.toFixed()}px`,c.appendChild(i),Ct(l,r),l.style.font=t.font||"16px sans-serif";const h={grid:t,col:o,row:n,editor:e};this._onInputValue(l,h),L?setTimeout((()=>Eo(l,s))):Eo(l,s),i.classList.add(vo),i.classList.remove(xo),l.readOnly=!1,function(t,e,o,n){const{classList:r,helperText:s}=n;r&&e.classList.add(...r),s&&"function"!=typeof s&&(e.dataset.helperText=s),Io(n,0,o)}(0,i,l,e),this._activeData=h,this._beforePropEditor=e,this._attaching=!0,setTimeout((()=>{delete this._attaching}))}detach(t){if(this._isActive()){const e=this._dialog,o=this._input;e.classList.remove(vo),e.classList.add(xo),o.readOnly=!0,o.tabIndex=-1;const{grid:n,col:r,row:s}=this._activeData,i=n.getCellRange(r,s);n.invalidateCellRange(i),t&&n.focus()}this._activeData=null,this._beforeValue=null}_doChangeValue(){if(!this._isActive())return!1;const t=this._input,{value:e}=t;return v(this._validate(e),(o=>{if(o&&e===t.value){const{grid:t,col:o,row:n}=this._activeData;return t.doChangeValue(o,n,(()=>e)),!0}return!1}))}_isActive(){const t=this._dialog;return!(!t||!t.parentElement)&&!!this._activeData}_bindDialogEvents(){const t=this._handler,e=this._dialog,o=this._input,n=t=>t.stopPropagation();t.on(e,"click",n),t.on(e,"dblclick",n),t.on(e,"mousedown",n),t.on(e,"touchstart",n),t.on(o,"compositionstart",(t=>{o.classList.add("composition")})),t.on(o,"compositionend",(t=>{o.classList.remove("composition"),this._onInputValue(o)}));const r=t=>{o.classList.contains("composition")||this._onInputValue(o)};t.on(o,"keyup",r),t.on(o,"keypress",r),t.on(o,"keydown",(t=>{if(o.classList.contains("composition"))return;const e=T.getKeyCode(t);27===e?(this.detach(!0),T.cancel(t)):13===e?this._onKeydownEnter(t):this._onInputValue(o)}))}_onKeydownEnter(t){if(this._attaching)return;const e=this._input,{value:o}=e;v(this._doChangeValue(),(n=>{if(n&&o===e.value){const e=this._isActive()?this._activeData.grid:null;this.detach(!0),e?.keyboardOptions?.moveCellOnEnter&&e.onKeyDownMove(t)}})),T.cancel(t)}_onInputValue(t,e){const o=this._beforeValue,{value:n}=t;o!==n&&this._onInputValueChange(n,e),this._beforeValue=n}_onInputValueChange(t,e){e=e||this._activeData;const o=this._dialog,{grid:n,col:r,row:s,editor:i}=e;if("function"==typeof i.helperText){const e=i.helperText(t,{grid:n,col:r,row:s});e?o.dataset.helperText=e:delete o.dataset.helperText}"errorMessage"in o.dataset&&this._validate(t,!0)}_validate(t,e){const o=this._dialog,n=this._input,{grid:r,col:s,row:i,editor:l}=this._activeData;let c="";return l.inputValidator&&(c=l.inputValidator(t,{grid:r,col:s,row:i})),v(c,(c=>(c||!l.validator||e||(c=l.validator(t,{grid:r,col:s,row:i})),v(c,(e=>(e&&t===n.value?o.dataset.errorMessage=e:delete o.dataset.errorMessage,!e))))))}}const Ro=U("small_dialog_input_editor.stateID");let Bo=null,Mo=0;function So(t,e,o,n){const r=function(t){let e=t[Ro];return e||(e={},M.setReadonly(t,Ro,e)),e}(t);Bo||(Bo=new Lo),r.element||(r.element=Bo,Mo++,t.addDisposable({dispose(){Mo--,Mo||(Bo?.dispose(),Bo=null,r.element=null)}})),Bo.attach(t,o,e.col,e.row,n)}function To(t){Bo&&Bo.detach(t)}class Ao extends lt{_helperText;_inputValidator;_validator;_classList;_type;constructor(t={}){super(t),this._helperText=t.helperText,this._inputValidator=t.inputValidator,this._validator=t.validator,this._classList=t.classList,this._type=t.type}dispose(){}get classList(){if(this._classList)return Array.isArray(this._classList)?this._classList:[this._classList]}set classList(t){this._classList=t}get type(){return this._type}set type(t){this._type=t}get helperText(){return this._helperText}get inputValidator(){return this._inputValidator}get validator(){return this._validator}clone(){return new Ao(this)}onInputCellInternal(t,e,o){So(t,e,this,o)}onOpenCellInternal(t,e){t.doGetCellValue(e.col,e.row,(o=>{So(t,e,this,o)}))}onChangeSelectCellInternal(t,e,o){To()}onGridScrollInternal(t){To(!0)}onChangeDisabledInternal(){To(!0)}onChangeReadOnlyInternal(){To(!0)}onSetInputAttrsInternal(t,e,o){Lo.setInputAttrs(this,t,o)}}const ko={CHECK:new class extends it{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},INPUT:new class extends Ao{get disabled(){return this._disabled}get readOnly(){return this._readOnly}},RADIO:new class extends wo{get disabled(){return this._disabled}get readOnly(){return this._readOnly}}};function Do(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return ko[e]||Do(null)}return t}}const Oo={action:r,type:e,style:t};function Fo(t){return 9===t||10===t||12===t||13===t||32===t}function Po(t){return t>=48&&t<=57}function No(t){return 46===t}function Wo(t){return function(t){return function(t){return t>=97&&t<=122}(t)||function(t){return t>=65&&t<=90}(t)}(t)||37===t}function zo(t){return new Error(`calc parse error: ${t}`)}const Ho={"*":3,"/":3,"+":2,"-":2};function $o(t,e){function o(t){const o=t.pop(),n=t.pop(),r=t.pop();if(!(r&&r.nodeType&&n&&2===n.type&&o&&o.nodeType))throw zo(e);return{nodeType:11,left:r,op:n,right:o}}const n=[];for(;t.length;){const r=t.shift();if(0===r.type&&"("===r.value){let o=0;const r=a.findIndex(t,(t=>{if(0===t.type&&"("===t.value)o++;else if(0===t.type&&")"===t.value){if(!o)return!0;o--}return!1}));if(-1===r)throw zo(e);n.push($o(t.splice(0,r),e)),t.shift()}else if(2===r.type){if(n.length>=3){const t=n[n.length-2].value;Ho[r.value]<=Ho[t]&&n.push(o(n))}n.push(r)}else if(1===r.type){const{value:t,unit:e}=r;n.push({nodeType:10,value:t,unit:e})}else 3===r.type&&n.push({nodeType:12,value:r.value})}for(;n.length>1;)n.push(o(n));return n[0]}function jo(t){return $o(function(t){const e=t.replace(/calc\(/g,"(").trim(),o=[],n=e.length;for(let i=0;i<n;i++){const n=e[i],l=n.charCodeAt(0);if("("===n||")"===n)o.push({value:n,type:0});else if("*"===n||"/"===n)o.push({value:n,type:2});else if("+"===n||"-"===n)i=r(n,i+1)-1;else if(Po(l)||No(l))i=s(n,i+1)-1;else if(!Fo(l))throw zo(t)}function r(t,r){if(r<n){const o=e[r],n=o.charCodeAt(0);if(Po(n)||No(n))return s(t+o,r+1)}return o.push({value:t,type:2}),r}function s(r,s){let l=s;for(;l<n;l++){const o=e[l],n=o.charCodeAt(0);if(Po(n))r+=o;else{if("."!==o){if(Wo(n))return i(r,o,l+1);break}if(r.indexOf(".")>=0)throw zo(t);r+=o}}if("."===r)throw zo(t);return o.push({value:parseFloat(r),type:3}),l}function i(t,r,s){let i=s;for(;i<n;i++){const t=e[i];if(!Wo(t.charCodeAt(0)))break;r+=t}return o.push({value:parseFloat(t),unit:r,type:1}),i}return o}(t),t)}function Vo(t,e){if(11===t.nodeType){const o=Vo(t.left,e),n=Vo(t.right,e);switch(t.op.value){case"+":return o+n;case"-":return o-n;case"*":return o*n;case"/":return o/n;default:throw new Error(`calc error. unknown operator: ${t.op.value}`)}}else if(10===t.nodeType)switch(t.unit){case"%":return t.value*e.full/100;case"em":return t.value*e.em;case"px":return t.value;default:throw new Error(`calc error. unknown unit: ${t.unit}`)}else if(12===t.nodeType)return t.value;throw new Error("calc error.")}function Uo(t,e){return Vo(jo(t),e)}function Go(t,e){return"string"==typeof t?Uo(t.trim(),e):t-0}const Ko=new at;let Yo,Zo=1;function Xo(){i?Zo=1:(Zo=Math.ceil(window.devicePixelRatio||1),Zo>1&&Zo%2!=0&&(Zo+=1))}Xo(),i||Ko.on(window,"resize",Xo);let qo=function(){Yo=function(){const t=document.createElement("div"),{style:e}=t;e.position="absolute",e.height="9999px",e.width="calc(100vw - 100%)",e.opacity="0",t.textContent="x",document.body.appendChild(t);const{width:o}=(document.defaultView||window).getComputedStyle(t,"");return document.body.removeChild(t),parseInt(o,10)}()||10;const t=document.createElement("style");t.setAttribute("type","text/css"),t.setAttribute("data-name","cheetah-grid"),t.innerHTML=`\n.cheetah-grid .grid-scroll-end-point {\n\twidth: ${Yo}px;\n\theight: ${Yo}px;\n}\n.cheetah-grid > canvas {\n\twidth: -webkit-calc(100% - ${Yo}px);\n\twidth: calc(100% - ${Yo}px);\n\theight: -webkit-calc(100% - ${Yo}px);\n\theight: calc(100% - ${Yo}px);\n}\n\t\t`,document.head.appendChild(t)};function Qo(){return Yo}class Jo{_keys=[];_vals={};_sorted=!1;put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return null!=this._vals[t]}each(t,e,o){const{_keys:n}=this,{length:r}=n;this._sorted||(n.sort(((t,e)=>t<e?-1:t>e?1:0)),this._sorted=!0);for(let s=((t,e)=>{let o=0,n=t.length-1;for(;o<=n;){const r=Math.floor((o+n)/2);if(t[r]===e)return r;t[r]>e?n=r-1:o=r+1}return n<0?0:n})(n,t);s<r;s++){const r=n[s];if(t<=r&&r<=e)o(this.get(r),r);else if(e<r)return}}}class tn{_left;_top;_width;_height;_right;_bottom;constructor(t,e,o,n){this._left=t,this._top=e,this._width=o,this._height=n}static bounds(t,e,o,n){return new tn(t,e,o-t,n-e)}static max(t,e){return tn.bounds(Math.min(t.left,e.left),Math.min(t.top,e.top),Math.max(t.right,e.right),Math.max(t.bottom,e.bottom))}get left(){return this._left}set left(t){const{right:e}=this;this._left=t,this.right=e}get top(){return this._top}set top(t){const{bottom:e}=this;this._top=t,this.bottom=e}get width(){return this._width}set width(t){this._width=t,this._right=void 0}get height(){return this._height}set height(t){this._height=t,this._bottom=void 0}get right(){return void 0!==this._right?this._right:this._right=this.left+this.width}set right(t){this._right=t,this.width=t-this.left}get bottom(){return void 0!==this._bottom?this._bottom:this._bottom=this.top+this.height}set bottom(t){this._bottom=t,this.height=t-this.top}offsetLeft(t){this._left+=t,this._right=void 0}offsetTop(t){this._top+=t,this._bottom=void 0}copy(){return new tn(this.left,this.top,this.width,this.height)}intersection(t){const e=Math.max(this.left,t.left),o=Math.min(this.left+this.width,t.left+t.width);if(e<=o){const n=Math.max(this.top,t.top),r=Math.min(this.top+this.height,t.top+t.height);if(n<=r)return tn.bounds(e,n,o,r)}return null}contains(t){return this.left<=t.left&&this.left+this.width>=t.left+t.width&&this.top<=t.top&&this.top+this.height>=t.top+t.height}inPoint(t,e){return this.left<=t&&this.left+this.width>=t&&this.top<=e&&this.top+this.height>=e}}const en=B-1e3;class on{_handler;_scrollable;_height;_width;_endPointElement;_p=1;constructor(){this._handler=new at,this._scrollable=document.createElement("div"),this._scrollable.classList.add("grid-scrollable"),this._height=0,this._width=0,this._endPointElement=document.createElement("div"),this._endPointElement.classList.add("grid-scroll-end-point"),this._update(),this._scrollable.appendChild(this._endPointElement)}calcTop(t){const e=t-this.scrollTop;return this._scrollable.scrollTop+e}getElement(){return this._scrollable}setScrollSize(t,e){this._width=t,this._height=e,this._update()}get scrollWidth(){return this._width}set scrollWidth(t){this._width=t,this._update()}get scrollHeight(){return this._height}set scrollHeight(t){this._height=t,this._update()}get scrollLeft(){return Math.max(Math.ceil(this._scrollable.scrollLeft),0)}set scrollLeft(t){this._scrollable.scrollLeft=t}get scrollTop(){return Math.max(Math.ceil(this._scrollable.scrollTop/this._p),0)}set scrollTop(t){this._scrollable.scrollTop=t*this._p}onScroll(t){this._handler.on(this._scrollable,"scroll",t)}dispose(){this._handler.dispose()}_update(){let t;if(this._height>en){const e=Qo(),{offsetHeight:o}=this._scrollable,n=en-o+e,r=this._height-o+e;this._p=n/r,t=en}else this._p=1,t=this._height;this._endPointElement.style.top=`${t.toFixed()}px`,this._endPointElement.style.left=`${this._width.toFixed()}px`}}function nn(t){const e=t.replace(/\r?\n$/,"").split(/(?:\r?\n)|[\u2028\u2029]/g).map((t=>t.split(/\t/g)));return{colCount:e.reduce(((t,e)=>Math.max(t,e.length)),0),rowCount:e.length,getCellValue:(t,o)=>e[o]?.[t]||""}}const{isTouchEvent:rn,getMouseButtons:sn,getKeyCode:ln,cancel:cn}=T,an=G();function hn(t){navigator.vibrate&&rn(t)&&navigator.vibrate(50)}function un(t){const e=this.getTargetRowAtInternal(t);if(null!=e)return e;const o=(e,o)=>{let n=o;for(let o=e;o>=0;o--){const e=n-An.call(this,o);if(e<=t&&t<n)return{top:e,row:o};n=e}return null},n=(e,o)=>{let n=o-An.call(this,e);const{rowCount:r}=this[an];for(let o=e;o<r;o++){const e=n+An.call(this,o);if(n<=t&&t<e)return{top:n,row:o};n=e}return null},r=Math.min(Math.ceil(t/this[an].defaultRowHeight),this.rowCount-1),s=kn.call(this,0,r);return t>=s?n(r,s):o(r,s)}function dn(t,e){let o=0;const{colCount:n}=t[an];for(let r=0;r<n;r++){const n=o+Mn(t,r);if(n>e)return{left:o,col:r};o=n}return null}function gn(t,e){if(!t[an].frozenRowCount)return null;let{top:o}=t[an].scroll;const n=t[an].frozenRowCount;for(let r=0;r<n;r++){const n=o+An.call(t,r);if(n>e)return{top:o,row:r};o=n}return null}function fn(t,e){if(!t[an].frozenColCount)return null;let{left:o}=t[an].scroll;const n=t[an].frozenColCount;for(let r=0;r<n;r++){const n=o+Mn(t,r);if(n>e)return{left:o,col:r};o=n}return null}function pn(t){if(!t[an].frozenRowCount)return null;const{top:e}=t[an].scroll;let o=0;const n=t[an].frozenRowCount;for(let e=0;e<n;e++)o+=An.call(t,e);return new tn(t[an].scroll.left,e,t[an].canvas.width,o)}function Cn(t){if(!t[an].frozenColCount)return null;const{left:e}=t[an].scroll;let o=0;const n=t[an].frozenColCount;for(let e=0;e<n;e++)o+=Mn(t,e);return new tn(e,t[an].scroll.top,o,t[an].canvas.height)}function _n(t,e,o,n,r,s,i,l,c,a,h){const u=new tn(o-l.left,s-l.top,n,i),d=tn.bounds(Math.max(o,a)-l.left,Math.max(s,c)-l.top,u.right,u.bottom);if(d.height>0&&d.width>0){t.save();try{const o=function(t,e,o){return t[an].drawCells[o]?t[an].drawCells[o][e]:null}(this,e,r);o&&o.cancel();const n=new qn(e,r,t,u,d,!!o,this[an].selection,h),s=this.onDrawCell(e,r,n);if(x(s)){!function(t,e,o,n){t[an].drawCells[o]||(t[an].drawCells[o]={}),t[an].drawCells[o][e]=n}(this,e,r,n);const t=e;n._delayMode(this,(()=>{!function(t,e,o){t[an].drawCells[o]&&(delete t[an].drawCells[o][e],0===Object.keys(t[an].drawCells[o]).length&&delete t[an].drawCells[o])}(this,t,r)})),s.then((()=>{n.terminate()}))}}finally{t.restore()}}}function wn(t,e,o,n,r,s,i,l,c,a,h){const{colCount:u}=t[an],d=(o,n)=>{if(o>=u-1&&t[an].canvas.width>n-c.left){const o=n-c.left;e.save(),e.beginPath(),e.fillStyle=t.underlayBackgroundColor||"#F6F6F6",e.rect(o,i-c.top,t[an].canvas.width-o,l),e.fill(),e.restore()}};let g=0;if(o){let n=o.left;const u=t[an].frozenColCount;for(let{col:g}=o;g<u;g++){const o=Mn(t,g);if(_n.call(t,e,g,n,o,s,i,l,c,a,0,h),n+=o,r<=n)return void d(g,n)}g=n}let f=n.left;for(let{col:o}=n;o<u;o++){const n=Mn(t,o);if(_n.call(t,e,o,f,n,s,i,l,c,a,g,h),f+=n,r<=f)return void d(o,f)}d(u-1,f)}function mn(){return this._getInitContext()}function yn(t,e){const o=Hn(t),{rowCount:n}=t[an],r=mn.call(t),s=un.call(t,Math.max(o.top,e.top))||{top:kn.call(t,0,n-1),row:n},i=dn(t,Math.max(o.left,e.left))||{left:Tn(t,0,t[an].colCount-1),col:t[an].colCount},l=Math.min(o.bottom,e.bottom),c=Math.min(o.right,e.right),a=gn(t,Math.max(o.top,e.top)),h=fn(t,Math.max(o.left,e.left)),u=new Zn,d=(e,s)=>{if(e>=n-1&&t[an].canvas.height>s-o.top){const e=s-o.top;r.save(),r.beginPath(),r.fillStyle=t.underlayBackgroundColor||"#F6F6F6",r.rect(0,e,t[an].canvas.width,t[an].canvas.height-e),r.fill(),r.restore()}};let g=0;if(a){let e=a.top;const n=t[an].frozenRowCount;for(let{row:s}=a;s<n;s++){const n=An.call(t,s);if(wn(t,r,h,i,c,s,e,n,o,0,u),e+=n,l<=e)return d(s,e),void u.draw(r)}g=e}let f=s.top;for(let{row:e}=s;e<n;e++){const n=An.call(t,e);if(wn(t,r,h,i,c,e,f,n,o,g,u),f+=n,l<=f)return d(e,f),void u.draw(r)}d(n-1,f),u.draw(r)}function bn(t,e){return Math.round(Go(e,t[an].calcWidthContext))}function xn(t,e,o){const n=In(t,e);return Math.max(vn(n,o),0)}function vn(t,e){return t?t.min&&t.min>e?t.min:t.max&&t.max<e?t.max:e:e}function En(t,e){const o=t[an].colWidthsMap.get(e);return o||t.defaultColWidth}function In(t,e){const o=t[an].colWidthsLimit[e];if(!o)return null;const n={};return o.min&&(n.min=bn(t,o.min),n.minDef=o.min),o.max&&(n.max=bn(t,o.max),n.maxDef=o.max),n}function Ln(t){return Boolean(t&&"string"==typeof t&&"auto"===t.toLowerCase())}function Rn(t,e=!0){const o=t[an].calcWidthContext.full;let n=0;const r=[];let s=0;const i=[];for(let l=0;l<t[an].colCount;l++){const c=En(t,l),a=In(t,l);if(Ln(c))a&&(i.push(a),a.min&&(n+=a.min)),s++;else{let e=c;if(a){const o=bn(t,e),r=vn(a,o);o!==r&&(e=`${r}px`),n+=r}r.push(e)}if(e&&n>o)return"0px"}if(i.length&&r.length){const n=(o-bn(t,`calc(${r.map((t=>"number"==typeof t?`${t}px`:t)).join(" + ")})`))/s;if(i.forEach((t=>{t.min&&n<t.min?(r.push(t.minDef),s--):t.max&&t.max<n&&(r.push(t.maxDef),s--)})),e&&s<=0)return`${n}px`}if(r.length){const t=[];let e=0;return r.forEach((o=>{"number"==typeof o?e+=o:t.push(o)})),t.push(`${e}px`),`calc((100% - (${t.join(" + ")})) / ${s})`}return 100/s+"%"}function Bn(t,e){return Ln(e)?bn(t,Rn(t)):bn(t,e)}function Mn(t,e){return xn(t,e,Bn(t,En(t,e)))}function Sn(t,e,o){t[an].colWidthsMap.put(e,o)}function Tn(t,e,o){const n=Bn(t,t.defaultColWidth);let r=n*(o-e+1);t[an].colWidthsMap.each(e,o,((e,o)=>{r+=xn(t,o,Bn(t,e))-n}));for(let s=e;s<=o;s++){if(t[an].colWidthsMap.has(s))continue;const e=xn(t,s,n);e!==n&&(r+=e-n)}return r}function An(t){const e=this.getRowHeightInternal(t);if(null!=e)return e;const o=this[an].rowHeightsMap.get(t);return o||this[an].defaultRowHeight}function kn(t,e){const o=this.getRowsHeightInternal(t,e);if(null!=o)return o;const n=e-t+1;let r=this[an].defaultRowHeight*n;return this[an].rowHeightsMap.each(t,e,(t=>{r+=t-this[an].defaultRowHeight})),r}function Dn(t){const e=this.getScrollHeightInternal(t);if(null!=e)return e;let o=this[an].defaultRowHeight*this[an].rowCount;return this[an].rowHeightsMap.each(0,this[an].rowCount-1,(t=>{o+=t-this[an].defaultRowHeight})),o}function On(t){const{shiftKey:e}=t,o=ln(t),n=e?this.selection.focus:this.selection.select;if(37===o){if(t.ctrlKey||t.metaKey)r(this,null,"W");else if(!i.call(this,"W"))return;cn(t)}else if(38===o){if(t.ctrlKey||t.metaKey)r(this,"N",null);else if(!s.call(this,"N"))return;cn(t)}else if(39===o){if(t.ctrlKey||t.metaKey)r(this,null,"E");else if(!i.call(this,"E"))return;cn(t)}else if(40===o){if(t.ctrlKey||t.metaKey)r(this,"S",null);else if(!s.call(this,"S"))return;cn(t)}else if(36===o)t.ctrlKey||t.metaKey?r(this,"N","W"):r(this,null,"W"),cn(t);else if(35===o)t.ctrlKey||t.metaKey?r(this,"S","E"):r(this,null,"E"),cn(t);else if(this.keyboardOptions?.moveCellOnTab&&9===o){if(e){if(!i.call(this,"W",!1)){const t=this.getMoveUpRowByKeyDownInternal(n);if(0>t)return;Fn.call(this,this.colCount-1,t,!1)}}else if(!i.call(this,"E",!1)){const t=this.getMoveDownRowByKeyDownInternal(n);if(this.rowCount<=t)return;Fn.call(this,0,t,!1)}cn(t)}else if(this.keyboardOptions?.moveCellOnEnter&&13===o){if(e){if(!s.call(this,"N",!1)){const t=this.getMoveLeftColByKeyDownInternal(n);if(0>t)return;Fn.call(this,t,this.rowCount-1,!1)}}else if(!s.call(this,"S",!1)){const t=this.getMoveRightColByKeyDownInternal(n);if(this.colCount<=t)return;Fn.call(this,t,Math.min(this.frozenRowCount,this.rowCount-1),!1)}cn(t)}else this.keyboardOptions?.selectAllOnCtrlA&&65===o&&(t.ctrlKey||t.metaKey)&&(this.selection.range={start:{col:0,row:0},end:{col:this.colCount-1,row:this.rowCount-1}},this.invalidate(),cn(t));function r(t,o,r){const s="S"===o?t.rowCount-1:"N"===o?0:n.row,i="E"===r?t.colCount-1:"W"===r?0:n.col;Fn.call(t,i,s,e)}function s(t,o=e){let r;if("S"===t){if(r=this.getMoveDownRowByKeyDownInternal(n),this.rowCount<=r)return!1}else if(r=this.getMoveUpRowByKeyDownInternal(n),r<0)return!1;const{col:s}=n;return Fn.call(this,s,r,o),!0}function i(t,o=e){let r;if("E"===t){if(r=this.getMoveRightColByKeyDownInternal(n),this.colCount<=r)return!1}else if(r=this.getMoveLeftColByKeyDownInternal(n),r<0)return!1;const{row:s}=n;return Fn.call(this,r,s,o),!0}}function Fn(t,e,o){const n=this.getOffsetInvalidateCells();function r(t){return n>0&&(t.start.col-=n,t.start.row-=n,t.end.col+=n,t.end.row+=n),t}const s=r(this.selection.range),i=this.getCellRangeRect(s);this.selection._setFocusCell(t,e,o),this.makeVisibleCell(t,e),this.focusCell(t,e);const l=r(this.selection.range),c=this.getCellRangeRect(l);if(c.intersection(i)){yn(this,tn.max(c,i))}else yn(this,i),yn(this,c)}function Pn(){const{focusControl:t}=this[an],{col:e,row:o}=this[an].selection.select,n=this.fireListeners(D.EDITABLEINPUT_CELL,{col:e,row:o}),r=a.findIndex(n,(t=>!!t))>=0;t.editMode=r,r&&(t.storeInputStatus(),t.setDefaultInputStatus(),this.fireListeners(D.MODIFY_STATUS_EDITABLEINPUT_CELL,{col:e,row:o,input:t.input}))}function Nn(t,e){let o;o=rn(e)?e.changedTouches[0]:e;const n=o.clientX||o.pageX+window.scrollX,r=o.clientY||o.pageY+window.scrollY,s=t[an].canvas.getBoundingClientRect();if(s.right<=n)return null;if(s.bottom<=r)return null;return{x:n-s.left+t[an].scroll.left,y:r-s.top+t[an].scroll.top}}function Wn(){const t=this,{handler:e,element:o,scrollable:n}=t[an],r=e=>{const o=Nn(t,e);if(!o)return{};const n=t.getCellAt(o.x,o.y);if(n.col<0||n.row<0)return{abstractPos:o,cell:n};return{abstractPos:o,cell:n,eventArgs:{col:n.col,row:n.row,event:e}}},s=e=>{if(t[an].disableColumnResize)return!1;const o=t[an].colWidthsLimit[e];return!(o&&o.min&&o.max)||o.max!==o.min};e.on(o,"mousedown",(e=>{const o=r(e),{abstractPos:n,eventArgs:i}=o;if(!n)return;if(i){const e=t.fireListeners(D.MOUSEDOWN_CELL,i);if(a.findIndex(e,(t=>!t))>=0)return}if(1!==sn(e))return;const l=zn(t,n.x,n.y);l>=0&&s(l)?t[an].columnResizer.start(l,e):t[an].cellSelector.start(e)})),e.on(o,"mouseup",(e=>{if(!t.hasListeners(D.MOUSEUP_CELL))return;const{eventArgs:o}=r(e);o&&t.fireListeners(D.MOUSEUP_CELL,o)}));let i=null,l=0;function c(t){l&&(window.clearTimeout(l),l=0)}e.on(o,"touchstart",(e=>{if(i){const{eventArgs:o}=r(e);if(o&&o.col===i.col&&o.row===i.row&&t.fireListeners(D.DBLTAP_CELL,o),i=null,e.defaultPrevented)return}else i=r(e).eventArgs,setTimeout((()=>{i=null}),350);l=window.setTimeout((()=>{l=0;const o=Nn(t,e);if(!o)return;const n=zn(t,o.x,o.y,15);n>=0&&s(n)?t[an].columnResizer.start(n,e):t[an].cellSelector.start(e)}),500)})),e.on(o,"touchcancel",c),e.on(o,"touchmove",c),e.on(o,"touchend",(e=>{l&&(window.clearTimeout(l),t[an].cellSelector.select(e),l=0)}));let h=!1,u=null,d=null;function g(e,o){t.fireListeners(D.MOUSEENTER_CELL,{col:e.col,row:e.row,related:o}),u=e}function f(e){const o=u;return u=null,o&&t.fireListeners(D.MOUSELEAVE_CELL,{col:o.col,row:o.row,related:e}),o||void 0}function p(e,o){t.fireListeners(D.MOUSEOVER_CELL,{col:e.col,row:e.row,related:o}),d=e}function C(e){const o=d;return d=null,o&&t.fireListeners(D.MOUSEOUT_CELL,{col:o.col,row:o.row,related:e}),o||void 0}const _=n.getElement();e.on(_,"mouseover",(t=>{h=!0})),e.on(_,"mouseout",(t=>{h=!1,C()})),e.on(o,"mouseleave",(t=>{f()})),e.on(o,"mousemove",(e=>{const n=r(e),{abstractPos:i,eventArgs:l}=n;if(l){const e=u;if(e)if(t.fireListeners(D.MOUSEMOVE_CELL,l),e.col!==l.col||e.row!==l.row){const t={col:l.col,row:l.row},e=C(t);g(t,f(t)),h&&p(t,e)}else h&&!d&&p({col:l.col,row:l.row});else{const e={col:l.col,row:l.row};g(e),h&&p(e),t.fireListeners(D.MOUSEMOVE_CELL,l)}}else C(),f();if(t[an].columnResizer.moving(e)||t[an].cellSelector.moving(e))return;const{style:c}=o;if(!i)return void("col-resize"===c.cursor&&(c.cursor=""));const a=zn(t,i.x,i.y);a>=0&&s(a)?c.cursor="col-resize":"col-resize"===c.cursor&&(c.cursor="")})),e.on(o,"click",(e=>{if(t[an].columnResizer.lastMoving(e)||t[an].cellSelector.lastMoving(e))return;if(!t.hasListeners(D.CLICK_CELL))return;const{eventArgs:o}=r(e);o&&t.fireListeners(D.CLICK_CELL,o)})),e.on(o,"contextmenu",(e=>{if(!t.hasListeners(D.CONTEXTMENU_CELL))return;const{eventArgs:o}=r(e);o&&t.fireListeners(D.CONTEXTMENU_CELL,o)})),e.on(o,"dblclick",(e=>{if(!t.hasListeners(D.DBLCLICK_CELL))return;const{eventArgs:o}=r(e);o&&t.fireListeners(D.DBLCLICK_CELL,o)})),t[an].focusControl.onKeyDown((e=>{t.fireListeners(D.KEYDOWN,e)})),t[an].selection.listen(D.SELECTED_CELL,(e=>{t.fireListeners(D.SELECTED_CELL,e,e.selected)})),n.onScroll((e=>{!function(t,e){const o=t[an].scroll.left,n=t[an].scroll.top,r=t[an].scrollable.scrollLeft-o,s=t[an].scrollable.scrollTop-n;t[an].scroll={left:t[an].scrollable.scrollLeft,top:t[an].scrollable.scrollTop};const i=Hn(t);if(Math.abs(r)>=i.width||Math.abs(s)>=i.height)yn(t,i);else{if(t[an].context.drawImage(t[an].canvas,-r,-s),0!==r){const e=i.copy();if(r<0){if(e.width=-r,t[an].frozenColCount>0){const o=Cn(t);e.width+=o.width}}else r>0&&(e.left=e.right-r);yn(t,e),r>0&&t[an].frozenColCount>0&&yn(t,Cn(t))}if(0!==s){const e=i.copy();if(s<0){if(e.height=-s,t[an].frozenRowCount>0){const o=pn(t);e.height+=o.height}}else s>0&&(e.top=e.bottom-s);yn(t,e),s>0&&t[an].frozenRowCount>0&&yn(t,pn(t))}}}(t),t.fireListeners(D.SCROLL,{event:e})})),t[an].focusControl.onKeyDownMove((e=>{On.call(t,e)})),t.listen("copydata",(e=>{const o=t.getCopyRangeInternal(e);let n="";for(let{row:e}=o.start;e<=o.end.row;e++){for(let{col:r}=o.start;r<=o.end.col;r++){const s=t.getCopyCellValue(r,e,o);if("undefined"!=typeof Promise&&s instanceof Promise);else{const t=`${s}`;/^\[object .*\]$/.exec(t)||(n+=t)}r<o.end.col&&(n+="\t")}n+="\n"}return n})),t[an].focusControl.onCopy((e=>a.find(t.fireListeners("copydata",t[an].selection.range),(t=>null!=t)))),t[an].focusControl.onPaste((({value:e,event:o})=>{const n=e.replace(/\r?\n$/,""),{col:r,row:s}=t[an].selection.select,i=/[\r\n\u2028\u2029\t]/.test(n);let l=null;const c={col:r,row:s,value:e,normalizeValue:n,multi:i,get rangeBoxValues(){return l??(l=nn(n))},event:o};t.fireListeners(D.PASTE_CELL,c)})),t[an].focusControl.onInput((e=>{const{col:o,row:n}=t[an].selection.select;t.fireListeners(D.INPUT_CELL,{col:o,row:n,value:e})})),t[an].focusControl.onDelete((e=>{const{col:o,row:n}=t[an].selection.select;t.fireListeners(D.DELETE_CELL,{col:o,row:n,event:e})})),t[an].focusControl.onFocus((e=>{t.fireListeners(D.FOCUS_GRID,e),t[an].focusedGrid=!0;const{col:o,row:n}=t[an].selection.select;t.invalidateCell(o,n)})),t[an].focusControl.onBlur((e=>{t.fireListeners(D.BLUR_GRID,e),t[an].focusedGrid=!1;const{col:o,row:n}=t[an].selection.select;t.invalidateCell(o,n)}))}function zn(t,e,o,n=5){if(t[an].frozenRowCount<=0)return-1;if(!pn(t).inPoint(e,o))return-1;const r=t.getCellAt(e,o),s=t.getCellRect(r.col,r.row);return e<s.left+n?r.col-1:s.right-n<e?r.col:-1}function Hn(t){const{scroll:{left:e,top:o},canvas:{width:n,height:r}}=t[an];return new tn(e,o,n,r)}function $n(t,e){const o=e.copy(),n=Hn(t);return o.offsetLeft(-n.left),o.offsetTop(-n.top),o}class jn{_grid;_handler;_events;_started;_moved;_mouseEndPoint;constructor(t){this._grid=t,this._handler=new at,this._events={},this._started=!1,this._moved=!1}moving(t){return!!this._started}lastMoving(t){if(this.moving(t))return!0;const e=this._mouseEndPoint;if(!e)return!1;const o=Nn(this._grid,t);return null!=o&&o.x===e.x&&o.y===e.y}_bindMoveAndUp(t){const e=this._events,o=this._handler;rn(t)?(e.touchmove=o.on(document.body,"touchmove",(t=>this._mouseMove(t)),{passive:!1}),e.touchend=o.on(document.body,"touchend",(t=>this._mouseUp(t))),e.touchcancel=o.on(document.body,"touchcancel",(t=>this._mouseUp(t)))):(e.mousemove=o.on(document.body,"mousemove",(t=>this._mouseMove(t))),e.mouseup=o.on(document.body,"mouseup",(t=>this._mouseUp(t)))),this._started=!0,this._moved=!1}_mouseMove(t){rn(t)||1===sn(t)?(this._moved=this._moveInternal(t)||this._moved,cn(t)):this._mouseUp(t)}_moveInternal(t){return!1}_mouseUp(t){const e=this._events,o=this._handler;o.off(e.mousemove),o.off(e.touchmove),o.off(e.mouseup),o.off(e.touchend),o.off(e.touchcancel),this._started=!1,this._upInternal(t),this._moved&&(this._mouseEndPoint=Nn(this._grid,t),setTimeout((()=>{this._mouseEndPoint=null}),10))}_upInternal(t){}dispose(){this._handler.dispose()}}class Vn extends jn{_cell;start(t){const e=this._getTargetCell(t);e&&(Fn.call(this._grid,e.col,e.row,t.shiftKey),this._bindMoveAndUp(t),this._cell=e,cn(t),hn(t))}select(t){const e=this._getTargetCell(t);e&&(Fn.call(this._grid,e.col,e.row,t.shiftKey),this._cell=e)}_moveInternal(t){const e=this._getTargetCell(t);if(!e)return!1;const{col:o,row:n}=this._cell,{col:r,row:s}=e;if(o===r&&n===s)return!1;const i=this._grid;Fn.call(i,r,s,!0);const l=r<o&&0<r?r-1:o<r&&r+1<i.colCount?r+1:r,c=s<n&&0<s?s-1:n<s&&s+1<i.rowCount?s+1:s;return l===r&&c===s||i.makeVisibleCell(l,c),this._cell=e,!0}_getTargetCell(t){const e=this._grid,o=Nn(e,t);if(!o)return null;const n=e.getCellAt(o.x,o.y);return n.col<0||n.row<0?null:n}}class Un extends jn{_targetCol;_x=-1;_preX=-1;_invalidateAbsoluteLeft=-1;constructor(t){super(t),this._targetCol=-1}start(t,e){let o;rn(e)?({pageX:o}=e.changedTouches[0]):({pageX:o}=e),this._x=o,this._preX=0,this._bindMoveAndUp(e),this._targetCol=t,this._invalidateAbsoluteLeft=Tn(this._grid,0,t-1),cn(e),hn(e)}_moveInternal(t){const e=(rn(t)?t.changedTouches[0].pageX:t.pageX)-this._x,o=e-this._preX;this._preX=e;const n=this._grid.getColWidth(this._targetCol);let r=xn(this._grid,this._targetCol,n+o);r<10&&o<0&&(r=10),function(t){let e=null;for(let o=0;o<t[an].colCount;o++)Ln(En(t,o))&&Sn(t,o,e||(e=Rn(t,!1)))}(this._grid),Sn(this._grid,this._targetCol,r);const s=Hn(this._grid);return s.left=this._invalidateAbsoluteLeft,yn(this._grid,s),this._grid.fireListeners(D.RESIZE_COLUMN,{col:this._targetCol}),!0}_upInternal(t){const e=this._grid;e.updateScroll()&&e.invalidate()}}function Gn(t,e){const{type:o}=t;t.type="",t.value=e,o&&(t.type=o)}class Kn extends Pt{_grid;_scrollable;_handler;_input;_isComposition;_compositionEnd;_inputStatus;_keyDownMoveCallback;constructor(t,e,o){super(),this._grid=t,this._scrollable=o;const n=this._handler=new at,r=this._input=document.createElement("input");let s;r.classList.add("grid-focus-control"),r.readOnly=!0,e.appendChild(r),n.on(r,"compositionstart",(e=>{r.classList.add("composition"),r.style.font=t.font||"16px sans-serif",this._isComposition=!0,this._compositionEnd&&(clearTimeout(this._compositionEnd),delete this._compositionEnd),t.focus()}));const i=t=>{s=r.value,this._isComposition||(""!==s&&Gn(r,""),t||(s=""))},l=()=>{this._isComposition=!1,r.classList.remove("composition"),r.style.font="";const{value:t}=r;i(!1),r.readOnly||this.fireListeners("input",t),this._compositionEnd&&(clearTimeout(this._compositionEnd),delete this._compositionEnd)};n.on(r,"compositionend",(t=>{this._compositionEnd=window.setTimeout(l,1)})),n.on(r,"keypress",(t=>{if(!this._isComposition){if(!r.readOnly&&t.key&&1===t.key.length)if(t.ctrlKey||t.metaKey)"c"===t.key||t.key;else{if(" "===t.key)return;this.fireListeners("input",t.key),cn(t)}i(!0)}})),n.on(r,"keydown",(t=>{if(this._isComposition)return void(this._compositionEnd&&(l(),cn(t)));const e=ln(t);let o=!1;const n={keyCode:e,event:t,stopCellMoving(){o=!0}};this.fireListeners("keydown",n),!r.readOnly&&s&&this.fireListeners("input",s),o||this.fireKeyDownMove(e,t),!this._grid.keyboardOptions?.deleteCellValueOnDel||46!==e&&8!==e||this.fireListeners("delete",t),i(!0)})),n.on(r,"keyup",(t=>{this._isComposition&&this._compositionEnd&&l(),i(!0)})),n.on(r,"input",(t=>{" "!==t.data&&"　"!==t.data||this.fireListeners("input",t.data),i(!0)})),L&&n.on(document,"keydown",(t=>{if(t.target!==r)return;const e=ln(t);67===e&&t.ctrlKey?(Gn(r,"dummy"),r.select(),setTimeout((()=>{Gn(r,"")}),100)):86===e&&t.ctrlKey&&r.readOnly&&(r.readOnly=!1,setTimeout((()=>{r.readOnly=!0,Gn(r,"")}),10))})),R&&n.once(document,"keydown",(o=>{if(!w(e,o.target))return;const n=document.createElement("input");t.getElement().appendChild(n),n.focus(),r.focus(),n.parentElement?.removeChild(n)})),n.on(document,"paste",(t=>{if(!w(e,t.target))return;let o;if(L)o=window.clipboardData.getData("Text");else{const{clipboardData:e}=t;e.items?o=e.getData("text/plain"):-1!==Array.prototype.indexOf.call(e.types,"text/plain")&&(o=e.getData("Text"))}null!=o&&o.length&&this.fireListeners("paste",{value:o,event:t})})),n.on(document,"copy",(t=>{if(this._isComposition)return;if(!w(e,t.target))return;Gn(r,"");const o=a.find(this.fireListeners("copy"),(t=>null!=t));null!=o&&(cn(t),L?window.clipboardData.setData("Text",o):t.clipboardData.setData("text/plain",o))})),n.on(r,"focus",(t=>{this.fireListeners("focus",t)})),n.on(r,"blur",(t=>{this.fireListeners("blur",t)}))}fireKeyDownMove(t,e){const o=this._keyDownMoveCallback;o&&(this._isComposition||(37===t||38===t||39===t||40===t||36===t||35===t||this._grid.keyboardOptions?.moveCellOnTab&&9===t||this._grid.keyboardOptions?.moveCellOnEnter&&13===t||this._grid.keyboardOptions?.selectAllOnCtrlA&&65===t&&(e.ctrlKey||e.metaKey))&&o(e))}onKeyDownMove(t){this._keyDownMoveCallback=t}onKeyDown(t){return this.listen("keydown",t)}onInput(t){return this.listen("input",t)}onDelete(t){return this.listen("delete",t)}onCopy(t){return this.listen("copy",t)}onPaste(t){return this.listen("paste",t)}onFocus(t){return this.listen("focus",t)}onBlur(t){return this.listen("blur",t)}focus(){this._input.focus()}setFocusRect(t){const e=this._input,o=this._scrollable.calcTop(t.top);e.style.top=`${(o-Qo()).toFixed()}px`,e.style.left=`${t.left.toFixed()}px`,e.style.width=`${t.width.toFixed()}px`,e.style.height=`${t.height.toFixed()}px`}get editMode(){return!this._input.readOnly}set editMode(t){this._input.readOnly=!t}resetInputStatus(){const t=this._input;if(!t.classList.contains("grid-focus-control--stored-status"))return;const e=t.classList.contains("composition"),o=t.attributes,n=[];for(let t=0,e=o.length;t<e;t++){const e=o[t];this._inputStatus?.hasOwnProperty(e.nodeName)||n.push(e.name)}n.forEach((e=>{t.removeAttribute(e)}));for(const e in this._inputStatus)t.setAttribute(e,this._inputStatus[e]);e?(t.classList.add("composition"),t.style.font=this._grid.font||"16px sans-serif"):t.classList.remove("composition"),t.classList.remove("grid-focus-control--stored-status")}storeInputStatus(){const t=this._input;if(t.classList.contains("grid-focus-control--stored-status"))return;const e=this._inputStatus={},o=t.attributes;for(let t=0,n=o.length;t<n;t++){const n=o[t];e[n.name]=n.value}t.classList.add("grid-focus-control--stored-status")}setDefaultInputStatus(){}get input(){return this._input}dispose(){super.dispose(),this._handler.dispose()}}class Yn extends Pt{_grid;_sel;_focus;_start;_end;_isWraped;constructor(t){super(),this._grid=t,this._sel={col:0,row:0},this._focus={col:0,row:0},this._start={col:0,row:0},this._end={col:0,row:0}}get range(){const t=this._start,e=this._end;return{start:{col:Math.min(t.col,e.col),row:Math.min(t.row,e.row)},end:{col:Math.max(t.col,e.col),row:Math.max(t.row,e.row)}}}set range(t){const e=Math.min(t.start.col,t.end.col),o=Math.min(t.start.row,t.end.row),n=Math.max(t.start.col,t.end.col),r=Math.max(t.start.row,t.end.row);this._wrapFireSelectedEvent((()=>{this._sel={col:e,row:o},this._focus={col:e,row:o},this._start={col:e,row:o},this._end={col:n,row:r},Pn.call(this._grid)}))}get focus(){const{col:t,row:e}=this._focus;return{col:t,row:e}}get select(){const{col:t,row:e}=this._sel;return{col:t,row:e}}set select(t){this._wrapFireSelectedEvent((()=>{const{col:e=0,row:o=0}=t;this._setSelectCell(e,o),this._setFocusCell(e,o,!0),Pn.call(this._grid)}))}_setSelectCell(t,e){this._wrapFireSelectedEvent((()=>{this._sel={col:t,row:e},this._start={col:t,row:e}}))}_setFocusCell(t,e,o){this._wrapFireSelectedEvent((()=>{o||this._setSelectCell(t,e),this._focus={col:t,row:e},this._end={col:t,row:e}}))}_wrapFireSelectedEvent(t){if(this._isWraped)t();else{this._isWraped=!0;try{const e={col:this._sel.col,row:this._sel.row,selected:!1,after:null};t();const o={col:this._sel.col,row:this._sel.row,selected:!0,before:{col:e.col,row:e.row}};e.after={col:o.col,row:o.row},this.fireListeners(D.SELECTED_CELL,e),this.fireListeners(D.SELECTED_CELL,o)}finally{this._isWraped=!1}}}_updateGridRange(){const{rowCount:t,colCount:e}=this._grid,o=[this._sel,this._focus,this._start,this._end];let n=!1;for(let r=0;r<o.length;r++)if(e<=o[r].col||t<=o[r].row){n=!0;break}return!!n&&(this._wrapFireSelectedEvent((()=>{o.forEach((o=>{o.col=Math.min(e-1,o.col),o.row=Math.min(t-1,o.row)}))})),!0)}}class Zn{_layers;constructor(){this._layers={}}addDraw(t,e){(this._layers[t]||(this._layers[t]=new Xn(t))).addDraw(e)}draw(t){const e=[];for(const t in this._layers)e.push(this._layers[t]);e.sort(((t,e)=>t.level-e.level)),e.forEach((e=>e.draw(t)))}}class Xn{_level;_list;constructor(t){this._level=t,this._list=[]}get level(){return this._level}addDraw(t){this._list.push(t)}draw(t){this._list.forEach((e=>{t.save();try{e(t)}finally{t.restore()}}))}}class qn{_col;_row;_mode;_ctx;_rect;_drawRect;_drawing;_selection;_drawLayers;_childContexts;_cancel;_grid;_onTerminate;_rectFilter=null;constructor(t,e,o,n,r,s,i,l){this._col=t,this._row=e,this._mode=0,this._ctx=o,this._rect=n,this._drawRect=r,this._drawing=s,this._selection=i,this._drawLayers=l,this._childContexts=[]}get drawing(){return 0!==this._mode||this._drawing}get row(){return this._row}get col(){return this._col}cancel(){this._cancel=!0,this._childContexts.forEach((t=>{t.cancel()}))}getSelection(){return{select:this._selection.select,range:this._selection.range}}getContext(){return 0===this._mode?this._ctx:mn.call(this._grid)}getRect(){const t=this._rectFilter;return t?t(this._getRectInternal()):this._getRectInternal()}setRectFilter(t){this._rectFilter=t}getDrawRect(){if(this._cancel)return null;if(0===this._mode)return this._drawRect;{if(this._isOutOfRange())return null;const t=this._grid.getCellRect(this._col,this._row);return this._toRelativeDrawRect(t)}}_isOutOfRange(){const{colCount:t,rowCount:e}=this._grid;return t<=this._col||e<=this._row}toCurrentContext(){if(0===this._mode)return this;{const t=this._grid.getCellRect(this._col,this._row),e=$n(this._grid,t),o=this._isOutOfRange()?null:this._toRelativeDrawRect(t),n=new qn(this._col,this._row,this.getContext(),e,o,this.drawing,this._selection,this._drawLayers);return n.toCurrentContext=this.toCurrentContext.bind(this),this._childContexts.push(n),this._cancel&&n.cancel(),n._rectFilter=this._rectFilter,n}}addLayerDraw(t,e){this._drawLayers.addDraw(t,e)}_toRelativeDrawRect(t){const e=Hn(this._grid);let o=t.copy();if(!o.intersection(e))return null;const n=this._grid,r=n.isFrozenCell(this._col,this._row);if(n.frozenColCount>=0&&(!r||!r.col)){const t=n.getCellRect(n.frozenColCount-1,this._row);o=tn.bounds(Math.max(o.left,t.right),o.top,o.right,o.bottom)}if(n.frozenRowCount>=0&&(!r||!r.row)){const t=n.getCellRect(this._col,n.frozenRowCount-1);o=tn.bounds(o.left,Math.max(o.top,t.bottom),o.right,o.bottom)}return o.intersection(e)?(o.offsetLeft(-e.left),o.offsetTop(-e.top),o):null}_delayMode(t,e){this._mode=1,this._ctx=null,this._rect=null,this._drawRect=null,this._grid=t,this._onTerminate=e}terminate(){0!==this._mode&&this._onTerminate?.()}_getRectInternal(){return 0===this._mode||this._rect?this._rect:this._grid.getCellRelativeRect(this._col,this._row)}}const Qn=an;class Jn extends Pt{[Qn];static get EVENT_TYPE(){return D}constructor(t={}){super();const{rowCount:e=10,colCount:o=10,frozenColCount:n=0,frozenRowCount:r=0,defaultRowHeight:s=40,defaultColWidth:i=80,font:l,underlayBackgroundColor:c,keyboardOptions:a,parentElement:h,disableColumnResize:u}=t,d=this[an]={};qo(),qo=Function.prototype,d.element=function(){const t=document.createElement("div");return t.classList.add("cheetah-grid"),t}(),d.scrollable=new on,d.handler=new at,d.selection=new Yn(this),d.focusControl=new Kn(this,d.scrollable.getElement(),d.scrollable),d.canvas=function(t){const e=t.getContext("2d"),{getAttribute:o,setAttribute:n}=t;t.getAttribute=function(t){let e=o.call(this,t);return"width"!==t&&"height"!==t||(e=""+Number(e)/Zo),e},t.setAttribute=function(t,o){const r="width"===t||"height"===t;r&&(o=""+Number(o)*Zo);const s=n.call(this,t,o);return r&&e.scale(Zo,Zo),s},Object.defineProperty(t,"width",{get:()=>Number(t.getAttribute("width")),set:e=>{t.setAttribute("width",`${Math.floor(e)}`)},configurable:!0,enumerable:!0}),Object.defineProperty(t,"height",{get:()=>Number(t.getAttribute("height")),set:e=>{t.setAttribute("height",`${Math.floor(e)}`)},configurable:!0,enumerable:!0});const{drawImage:r}=e;return e.drawImage=function(e,...o){if(e!==t||1===Zo)return r.call(this,e,...o);this.save();try{return this.scale(1/Zo,1/Zo),o.length>4?(o[4]*=Zo,o[5]*=Zo):(o[0]*=Zo,o[1]*=Zo),r.call(this,e,...o)}finally{this.restore()}},t}(document.createElement("canvas")),d.context=d.canvas.getContext("2d",{alpha:!1}),d.rowCount=e,d.colCount=o,d.frozenColCount=n,d.frozenRowCount=r,d.defaultRowHeight=s,d.defaultColWidth=i,d.font=l,d.underlayBackgroundColor=c,d.keyboardOptions=a,d.disableColumnResize=u,d.rowHeightsMap=new Jo,d.colWidthsMap=new Jo,d.colWidthsLimit={},d.calcWidthContext={_:d,get full(){return this._.canvas.width},get em(){return Ve(this._.context,this._.font).width}},d.columnResizer=new Un(this),d.cellSelector=new Vn(this),d.drawCells={},d.cellTextOverflows={},d.focusedGrid=!1,d.element.appendChild(d.canvas),d.element.appendChild(d.scrollable.getElement()),d.scroll={left:0,top:0},this.updateScroll(),h?(h.appendChild(d.element),this.updateSize()):this.updateSize(),Wn.call(this),this.bindEventsInternal()}getElement(){return this[an].element}get canvas(){return this[an].canvas}focus(){const{col:t,row:e}=this[an].selection.select;this.focusCell(t,e)}hasFocusGrid(){return this[an].focusedGrid}get selection(){return this[an].selection}get rowCount(){return this[an].rowCount}set rowCount(t){if(this[an].rowCount=t,this.updateScroll(),this[an].selection._updateGridRange()){const{col:t,row:e}=this[an].selection.focus;this.makeVisibleCell(t,e),this.setFocusCursor(t,e)}}get colCount(){return this[an].colCount}set colCount(t){if(this[an].colCount=t,this.updateScroll(),this[an].selection._updateGridRange()){const{col:t,row:e}=this[an].selection.focus;this.makeVisibleCell(t,e),this.setFocusCursor(t,e)}}get frozenColCount(){return this[an].frozenColCount}set frozenColCount(t){this[an].frozenColCount=t}get frozenRowCount(){return this[an].frozenRowCount}set frozenRowCount(t){this[an].frozenRowCount=t}get defaultRowHeight(){return this[an].defaultRowHeight}set defaultRowHeight(t){this[an].defaultRowHeight=t}get defaultColWidth(){return this[an].defaultColWidth}set defaultColWidth(t){this[an].defaultColWidth=t}get font(){return this[an].font}set font(t){this[an].font=t}get underlayBackgroundColor(){return this[an].underlayBackgroundColor}set underlayBackgroundColor(t){this[an].underlayBackgroundColor=t}get keyboardOptions(){return this[an].keyboardOptions??null}set keyboardOptions(t){this[an].keyboardOptions=t??void 0}configure(t,e){const o=this[an].config||(this[an].config={});return null!=e&&(o[t]=e),o[t]}updateSize(){const{canvas:t}=this[an];t.style.width="",t.style.height="";const e=Math.floor(t.offsetWidth||t.parentElement.offsetWidth-Qo()),o=Math.floor(t.offsetHeight||t.parentElement.offsetHeight-Qo());t.width=e,t.height=o,t.style.width=`${e}px`,t.style.height=`${o}px`;const n=this[an].selection.select;this[an].focusControl.setFocusRect(this.getCellRect(n.col,n.row))}updateScroll(){const{scrollable:t}=this[an],e=Dn.call(this),o=Tn(n=this,0,n[an].colCount-1);var n;return(e!==t.scrollHeight||o!==t.scrollWidth)&&(t.setScrollSize(o,e),this[an].scroll={left:t.scrollLeft,top:t.scrollTop},!0)}getRowHeight(t){return An.call(this,t)}setRowHeight(t,e){!function(t,e,o){t[an].rowHeightsMap.put(e,o)}(this,t,e)}getColWidth(t){return Mn(this,t)}setColWidth(t,e){Sn(this,t,e)}getMaxColWidth(t){const e=this[an].colWidthsLimit[t];return e&&e.max||void 0}setMaxColWidth(t,e){(this[an].colWidthsLimit[t]||(this[an].colWidthsLimit[t]={})).max=e}getMinColWidth(t){const e=this[an].colWidthsLimit[t];return e&&e.min||void 0}setMinColWidth(t,e){(this[an].colWidthsLimit[t]||(this[an].colWidthsLimit[t]={})).min=e}getCellRect(t,e){const o=this.isFrozenCell(t,e);let n=Tn(this,0,t-1);const r=Mn(this,t);o&&o.col&&(n+=this[an].scroll.left);let s=kn.call(this,0,e-1);const i=An.call(this,e);return o&&o.row&&(s+=this[an].scroll.top),new tn(n,s,r,i)}getCellRelativeRect(t,e){return $n(this,this.getCellRect(t,e))}getCellsRect(t,e,o,n){const r=this.isFrozenCell(t,e),s=this.isFrozenCell(o,n);let i=Tn(this,0,t-1),l=Tn(this,t,o);if(r&&r.col){const e=this[an].scroll.left;i+=e,s&&s.col||(l-=e,l=Math.max(l,Tn(this,t,this.frozenColCount-1)))}let c=kn.call(this,0,e-1),a=kn.call(this,e,n);if(r&&r.row){const t=this[an].scroll.top;c+=t,s&&s.row||(a-=t,a=Math.max(a,Tn(this,e,this.frozenRowCount-1)))}return new tn(i,c,l,a)}getCellRangeRect(t){return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row)}isFrozenCell(t,e){const{frozenRowCount:o,frozenColCount:n}=this[an],r=o>0&&e<o,s=n>0&&t<n;return r||s?{row:r,col:s}:null}getRowAt(t){const e=gn(this,t);if(e)return e.row;const o=un.call(this,t);return o?o.row:-1}getColAt(t){const e=fn(this,t);if(e)return e.col;const o=dn(this,t);return o?o.col:-1}getCellAt(t,e){return{row:this.getRowAt(e),col:this.getColAt(t)}}makeVisibleCell(t,e){const o=this.isFrozenCell(t,e);if(o&&o.col&&o.row)return;const n=this.getCellRect(t,e),r=function(t){let e=0;t[an].frozenColCount>0&&(e=Cn(t).width);let o=0;t[an].frozenRowCount>0&&(o=pn(t).height);return new tn(t[an].scrollable.scrollLeft+e,t[an].scrollable.scrollTop+o,t[an].canvas.width-e,t[an].canvas.height-o)}(this);if(r.contains(n))return;const{scrollable:s}=this[an];o&&o.col||(n.left<r.left?s.scrollLeft-=r.left-n.left:r.right<n.right&&(s.scrollLeft-=r.right-n.right)),o&&o.row||(n.top<r.top?s.scrollTop-=r.top-n.top:r.bottom<n.bottom&&(s.scrollTop-=r.bottom-n.bottom))}setFocusCursor(t,e){const{focusControl:o}=this[an],n=o.editMode;o.setFocusRect(this.getCellRect(t,e)),Pn.call(this),n&&!o.editMode&&o.resetInputStatus()}focusCell(t,e){this.setFocusCursor(t,e),this[an].focusControl.focus()}invalidateCell(t,e){this.invalidateGridRect(t,e)}invalidateGridRect(t,e,o=t,n=e){const r=this.getOffsetInvalidateCells();r>0&&(t-=r,e-=r,o+=r,n+=r);const s=Hn(this),i=this.getCellsRect(t,e,o,n),l=s.intersection(i);if(l){const{frozenColCount:t,frozenRowCount:e}=this[an];if(t>0&&o>=t){const t=Cn(this);t.intersection(l)&&(l.left=Math.min(t.right-1,l.left))}if(e>0&&n>=e){const t=pn(this);t.intersection(l)&&(l.top=Math.min(t.bottom-1,l.top))}yn(this,l)}}invalidateCellRange(t){this.invalidateGridRect(t.start.col,t.start.row,t.end.col,t.end.row)}invalidate(){yn(this,Hn(this))}get visibleRowCount(){const{frozenRowCount:t}=this,e=Hn(this),o=t>0?e.top+kn.call(this,0,t-1):e.top,n=un.call(this,o);if(!n)return 0;const r=Math.max(n.top>=o?n.row:n.row+1,t);let s=kn.call(this,0,r-1),i=0;const{rowCount:l}=this;for(let t=r;t<l;t++){const o=s+An.call(this,t);if(e.bottom<o)break;i++,s=o}return i}get visibleColCount(){const{frozenColCount:t}=this,e=Hn(this),o=t>0?e.left+Tn(this,0,t-1):e.left,n=dn(this,o);if(!n)return 0;const r=Math.max(n.left>=o?n.col:n.col+1,t);let s=Tn(this,0,r-1),i=0;const{colCount:l}=this;for(let t=r;t<l;t++){const o=s+Mn(this,t);if(e.right<o)break;i++,s=o}return i}get topRow(){const{frozenRowCount:t}=this,e=Hn(this),o=t>0?e.top+kn.call(this,0,t-1):e.top,n=un.call(this,o);return n?Math.max(n.top>=o?n.row:n.row+1,t):0}get leftCol(){const{frozenColCount:t}=this,e=Hn(this),o=t>0?e.left+Tn(this,0,t-1):e.left,n=dn(this,o);return n?Math.max(n.left>=o?n.col:n.col+1,t):0}get scrollTop(){return this[an].scrollable.scrollTop}set scrollTop(t){this[an].scrollable.scrollTop=t}get scrollLeft(){return this[an].scrollable.scrollLeft}set scrollLeft(t){this[an].scrollable.scrollLeft=t}getCopyCellValue(t,e,o){}getCellOverflowText(t,e){const o=`${t}:${e}`;return this[an].cellTextOverflows[o]||null}setCellOverflowText(t,e,o){const n=`${t}:${e}`;o?this[an].cellTextOverflows[n]="string"==typeof o?o.trim():o:delete this[an].cellTextOverflows[n]}addDisposable(t){if(!t||!t.dispose||"function"!=typeof t.dispose)throw new Error("not disposable!");(this[an].disposables=this[an].disposables||[]).push(t)}dispose(){super.dispose();const t=this[an];t.handler.dispose(),t.scrollable.dispose(),t.focusControl.dispose(),t.columnResizer.dispose(),t.cellSelector.dispose(),t.disposables&&(t.disposables.forEach((t=>t.dispose())),t.disposables=null);const{parentElement:e}=t.element;e&&e.removeChild(t.element)}getAttachCellsArea(t){return{element:this.getElement(),rect:$n(this,this.getCellRangeRect(t))}}onKeyDownMove(t){On.call(this,t)}bindEventsInternal(){}getTargetRowAtInternal(t){}getRowsHeightInternal(t,e){}getRowHeightInternal(t){}getScrollHeightInternal(t){}getMoveLeftColByKeyDownInternal({col:t}){return t-1}getMoveRightColByKeyDownInternal({col:t}){return t+1}getMoveUpRowByKeyDownInternal({row:t}){return t-1}getMoveDownRowByKeyDownInternal({row:t}){return t+1}getOffsetInvalidateCells(){return 0}getCopyRangeInternal(t){return t}_getInitContext(){const t=this[an].context;return t.fillStyle="white",t.strokeStyle="black",t.textAlign="left",t.textBaseline="top",t.lineWidth=1,t.font=this.font||"16px sans-serif",t}fireListeners(t,...e){return super.fireListeners(t,...e)}}const tr={DrawGrid:Jn,EVENT_TYPE:D},{ceil:er,PI:or}=Math;function nr(t,e,o,n,r,s){e[0]===e[1]&&e[0]===e[2]&&e[0]===e[3]?e[0]&&(t.strokeStyle=e[0],t.strokeRect(o,n,r,s)):function(o){for(let n=0;n<e.length;n++){const r=e[n],s=e[n-1];if(r){if(s!==r){s&&(t.strokeStyle=s,t.stroke());const e=o[n];t.beginPath(),t.moveTo(e.x,e.y)}const e=o[n+1];t.lineTo(e.x,e.y)}else s&&(t.strokeStyle=s,t.stroke())}const n=e[e.length-1];n&&(t.strokeStyle=n,t.stroke())}([{x:o,y:n},{x:o+r,y:n},{x:o+r,y:n+s},{x:o,y:n+s},{x:o,y:n}])}function rr(t,e,o,n,r,s){t.beginPath(),t.arc(e+s,o+s,s,-or,-.5*or,!1),t.arc(e+n-s,o+s,s,-.5*or,0,!1),t.arc(e+n-s,o+r-s,s,0,.5*or,!1),t.arc(e+s,o+r-s,s,.5*or,or,!1),t.closePath()}function sr(t,e,o,n,r,s){rr(t,e,o,n,r,s),t.fill()}function ir(t,e,o,n,r,s){rr(t,e,o,n,r,s),t.stroke()}function lr(t,e,o,n,r){const s=Math.min(n,r)/2;t.beginPath(),t.arc(e+s,o+s,s,0,2*Math.PI),t.closePath(),t.fill()}function cr(t,e,o,n,r){const s=Math.min(n,r)/2;t.beginPath(),t.arc(e+s,o+s,s,0,2*Math.PI),t.closePath(),t.stroke()}function ar(t,e,o,n,r,s,{offset:i=2,padding:l}={}){const c={left:o,top:n,width:r,height:s,right:o+r,bottom:n+s};t.save();try{t.beginPath(),t.rect(c.left,c.top,c.width,c.height),t.clip();const o=function(t,e,{offset:o=0,padding:{left:n=0,right:r=0,top:s=0,bottom:i=0}={}}={}){return Ue(t,e,0,0,{offset:o,padding:{left:n,right:r,top:s,bottom:i}})}(t,c,{offset:i,padding:l});t.fillText(e,o.x,o.y)}finally{t.restore()}}function hr(t,e,o,n,r,s,i,l,c,a,h,u,{offset:d=2,padding:g}={}){const f={left:c,top:a,width:h,height:u,right:c+h,bottom:a+u};t.save();try{t.beginPath(),t.rect(f.left,f.top,f.width,f.height),t.clip();const c=Ue(t,f,i,l,{offset:d,padding:g});t.drawImage(e,o,n,r,s,c.x,c.y,i,l)}finally{t.restore()}}function ur(t){return{width:Ve(t,null).width}}function dr(t){return{width:Ve(t,null).width}}function gr(t,e,o,n,{uncheckBgColor:r="#FFF",checkBgColor:s="rgb(76, 73, 72)",borderColor:i="#000",boxSize:l=ur(t).width}={}){const c="number"==typeof n?n>1?1:n:1;t.save();try{t.fillStyle=n?s:r;const a=er(e),h=er(o),u=er(l);if(sr(t,a-1,h-1,u+1,u+1,l/5),t.lineWidth=1,t.strokeStyle=i,ir(t,a-.5,h-.5,u,u,l/5),n){t.lineWidth=er(l/10),t.strokeStyle=r;let n=l/4,s=l/2*.9;const i=e+.2*l,a=o+l/2;c<.5&&(n*=2*c),t.beginPath(),t.moveTo(i,a),t.lineTo(i+n,a+n),c>.5&&(c<1&&(s*=2*(c-.5)),t.lineTo(i+n+s,a+n-s)),t.stroke()}}finally{t.restore()}}function fr(t,e,o,n,{checkColor:r="rgb(76, 73, 72)",borderColor:s="#000",bgColor:i="#FFF",boxSize:l=dr(t).width}={}){const c="number"==typeof n?n>1?1:n:1;t.save();try{t.fillStyle=i;const a=er(e),h=er(o),u=er(l);if(lr(t,a-1,h-1,u+1,u+1),t.lineWidth=1,t.strokeStyle=s,cr(t,a-.5,h-.5,u,u),n){const e=u*c/2,o=(u-e)/2;t.fillStyle=r,lr(t,er(100*(a-.5+o))/100,er(100*(h-.5+o))/100,er(100*e)/100,er(100*e)/100)}}finally{t.restore()}}function pr(t,e,o,n,r,s={}){const{backgroundColor:i="#FFF",bgColor:l=i,radius:c=4,shadow:a={}}=s;t.save();try{if(t.fillStyle=l,a){const{color:e="rgba(0, 0, 0, 0.24)",blur:o=1,offsetX:n=0,offsetY:r=2,offset:{x:s=n,y:i=r}={}}=a;t.shadowColor=e,t.shadowBlur=o,t.shadowOffsetX=s,t.shadowOffsetY=i}sr(t,er(e),er(o),er(n),er(r),c)}finally{t.restore()}}const Cr={drawButton:pr,drawCheckbox:gr,drawInlineImageRect:hr,drawRadioButton:fr,fillRoundRect:sr,fillTextRect:ar,measureCheckbox:ur,measureRadioButton:dr,roundRect:rr,strokeColorsRect:nr,strokeRoundRect:ir,fillCircle:lr,strokeCircle:cr},_r={canvasHelper:Cr},wr=U();function mr(t,e,o,n){return y(t,...o)||y(e,...o)||n&&y(t,...n)||n&&y(e,...n)}class yr{[wr];_checkbox=null;_radioButton=null;_button=null;_header=null;_messages=null;constructor(t,e){this[wr]={obj:t,superTheme:e}}get font(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["underlayBackgroundColor"])}get color(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["color"])}get frozenRowsColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["frozenRowsColor"],["color"])}get defaultBgColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["defaultBgColor"])}get frozenRowsBgColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["frozenRowsBgColor"],["defaultBgColor"])}get selectionBgColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["selectionBgColor"],["defaultBgColor"])}get highlightBgColor(){if(this.hasProperty(["highlightBgColor"])){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["highlightBgColor"])}return t=>{const e=t.row<t.grid.frozenRowCount?this.frozenRowsBgColor:this.defaultBgColor;return"function"==typeof e?e(t):e}}get borderColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["borderColor"])}get frozenRowsBorderColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["frozenRowsBorderColor"],["borderColor"])}get highlightBorderColor(){const{obj:t,superTheme:e}=this[wr];return mr(t,e,["highlightBorderColor"],["borderColor"])}get checkbox(){const{obj:t,superTheme:e}=this[wr];return this._checkbox||(this._checkbox={get uncheckBgColor(){return mr(t,e,["checkbox","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return mr(t,e,["checkbox","checkBgColor"],["borderColor"])},get borderColor(){return mr(t,e,["checkbox","borderColor"],["borderColor"])}})}get radioButton(){const{obj:t,superTheme:e}=this[wr];return this._radioButton||(this._radioButton={get checkColor(){return mr(t,e,["radioButton","checkColor"],["color"])},get uncheckBorderColor(){return mr(t,e,["radioButton","uncheckBorderColor"],["borderColor"])},get checkBorderColor(){return mr(t,e,["radioButton","checkBorderColor"],["borderColor"])},get uncheckBgColor(){return mr(t,e,["radioButton","uncheckBgColor"],["defaultBgColor"])},get checkBgColor(){return mr(t,e,["radioButton","checkBgColor"],["defaultBgColor"])}})}get button(){const{obj:t,superTheme:e}=this[wr];return this._button||(this._button={get color(){return mr(t,e,["button","color"],["color"])},get bgColor(){return mr(t,e,["button","bgColor"],["defaultBgColor"])}})}get header(){const{obj:t,superTheme:e}=this[wr];return this._header||(this._header={get sortArrowColor(){return mr(t,e,["header","sortArrowColor"],["color"])}})}get messages(){const{obj:t,superTheme:e}=this[wr];return this._messages||(this._messages={get infoBgColor(){return mr(t,e,["messages","infoBgColor"])},get errorBgColor(){return mr(t,e,["messages","errorBgColor"])},get warnBgColor(){return mr(t,e,["messages","warnBgColor"])}})}hasProperty(t){const{obj:e,superTheme:o}=this[wr];return br(e,t)||br(o,t)}extends(t){return new yr(t,this)}}function br(t,e){if(t instanceof yr)return t.hasProperty(e);{let o=t;if(!o)return!1;for(let t=0;t<e.length;t++){if(o=o[e[t]],!o)return!1}return!!o}}const xr={};const vr={color:"rgba(0, 0, 0, 0.87)",frozenRowsColor:"rgba(0, 0, 0, 0.54)",defaultBgColor:"#FFF",selectionBgColor:"#CCE0FF",borderColor:function(t){const{col:e,row:o,grid:n}=t,{colCount:r,frozenColCount:s,recordRowCount:i}=n;let l="#ccc7c7",c="#ccc7c7";if(i>1){const t=n.getRecordStartRowByRecordIndex(n.getRecordIndexByRow(o));t!==o&&(l=null),t+i-1!==o&&(c=null)}return s-1===e||r-1===e?[l,"#f2f2f2",c,null]:[l,null,c,null]},frozenRowsBorderColor:function(t){const{row:e,grid:{frozenRowCount:o}}=t;return o-1===e?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]},highlightBorderColor:"#5E9ED6",checkbox:{checkBgColor:"rgb(76, 73, 72)",borderColor:"rgba(0, 0, 0, 0.26)"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"rgb(76, 73, 72)",uncheckBorderColor:"rgb(189, 189, 189)"},button:{color:"#FFF",bgColor:"#2196F3"},header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},underlayBackgroundColor:"#FFF"},Er={},Ir=new yr({color:"#000",defaultBgColor:function(t){const{row:e,grid:o}=t;return e<o.frozenRowCount?"#FFF":1&o.getRecordIndexByRow(e)?"#F6F6F6":"#FFF"},frozenRowsBgColor:function(t){const{col:e,grid:o,grid:{frozenRowCount:n},context:r}=t,{left:s,top:i}=o.getCellRelativeRect(e,0),{bottom:l}=o.getCellRelativeRect(e,n-1);return function(t,e,o,n,r,s){let i;const l=[];for(i in s)l.push(`${i}@${s[i]}`);const c=`${e}/${o}/${n}/${r}/${l.join(",")}`,a=xr[c];if(a)return a;const h=t.createLinearGradient(e,o,e,r);for(i in s)h.addColorStop(Number(i),s[i]);return xr[c]=h}(r,s,i,s,l,{0:"#FFF",1:"#D3D3D3"})},selectionBgColor:"#CCE0FF",borderColor:"#000",highlightBorderColor:"#5E9ED6",checkbox:{uncheckBgColor:"#FFF",checkBgColor:"rgb(76, 73, 72)",borderColor:"#000"},radioButton:{checkColor:"rgb(76, 73, 72)",checkBorderColor:"#000",uncheckBorderColor:"#000",uncheckBgColor:"#FFF",checkBgColor:"#FFF"},button:{color:"#FFF",bgColor:"#2196F3"},header:{sortArrowColor:"rgba(0, 0, 0, 0.38)"},underlayBackgroundColor:"#F6F6F6"}),Lr=new yr(vr),Rr={BASIC:Ir,MATERIAL_DESIGN:Lr};let Br=Lr;function Mr(t){if(!t)return null;if("string"==typeof t){const e=function(t,e){if(t[e])return t[e];const o=e.toLowerCase();if(t[o])return t[o];const n=e.toLowerCase();if(t[n])return t[n];for(const e in t)if(e.toLowerCase()===o)return t[e]}(Tr(),t);return e||null}return t instanceof yr?t:new yr(t)}function Sr(){return Br}function Tr(){return _(Rr,Er)}const Ar={BASIC:Ir,MATERIAL_DESIGN:Lr,theme:{Theme:yr},of:Mr,getDefault:Sr,getChoices:Tr};function kr(t,e,o){return new Promise((n=>{const r=[],s=new Array(o);for(let e=0;e<o;e++){const o=t(e),n={v:o,f:o};s[e]=n,x(o)&&r.push(o.then((t=>{n.v=t,n.f=t})))}Promise.all(r).then((()=>null==e?s:function(t,e){return new Promise((o=>{const{length:n}=t,r=[];for(let o=0;o<n;o++){const n=t[o],s=e(n.v);x(s)?r.push(s.then((t=>{n.f=t}))):n.f=s}Promise.all(r).then((()=>o(t)))}))}(s,e))).then(n)}))}function Dr(t,e,o,n,r){const s=function(t,e){const o=new Array(e);for(let n=0;n<e;n++)o[n]=t(n);return o}(t,o);null!=r?s.sort(((t,e)=>n(r(t),r(e)))):s.sort(n);for(let t=0;t<o;t++)e(t,s[t])}function Or(t){return!!(M.isObject(t)&&t.get&&t.set)}const Fr={UPDATE_LENGTH:"update_length",UPDATED_LENGTH:"updated_length",UPDATED_ORDER:"updated_order"};function Pr(t,e){const o=b(t);if(x(o)){const t=o.then((t=>(e(t),t)));return e(t),t}return o}function Nr(t,e,o){if(null==t)return;if(x(t))return t.then((t=>Nr(t,e,o)));const n=Or(e)?e.get:e;if(n in t){return Pr(t[n],o)}if("function"==typeof n){return Pr(n(t),o)}const r=`${n}`.split(".");if(r.length<=1){return Pr(t[n],o)}return Pr(m(t,((t,e)=>Nr(t,e,k)),...r),o)}function Wr(t,e,o){if(null==t)return!1;const n=Or(e)?e.set:e;if(n in t)t[n]=o;else{if("function"==typeof n)return n(t,o);if("string"==typeof n){const e=`${n}`.split(".");let r=t;const{length:s}=e;for(let t=0;t<s;t++){const n=e[t];t===s-1?r[n]=o:r=r[n]||(r[n]={})}}else t[n]=o}return!0}function zr(t,e){if(!t)return e;const o=t[e];return null!=o?o:e}class Hr extends Pt{_get;_length;_source;_sortedIndexMap=null;static get EVENT_TYPE(){return Fr}static ofArray(t){return new Hr({get:e=>t[e],length:t.length,source:t})}constructor(t){super(),this._get=t?.get.bind(t)||void 0,this._length=t?.length||0,this._source=t?.source??t}get source(){return this._source}get(t){return this.getOriginal(zr(this._sortedIndexMap,t))}getField(t,e){return this.getOriginalField(zr(this._sortedIndexMap,t),e)}hasField(t,e){return this.hasOriginalField(zr(this._sortedIndexMap,t),e)}setField(t,e,o){return this.setOriginalField(zr(this._sortedIndexMap,t),e,o)}sort(t,e){const o=new Array(this._length),n="desc"!==e?(t,e)=>t===e?0:t>e?1:-1:(t,e)=>t===e?0:t<e?1:-1;return function(t,e,o,n,r){if("undefined"!=typeof Promise)return kr(t,r,o).then((t=>{t.sort(((t,e)=>n(t.f,e.f)));for(let n=0;n<o;n++)e(n,t[n].v)}));{Dr(t,e,o,n,r);const s={then:t=>(t(),s),catch:()=>s};return s}}((t=>null!=o[t]?o[t]:o[t]=t),((t,e)=>{o[t]=e}),this._length,n,(e=>this.getOriginalField(e,t))).then((()=>{this._sortedIndexMap=o,this.fireListeners(Fr.UPDATED_ORDER)}))}get length(){return this._length}set length(t){if(this._length===t)return;const e=this.fireListeners(Fr.UPDATE_LENGTH,t);a.findIndex(e,(t=>!t))>=0||(this._length=t,this.fireListeners(Fr.UPDATED_LENGTH,this._length))}get dataSource(){return this}dispose(){super.dispose()}getOriginal(t){return Pr(this._get(t),(e=>{this.recordPromiseCallBackInternal(t,e)}))}getOriginalField(t,e){if(null==e)return;return Nr(this.getOriginal(t),e,(o=>{this.fieldPromiseCallBackInternal(t,e,o)}))}hasOriginalField(t,e){if(null==e)return!1;if("function"==typeof e)return!0;const o=this.getOriginal(t);return Boolean(o&&e in o)}setOriginalField(t,e,o){if(null==e)return!1;const n=this.getOriginal(t);return x(n)?n.then((t=>Wr(t,e,o))):Wr(n,e,o)}fieldPromiseCallBackInternal(t,e,o){}recordPromiseCallBackInternal(t,e){}static EMPTY=new Hr({get(){},length:0})}class $r extends Hr{_rCache;_fCache;static get EVENT_TYPE(){return Hr.EVENT_TYPE}static ofArray(t){return new $r({get:e=>t[e],length:t.length,source:t})}constructor(t){super(t),this._rCache={},this._fCache={}}getOriginal(t){return this._rCache&&this._rCache[t]?this._rCache[t]:super.getOriginal(t)}getOriginalField(t,e){const o=this._fCache&&this._fCache[t];if(o){const t=o.get(e);if(t)return t}return super.getOriginalField(t,e)}setOriginalField(t,e,o){const n=this._fCache;return n&&n[t]&&delete n[t],super.setOriginalField(t,e,o)}clearCache(){this._rCache&&(this._rCache={}),this._fCache&&(this._fCache={})}fieldPromiseCallBackInternal(t,e,o){!function(t,e,o,n){(t[e]||(t[e]=new Map)).set(o,n)}(this._fCache,t,e,o)}recordPromiseCallBackInternal(t,e){this._rCache[t]=e}dispose(){super.dispose()}}class jr{_disabled;constructor(t={}){this._disabled=!!t.disabled||!1}get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.onChangeDisabledInternal()}clone(){return new jr(this)}bindGridEvent(t,e){return[]}onChangeDisabledInternal(){}}function Vr(t,e,{action:o,mouseOver:n,mouseOut:r}){function s(o,n){return t.getLayoutCellId(o,n)===e}let i;return[t.listen(D.CLICK_CELL,(t=>{s(t.col,t.row)&&o({col:t.col,row:t.row})})),t.listen(D.MOUSEOVER_CELL,(e=>{s(e.col,e.row)&&(n&&!n({col:e.col,row:e.row})||(t.getElement().style.cursor="pointer",i=!0))})),t.listen(D.MOUSEMOVE_CELL,(e=>{s(e.col,e.row)&&i&&!t.getElement().style.cursor&&(t.getElement().style.cursor="pointer")})),t.listen(D.MOUSEOUT_CELL,(e=>{s(e.col,e.row)&&(r&&r({col:e.col,row:e.row}),t.getElement().style.cursor="",i=!1)}))]}function Ur(t,e,{action:o,acceptKeys:n=[]}){return n=[...n,13,32],[t.listen(D.KEYDOWN,(r=>{if(-1===n.indexOf(r.keyCode))return;if(t.keyboardOptions?.moveCellOnEnter&&13===r.keyCode)return;const s=t.selection.select;var i,l;(i=s.col,l=s.row,t.getLayoutCellId(i,l)===e)&&(o({col:s.col,row:s.row}),T.cancel(r.event))}))]}const Gr=X();class Kr extends jr{clone(){return new Kr(this)}bindGridEvent(t,e){const o=function(t){let e=t[Gr];return e||(e={elapsed:{},block:{}},M.setReadonly(t,Gr,e)),e}(t),n=({col:e,row:n})=>{const r=t.getCellRange(e,n),s=`${r.start.col}:${r.start.row}`;if(this.disabled||o.block[s])return;const i=t.getHeaderValue(r.start.col,r.start.row);t.setHeaderValue(r.start.col,r.start.row,!i);rt(200,(e=>{1===e?delete o.elapsed[s]:o.elapsed[s]=e,t.invalidateCellRange(r)}))};return[...Vr(t,e,{action:n,mouseOver:e=>{if(this.disabled)return!1;o.mouseActiveCell={col:e.col,row:e.row};const n=t.getCellRange(e.col,e.row);return t.invalidateCellRange(n),!0},mouseOut:e=>{delete o.mouseActiveCell;const n=t.getCellRange(e.col,e.row);t.invalidateCellRange(n)}}),...Ur(t,e,{action:n})]}}class Yr extends jr{_sort;constructor(t={}){super(t),this._sort=t.sort??!0}get sort(){return this._sort}set sort(t){this._sort=t,this.onChangeDisabledInternal()}clone(){return new Yr(this)}_executeSort(t,e){if("function"==typeof this._sort)this._sort({order:t.order||"asc",col:t.col,row:t.row,grid:e});else{const o=Math.min(e.recordRowCount-1,t.row)+e.frozenRowCount,n=e.getField(t.col,o);if(null==n)return;e.dataSource.sort(n,t.order||"asc")}}bindGridEvent(t,e){return[...Vr(t,e,{action:o=>{if(this.disabled)return;const n=t.sortState;let r;const s=t.getCellRange(o.col,o.row);var i,l;i=n.col,l=o.row,r=t.getLayoutCellId(i,l)===e?{col:s.start.col,row:s.start.row,order:"asc"===n.order?"desc":"asc"}:{col:s.start.col,row:s.start.row,order:"asc"},t.sortState=r,this._executeSort(r,t),t.invalidateGridRect(0,0,t.colCount-1,t.rowCount-1)},mouseOver:t=>!this.disabled})]}}class Zr extends Yr{get disabled(){return this._disabled}}const Xr={SORT:new Zr,CHECK:new class extends Kr{get disabled(){return this._disabled}}};function qr(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return Xr[e]||qr(null)}return t}}function Qr(t){if(t.sort){if("function"==typeof t.sort){const e=t.sort;return new Zr({sort:({order:o,col:n,grid:r})=>e.call(t,o,n,r)})}return Xr.SORT}return qr(t.headerAction)}const Jr={CHANGE_STYLE:"change_style"};let ts,es,os,ns,rs,ss;class is extends Pt{_bgColor;static get EVENT_TYPE(){return Jr}static get DEFAULT(){return ts||(ts=new is)}constructor({bgColor:t}={}){super(),this._bgColor=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t,this.doChangeStyle()}doChangeStyle(){this.fireListeners(Jr.CHANGE_STYLE)}clone(){return new is(this)}}class ls extends is{_textAlign;_textBaseline;static get DEFAULT(){return es||(es=new ls)}constructor(t={}){super(t),this._textAlign=t.textAlign||"left",this._textBaseline=t.textBaseline||"middle"}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t,this.doChangeStyle()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.doChangeStyle()}clone(){return new ls(this)}}class cs extends ls{_color;_font;_textOverflow;static get DEFAULT(){return os||(os=new cs)}constructor(t={}){super(t),this._color=t.color,this._font=t.font,this._textOverflow=t.textOverflow||"ellipsis"}get color(){return this._color}set color(t){this._color=t,this.doChangeStyle()}get font(){return this._font}set font(t){this._font=t,this.doChangeStyle()}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t,this.doChangeStyle()}clone(){return new cs(this)}}class as extends cs{_uncheckBgColor;_checkBgColor;_borderColor;static get DEFAULT(){return ns||(ns=new as)}constructor(t={}){super(C(t,{textAlign:"center"}));const{uncheckBgColor:e,checkBgColor:o,borderColor:n}=t;this._uncheckBgColor=e,this._checkBgColor=o,this._borderColor=n}get uncheckBgColor(){return this._uncheckBgColor}set uncheckBgColor(t){this._uncheckBgColor=t,this.doChangeStyle()}get checkBgColor(){return this._checkBgColor}set checkBgColor(t){this._checkBgColor=t,this.doChangeStyle()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.doChangeStyle()}clone(){return new as(this)}}class hs extends cs{_lineHeight;_autoWrapText;_lineClamp;static get DEFAULT(){return rs||(rs=new hs)}constructor(t={}){super(t),this._lineHeight=t.lineHeight||"1em",this._autoWrapText=t.autoWrapText||!1,this._lineClamp=t.lineClamp}clone(){return new hs(this)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.doChangeStyle()}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t,this.doChangeStyle()}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t,this.doChangeStyle()}}class us extends cs{_sortArrowColor;static get DEFAULT(){return ss||(ss=new us)}constructor(t={}){super(t),this._sortArrowColor=t.sortArrowColor}get sortArrowColor(){return this._sortArrowColor}set sortArrowColor(t){this._sortArrowColor=t,this.doChangeStyle()}clone(){return new us(this)}}function ds(t,e){return t?t instanceof cs?t:"function"==typeof t?ds(t(),e):new e(t):e.DEFAULT}class gs{constructor(t={}){this.onDrawCell=this.onDrawCell.bind(this)}get StyleClass(){return is}onDrawCell(t,e,o,n){const{style:r,drawCellBase:s}=e,i=n.getGridCanvasHelper();s(),this.drawInternal(this.convertInternal(t),o,ds(r,this.StyleClass),i,n,e)}convertInternal(t){return"function"==typeof t&&(t=t()),null!=t?`${t}`:""}bindGridEvent(t,e){return[]}}const fs=X();class ps extends gs{get StyleClass(){return as}clone(){return new ps(this)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,borderColor:c,checkBgColor:a,uncheckBgColor:h,bgColor:u,color:d,font:g,textOverflow:f}=o;u&&s({bgColor:u});const{col:p,row:C}=e,_=r.getCellRange(p,C),w=`${_.start.col}:${_.start.row}`,{elapsed:{[w]:m}}=function(t){let e=t[fs];return e||(e={elapsed:{},block:{}},M.setReadonly(t,fs,e)),e}(r),y=r.getHeaderValue(_.start.col,_.start.row),b={textAlign:i,textBaseline:l,borderColor:c,checkBgColor:a,uncheckBgColor:h};null!=m&&(b.animElapsedTime=m);const x=n.buildCheckBoxInline(!!y,e,b);n.text([x,t],e,{textAlign:i,textBaseline:l,color:d,font:g,textOverflow:f})}}class Cs extends gs{get StyleClass(){return cs}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,color:c,font:a,bgColor:h,textOverflow:u}=o;h&&s({bgColor:h}),n.text(t,e,{textAlign:i,textBaseline:l,color:c,font:a,textOverflow:u})}}class _s extends gs{get StyleClass(){return hs}clone(){return new _s(this)}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l,color:c,font:a,bgColor:h,lineHeight:u,autoWrapText:d,lineClamp:g,textOverflow:f}=o;h&&s({bgColor:h});const p=t.replace(/\r?\n/g,"\n").replace(/\r/g,"\n").split("\n");n.testFontLoad(a,t,e),n.multilineText(p,e,{textAlign:i,textBaseline:l,color:c,font:a,lineHeight:u,autoWrapText:d,lineClamp:g,textOverflow:f})}}class ws extends gs{get StyleClass(){return us}drawInternal(t,e,o,n,r,{drawCellBase:s}){const{textAlign:i,textBaseline:l="middle",color:c,bgColor:a,font:h,textOverflow:u,sortArrowColor:d}=o;a&&s({bgColor:a});const g=r.sortState;let f;const{col:p,row:C}=e;I(r.getCellRange(p,C),g.col,g.row)&&({order:f}=g);const _=e.getContext(),w=1.2*Ve(_,h).width;n.text(t,e,{textAlign:i,textBaseline:l,color:c,font:h,textOverflow:u,icons:[{name:null!=f?"asc"===f?"arrow_downward":"arrow_upward":void 0,width:w,color:n.getColor(d||n.theme.header.sortArrowColor,p,C,_)||"rgba(0, 0, 0, 0.38)"}]})}}const ms={DEFAULT:new Cs,SORT:new ws,CHECK:new ps,MULTILINETEXT:new _s};function ys(t){if(t){if("string"==typeof t){const e=t.toUpperCase();return ms[e]||ys(null)}return t}return ms.DEFAULT}function bs(t){return t.sort?ms.SORT:ys(t.headerType)}let xs=-1;class vs{headers=[];columns=[];getHeader(t,e){const o=this.headers[e]||(this.headers[e]=[]);return o[t]||(o[t]={id:xs--,define:{},headerType:ys(null)})}getBody(t,e){const o=this.columns[e]||(this.columns[e]=[]);return o[t]||(o[t]={id:xs--,define:{},columnType:Oo.type.of(null),style:null})}}let Es=0;class Is{_headerObjects;_headerObjectMap;_headerCellIds;_columns;bodyRowCount=1;_emptyDataCache=new vs;constructor(t){this._columns=[],this._headerCellIds=[],this._headerObjects=this._addHeaders(0,t,[]),this._headerObjectMap=this._headerObjects.reduce(((t,e)=>(t[e.id]=e,t)),{})}get columnWidths(){return this._columns}get headerRowCount(){return this._headerCellIds.length}get colCount(){return this._columns.length}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}getCellId(t,e){return this.headerRowCount<=e?this._columns[t].id:this._headerCellIds[e][t]}getHeader(t,e){const o=this.getCellId(t,e);return this._headerObjectMap[o]||this._emptyDataCache.getHeader(t,e)}getBody(t,e){return this._columns[t]||this._emptyDataCache.getBody(t,0)}getBodyLayoutRangeById(t){for(let e=0;e<this.colCount;e++)if(t===this._columns[e].id)return{start:{col:e,row:0},end:{col:e,row:0}};throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){const o={start:{col:t,row:e},end:{col:t,row:e}};if(this.headerRowCount<=e)return o;const n=this.getCellId(t,e);for(let r=t-1;r>=0&&n===this.getCellId(r,e);r--)o.start.col=r;for(let r=t+1;r<this.colCount&&n===this.getCellId(r,e);r++)o.end.col=r;for(let r=e-1;r>=0&&n===this.getCellId(t,r);r--)o.start.row=r;for(let r=e+1;r<this.headerRowCount&&n===this.getCellId(t,r);r++)o.end.row=r;return o}getRecordIndexByRow(t){return t<this.headerRowCount?-1:t-this.headerRowCount}getRecordStartRowByRecordIndex(t){return this.headerRowCount+t}_addHeaders(t,e,o){const n=[],r=this._headerCellIds[t]||this._newRow(t);return e.forEach((e=>{const s=this._columns.length,i=Es++,l={id:i,caption:e.caption,field:e.headerField||e.field,style:e.headerStyle,headerType:bs(e),action:Qr(e),define:e};n[i]=l,r[s]=i;for(let e=t-1;e>=0;e--)this._headerCellIds[e][s]=o[e];if(e.columns)this._addHeaders(t+1,e.columns,[...o,i]).forEach((t=>n.push(t)));else{const o=e;this._columns.push({id:Es++,field:o.field,width:o.width,minWidth:o.minWidth,maxWidth:o.maxWidth,icon:o.icon,message:o.message,columnType:Oo.type.of(o.columnType),action:Oo.action.of(o.action),style:o.style,define:o});for(let e=t+1;e<this._headerCellIds.length;e++)this._headerCellIds[e][s]=i}})),n}_newRow(t){const e=this._headerCellIds[t]=[];if(!this._columns.length)return e;const o=this._headerCellIds[t-1];for(let t=0;t<o.length;t++)e[t]=o[t];return e}}let Ls=0;class Rs{objects=[];objectGrid=[];objectMap={};columnCount=0;columnWidths=[];constructor(t,e){t.forEach(((t,o)=>{let n=0;t.forEach((t=>{const r=Ls++,s=e(t,r);this.objects.push(s),this.objectMap[r]=s,n=this._findStartCell(n,o);const i=Number(t.rowSpan??1),l=Number(t.colSpan??1),c=o+i,a=n+l;for(let t=o;t<c;t++){const e=this._getObjectGridRow(t);for(let t=n;t<a;t++)e[t]=s}1===l&&this._setWidthDataIfAbsent(n,t),this._useColumnIndex(a-1),n=a}))}))}get rowCount(){return this.objectGrid.length}_findStartCell(t,e){const o=this._getObjectGridRow(e);for(let e=t;e<o.length;e++)if(!o[e])return e;return o.length}_getObjectGridRow(t){return this.objectGrid[t]||(this.objectGrid[t]=[])}_useColumnIndex(t){this.columnCount>t||(this.columnCount=t+1)}_setWidthDataIfAbsent(t,e){this.columnWidths[t]||null==e.width&&null==e.maxWidth&&null==e.minWidth||(this.columnWidths[t]={width:e.width,maxWidth:e.maxWidth,minWidth:e.minWidth})}}class Bs{_header;_body;_columnWidths=[];_columnCount;_emptyDataCache=new vs;constructor(t){const e=function(t){return Array.isArray(t)?{header:t,body:t}:t}(t),o=this._header=new Rs(e.header,((t,e)=>({id:e,caption:t.caption,field:t.headerField||t.field,style:t.headerStyle,headerType:bs(t),action:Qr(t),define:t}))),n=this._body=new Rs(e.body,((t,e)=>({id:e,field:t.field,width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth,icon:t.icon,message:t.message,columnType:Oo.type.of(t.columnType),action:Oo.action.of(t.action),style:t.style,define:t}))),r=this._columnCount=Math.max(o.columnCount,n.columnCount);for(let t=0;t<r;t++){const e=o.columnWidths[t]||n.columnWidths[t]||{};this._columnWidths[t]=e}}get columnWidths(){return this._columnWidths}get headerRowCount(){return this._header.rowCount}get bodyRowCount(){return this._body.rowCount}get colCount(){return this._columnCount}get headerObjects(){return this._header.objects}get columnObjects(){return this._body.objects}getCellId(t,e){if(this.headerRowCount<=e){const o=(e-this.headerRowCount)%this.bodyRowCount;return this._body.objectGrid[o]?.[t]?.id}return this._header.objectGrid[e]?.[t]?.id}getHeader(t,e){const o=this.getCellId(t,e);return this._header.objectMap[o]||this._emptyDataCache.getHeader(t,e)}getBody(t,e){const o=this.getCellId(t,e);return this._body.objectMap[o]||this._emptyDataCache.getBody(t,e)}getBodyLayoutRangeById(t){for(let e=0;e<this.bodyRowCount;e++){const o=this._body.objectGrid[e];if(o)for(let n=0;n<this.colCount;n++)if(t===o[n]?.id)return this._getCellRange(this._body,n,e,0)}throw new Error(`can not found body layout @id=${t}`)}getCellRange(t,e){if(this.headerRowCount<=e){const o=this.getRecordIndexByRow(e),n=this.getRecordStartRowByRecordIndex(o),r=(e-this.headerRowCount)%this.bodyRowCount;return this._getCellRange(this._body,t,r,n)}return this._getCellRange(this._header,t,e,0)}getRecordIndexByRow(t){if(t<this.headerRowCount)return-1;{const e=t-this.headerRowCount;return Math.floor(e/this.bodyRowCount)}}getRecordStartRowByRecordIndex(t){return this.headerRowCount+t*this.bodyRowCount}_getCellRange(t,e,o,n){const r={start:{col:e,row:o+n},end:{col:e,row:o+n}},{objectGrid:s}=t,i=s[o]?.[e]?.id;if(null==i)return r;for(let t=e-1;t>=0&&i===s[o]?.[t]?.id;t--)r.start.col=t;for(let n=e+1;n<t.columnCount&&i===s[o]?.[n]?.id;n++)r.end.col=n;for(let t=o-1;t>=0&&i===s[t]?.[e]?.id;t--)r.start.row=t+n;for(let l=o+1;l<t.rowCount&&i===s[l]?.[e]?.id;l++)r.end.row=l+n;return r}}function Ms(t,e,o){const{bgColor:n,color:r}=e,s=t.getContext(),i=t.getRect();s.fillStyle=n;const l=i.copy();l.left=l.right-24,s.fillRect(l.left,l.top,l.width,l.height-1);const c=r,a=l.left+(l.width-4)/2,h=l.top+(l.height-20)/2;o.fillRectWithState(new tn(a,h,4,12),t,{fillColor:c}),o.fillRectWithState(new tn(a,h+16,4,4),t,{fillColor:c})}class Ss{_grid;_messageElement=null;constructor(t){this._grid=t}dispose(){this.detachMessageElement(),this._messageElement&&this._messageElement.dispose(),this._messageElement=null}_getMessageElement(){return this._messageElement||(this._messageElement=this.createMessageElementInternal())}attachMessageElement(t,e,o){this._getMessageElement().attach(this._grid,t,e,o)}moveMessageElement(t,e){this._getMessageElement().move(this._grid,t,e)}detachMessageElement(){this._getMessageElement()._detach()}drawCellMessage(t,e,o,n,r,s){this.drawCellMessageInternal(t,e,o,n,r,s)}}const Ts="cheetah-grid__message-element",As=`${Ts}__message`,ks=`${Ts}--hidden`,Ds=`${Ts}--shown`;class Os{_handler;_rootElement;_messageElement;constructor(){this._handler=new at;const t=this._rootElement=function(){const t=ht("div",{classList:[Ts,ks]}),e=ht("span",{classList:[As]});return t.appendChild(e),t}();this._messageElement=t.querySelector(`.${As}`)}dispose(){this.detach(),this._handler.dispose(),delete this._rootElement,delete this._messageElement}attach(t,e,o,n){const r=this._rootElement,s=this._messageElement;r.classList.remove(Ds),r.classList.add(ks),this._attachCell(t,e,o)?(r.classList.add(Ds),r.classList.remove(ks),s.textContent=n.message):this._detach()}move(t,e,o){const n=this._rootElement;this._attachCell(t,e,o)?(n.classList.add(Ds),n.classList.remove(ks)):this._detach()}detach(){this._detach()}_detach(){const t=this._rootElement;t.parentElement&&(t.parentElement.removeChild(t),t.classList.remove(Ds),t.classList.add(ks))}_attachCell(t,e,o){const n=this._rootElement,{element:r,rect:s}=t.getAttachCellsArea(t.getCellRange(e,o)),{bottom:i,left:l,width:c}=s,{frozenRowCount:a,frozenColCount:h}=t;if(o>=a&&a>0){const{rect:o}=t.getAttachCellsArea(t.getCellRange(e,a-1));if(i<o.bottom)return!1}else if(i<0)return!1;if(e>=h&&h>0){const{rect:e}=t.getAttachCellsArea(t.getCellRange(h-1,o));if(l<e.right)return!1}else if(l<0)return!1;const{offsetHeight:u,offsetWidth:d}=r;return!(u<i)&&(!(d<l)&&(n.style.top=`${i.toFixed()}px`,n.style.left=`${l.toFixed()}px`,n.style.width=`${c.toFixed()}px`,n.parentElement!==r&&r.appendChild(n),!0))}}const Fs="cheetah-grid__error-message-element",Ps=`${Fs}__message`;class Ns extends Os{constructor(){super(),this._rootElement.classList.add(Fs),this._messageElement.classList.add(Ps)}}class Ws extends Ss{createMessageElementInternal(){return new Ns}drawCellMessageInternal(t,e,o,n,r,s){const{bgColor:i}=o,{select:l}=e.getSelection();I(r.getCellRange(e.col,e.row),l.col,l.row)&&r.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{Ms(e,{bgColor:n.getColor(n.theme.messages.errorBgColor,e.col,e.row,t)||"#ff8a80",color:i},n)}))}}class zs extends Ss{createMessageElementInternal(){return new Os}drawCellMessageInternal(t,e,o,n,r,s){const{bgColor:i}=o,{select:l}=e.getSelection();I(r.getCellRange(e.col,e.row),l.col,l.row)&&r.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{!function(t,e,o){const{bgColor:n,color:r}=e,s=t.getContext(),i=t.getRect();s.fillStyle=n;const l=i.copy();l.left=l.right-24,s.fillRect(l.left,l.top,l.width,l.height-1);const c=r,a=l.left+(l.width-4)/2,h=l.top+(l.height-20)/2;o.fillRectWithState(new tn(a,h,4,4),t,{fillColor:c}),o.fillRectWithState(new tn(a,h+8,4,12),t,{fillColor:c})}(e,{bgColor:n.getColor(n.theme.messages.infoBgColor,e.col,e.row,t)||"#e0e0e0",color:i},n)}))}}const Hs=_(D,{CHANGED_VALUE:"changed_value",CHANGED_HEADER_VALUE:"changed_header_value"}),$s="cheetah-grid__warning-message-element",js=`${$s}__message`;class Vs extends Os{constructor(){super(),this._rootElement.classList.add($s),this._messageElement.classList.add(js)}}class Us extends Ss{createMessageElementInternal(){return new Vs}drawCellMessageInternal(t,e,o,n,r,s){const{bgColor:i}=o,{select:l}=e.getSelection();I(r.getCellRange(e.col,e.row),l.col,l.row)&&r.hasFocusGrid()||n.drawBorderWithClip(e,(t=>{Ms(e,{bgColor:n.getColor(n.theme.messages.warnBgColor,e.col,e.row,t)||"#ff9e80",color:i},n)}))}}const Gs={type:"error",message:null},Ks={error:t=>new Ws(t),info:t=>new zs(t),warning:t=>new Us(t)};function Ys(t){if(!t||x(t))return Gs;if("string"==typeof t)return{type:"error",message:t,original:t};const e=t.type||"error";return e&&e in Ks?{type:e.toLowerCase(),message:t.message,original:t}:{type:"error",message:`${t}`,original:t}}function Zs(t){return!!Ys(t).message}class Xs{_grid;_messageInstances;_attachInfo=null;constructor(t,e){this._grid=t,this._messageInstances={},this._bindGridEvent(t,e)}dispose(){const t=this._messageInstances;for(const e in t)t[e]?.dispose();delete this._messageInstances,delete this._attachInfo}drawCellMessage(t,e,o,n,r,s){if(!Zs(t))return;this._getMessageInstanceOfMessage(t).drawCellMessage(Ys(t),e,o,n,r,s)}_attach(t,e,o){const n=this._attachInfo,r=this._getMessageInstanceOfMessage(o);n&&n.instance!==r&&n.instance.detachMessageElement(),r.attachMessageElement(t,e,Ys(o)),this._attachInfo={col:t,row:e,instance:r}}_move(t,e){const o=this._attachInfo;if(!o||o.col!==t||o.row!==e)return;const{instance:n}=o;n.moveMessageElement(t,e)}_detach(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e.detachMessageElement(),this._attachInfo=null}_bindGridEvent(t,e){const o=o=>{const n=t=>{Zs(t)?this._attach(o.col,o.row,t):this._detach()},r=e(o.col,o.row);if(x(r))return this._detach(),void r.then((e=>{const r=t.selection.select;r.col===o.col&&r.row===o.row&&n(e)}));n(r)};t.listen(Hs.SELECTED_CELL,(t=>{t.selected&&(t.before.col===t.col&&t.before.row===t.row||o(t))})),t.listen(Hs.SCROLL,(()=>{const e=t.selection.select;this._move(e.col,e.row)})),t.listen(Hs.CHANGED_VALUE,(e=>{const n=t.selection.select;n.col===e.col&&n.row===e.row&&o(e)})),t.listen(Hs.FOCUS_GRID,(e=>{const n=t.selection.select;o(n)})),t.listen(Hs.BLUR_GRID,(t=>{this._detach()}))}_getMessageInstanceOfMessage(t){const e=this._messageInstances,{type:o}=Ys(t);return e[o]||(e[o]=Ks[o](this._grid))}}class qs{el_;constructor(t,e){const o=document.createElement("span");o.setAttribute("aria-hidden","true"),o.textContent=e||"BESbswy",function(t){return[{display:"block",position:"absolute",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0","white-space":"nowrap",font:t},{"font-variant":"normal","font-size":"300px","font-style":"normal","font-weight":"400","line-height":"normal"}]}(t).forEach((t=>{for(const e in t){const n=e;o.style[n]=t[n]}})),document.body.appendChild(o),this.el_=o}getWidth(){return this.el_.offsetWidth}remove(){document.body.removeChild(this.el_)}}const Qs={SERIF:"serif",SANS_SERIF:"sans-serif"},Js={};class ti{activeCallbacks;inactiveCallbacks;status;lastResortWidths_;fontRulerA_;fontRulerB_;started_;static async load(t,e,o,n){const r=Js[t]||(Js[t]={});let s;e+="",s=await r[e]?r[e]:r[e]=new ti(t,e),s.then(o,n)}constructor(t,e){this.activeCallbacks=[],this.inactiveCallbacks=[],this.status=null,this.lastResortWidths_={},this.fontRulerA_=new qs(`${t},${Qs.SERIF}`,e),this.fontRulerB_=new qs(`${t},${Qs.SANS_SERIF}`,e);const o=new qs(`4px ${Qs.SERIF}`,e),n=new qs(`4px ${Qs.SANS_SERIF}`,e);this.lastResortWidths_[Qs.SERIF]=o.getWidth(),this.lastResortWidths_[Qs.SANS_SERIF]=n.getWidth(),o.remove(),n.remove(),this.started_=Date.now(),this.check_()}then(t,e){this.status?"ng"!==this.status?t():e():(this.activeCallbacks.push(t),this.inactiveCallbacks.push(e))}check_(){const t=this.fontRulerA_.getWidth(),e=this.fontRulerB_.getWidth();this.isFallbackFont_(t,e)||this.isLastResortFont_(t,e)?Date.now()-this.started_>=3e3?this.isLastResortFont_(t,e)?(this.finish_(this.activeCallbacks),this.status="ok"):(this.finish_(this.inactiveCallbacks),this.status="ng"):setTimeout((()=>{this.check_()}),50):(this.finish_(this.activeCallbacks),this.status="ok")}isFallbackFont_(t,e){return this.widthMatches_(t,Qs.SERIF)&&this.widthMatches_(e,Qs.SANS_SERIF)}widthsMatchLastResortWidths_(t,e){for(const o in Qs)if(Qs.hasOwnProperty(o)&&this.widthMatches_(t,Qs[o])&&this.widthMatches_(e,Qs[o]))return!0;return!1}widthMatches_(t,e){return t===this.lastResortWidths_[e]}isLastResortFont_(t,e){return function(){if(null===ei){const t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);ei=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)}return ei}()&&this.widthsMatchLastResortWidths_(t,e)}finish_(t){setTimeout((()=>{this.fontRulerA_.remove(),this.fontRulerB_.remove(),t.forEach((t=>t()))}),0)}}let ei=null;const oi=ti,ni={};let ri,si;if(i)ri=function(t,e,o){o()},si=function(){return!1};else{const t=document.fonts,e=!t;ri=e?function(t,e,o){ni[`${t} @ ${e}`]?o():oi.load(t,e,(()=>{ni[`${t} @ ${e}`]=!0,o()}),(()=>{ni[`${t} @ ${e}`]=!0,o()}))}:function(e,o,n){ni.all||ni[e]?n():(t.ready.then((()=>{ni.all=!0})),t.load(e).then((()=>{ni[e]=!0,n()})))},si=e?function(t,e){return!!ni[`${t} @ ${e}`]||(ri(t,e,(()=>{})),!1)}:function(e,o){return!(!ni.all&&!ni[e])||(!!t.check(e)||(ri(e,o,(()=>{})),!1))}}const ii={},li=new DOMParser;function ci(t,e){for(let o=0;o<t.childNodes.length;o++){const n=t.childNodes[o];if(1!==n.nodeType)continue;if(e(n))return n;const r=ci(n,e);if(r)return r}return null}const ai=class{_svg;_glyphs;_glyphUnis;_fontFace;_font;constructor(t){const e=li.parseFromString(t,"image/svg+xml");this._svg=e.documentElement,this._glyphs={},this._glyphUnis={}}get svg(){return this._svg}get fontFaceElement(){return this._fontFace||(this._fontFace=this.findElement((t=>"font-face"===t.tagName.toLowerCase()))),this._fontFace}get fontElement(){return this._font||(this._font=this.findElement((t=>"font"===t.tagName.toLowerCase()))),this._font}findElement(t){return ci(this.svg,t)}findGlyph(t){return this._glyphs[t]||(this._glyphs[t]=this.findElement((e=>e.getAttribute("glyph-name")===t)))}findGlyphByUnicode(t){return this._glyphUnis[t]||(this._glyphUnis[t]=this.findElement((e=>e.getAttribute("unicode")===t)))}walkAllGlyph(t){const e=(t,o)=>{for(let n=0;n<t.childNodes.length;n++){const r=t.childNodes[n];if(1!==r.nodeType)continue;const s=r.getAttribute("unicode");if(s&&r.getAttribute("d")){this._glyphUnis[s]||(this._glyphUnis[s]=r);const t=r.getAttribute("glyph-name");t&&!this._glyphs[t]&&(this._glyphs[t]=r),o(r)}else e(r,o)}};e(this.svg,t)}};function hi(t){let e="";switch(t.tagName.toLowerCase()){case"path":case"glyph":e=function(t){return"none"===t.getAttribute("fill")?"":t.getAttribute("d").replace(/[\n\r]/g,"")}(t);break;case"circle":e=function(t){const e=Number(t.getAttribute("cx")),o=Number(t.getAttribute("cy")),n=Number(t.getAttribute("r")),r=2*Math.PI/8,s=t=>n*Math.cos(t),i=t=>n*Math.sin(t),l=t=>s(t)+n*Math.tan(r/2)*Math.cos(t-Math.PI/2),c=t=>i(t)+n*Math.tan(r/2)*Math.sin(t-Math.PI/2);let a=`M${e+n} ${o}`;for(let t=1;t<=8;t++){const n=t*r;a+=`Q${l(n)+e} ${c(n)+o} ${s(n)+e} ${i(n)+o}`}return a}(t);break;case"polygon":e=`M${t.getAttribute("points")}z`;break;case"polyline":e=`M${t.getAttribute("points")}`;break;case"g":for(let o=0;o<t.childNodes.length;o++){const n=t.childNodes[o];1===n.nodeType&&(n.getAttribute("fill")||n.setAttribute("fill",t.getAttribute("fill")),e+=hi(n))}break;default:window.console.warn(`unsupported:${t.tagName}`,`@ ${t.innerHTML}`)}return e}function ui(t={}){const e={d:t.d||"",html:t.html||"",height:t.height||0,width:t.width||0};return t.isGlyph&&(e.ud=!0),void 0!==t.offsetX&&(e.offsetX=t.offsetX),void 0!==t.offsetY&&(e.offsetY=t.offsetY),e}const di=(t,e={})=>e.glyphName||e.unicode?function(t,e){const o=new ai(t),n=o.fontFaceElement||{getAttribute:t=>null},r=o.fontElement||{getAttribute:t=>null},s=e.glyphName?o.findGlyph(e.glyphName):e.unicode?o.findGlyphByUnicode(e.unicode):void 0,i=Number(r.getAttribute("horiz-adv-x"))||0,l=Number(r.getAttribute("vert-adv-x"))||0,c=Number(s.getAttribute("horiz-adv-x"))||i||0,a=Number(s.getAttribute("vert-adv-x"))||l||0,h=Number(n.getAttribute("units-per-em"))||1e3;let u=h;const d=a||h,g=c||h;c>u&&(u=c),a>u&&(u=a);let f=0,p=-(Number(n.getAttribute("descent"))||a);return f+=Math.round((u-g)/2),p+=Math.round((u-d)/2),ui({d:hi(s),height:u,html:s.outerHTML,isGlyph:!0,offsetX:f,offsetY:p,width:u})}(t,e):function(t){const e=new ai(t).svg,o=(e.getAttribute("viewBox")||"").split(" "),n=Number(e.getAttribute("width")||o[2])||0,r=Number(e.getAttribute("height")||o[3])||0,s=0-Number(o[0])||0,i=0-Number(o[1])||0;let l="";for(let t=0;t<e.childNodes.length;t++){const o=e.childNodes[t];1===o.nodeType&&(l+=hi(o))}return ui({d:l,height:r,html:t,offsetX:s,offsetY:i,width:n})}(t),gi={add:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij48cGF0aCBkPSJNMzggMjZIMjZ2MTJoLTRWMjZIMTB2LTRoMTJWMTBoNHYxMmgxMnY0eiIvPjwvc3ZnPg=="),arrowDownward:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij48cGF0aCBmaWxsPSIjMDEwMTAxIiBkPSJNNDAgMjRsLTIuODItMi44MkwyNiAzMi4zNFY4aC00djI0LjM0TDEwLjg0IDIxLjE2IDggMjRsMTYgMTYgMTYtMTZ6Ii8+PC9zdmc+"),arrowUpward:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij48cGF0aCBkPSJNOCAyNGwyLjgzIDIuODNMMjIgMTUuNjZWNDBoNFYxNS42NmwxMS4xNyAxMS4xN0w0MCAyNCAyNCA4IDggMjR6Ii8+PC9zdmc+"),edit:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4Ij48cGF0aCBkPSJNNiAzNC41VjQyaDcuNWwyMi4xMy0yMi4xMy03LjUtNy41TDYgMzQuNXptMzUuNDEtMjAuNDFjLjc4LS43OC43OC0yLjA1IDAtMi44M2wtNC42Ny00LjY3Yy0uNzgtLjc4LTIuMDUtLjc4LTIuODMgMGwtMy42NiAzLjY2IDcuNSA3LjUgMy42Ni0zLjY2eiIvPjwvc3ZnPg=="),star:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTIgMTcuMjdMMTguMTggMjFsLTEuNjQtNy4wM0wyMiA5LjI0bC03LjE5LS42MUwxMiAyIDkuMTkgOC42MyAyIDkuMjRsNS40NiA0LjczTDUuODIgMjF6Ii8+PC9zdmc+"),starBorder:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjIgOS4yNGwtNy4xOS0uNjJMMTIgMiA5LjE5IDguNjMgMiA5LjI0bDUuNDYgNC43M0w1LjgyIDIxIDEyIDE3LjI3IDE4LjE4IDIxbC0xLjYzLTcuMDNMMjIgOS4yNHpNMTIgMTUuNGwtMy43NiAyLjI3IDEtNC4yOC0zLjMyLTIuODggNC4zOC0uMzhMMTIgNi4xbDEuNzEgNC4wNCA0LjM4LjM4LTMuMzIgMi44OCAxIDQuMjhMMTIgMTUuNHoiLz48L3N2Zz4="),starHalf:di("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjIgOS4yNGwtNy4xOS0uNjJMMTIgMiA5LjE5IDguNjMgMiA5LjI0bDUuNDYgNC43M0w1LjgyIDIxIDEyIDE3LjI3IDE4LjE4IDIxbC0xLjYzLTcuMDNMMjIgOS4yNHpNMTIgMTUuNFY2LjFsMS43MSA0LjA0IDQuMzguMzgtMy4zMiAyLjg4IDEgNC4yOEwxMiAxNS40eiIvPjwvc3ZnPg==")},fi={get:()=>_(gi,ii)};function pi(){return"undefined"==typeof Path2D||R?o(748).w:Path2D}function Ci(t,e){return t.measureText(e).width}function _i(t,e,o,n,r){const s=[];let i=o.next();for(let t=0;t<n&&null!==i;t++,i=o.next())s.push(i);let l=Ci(t,s.join(""));if(l>r)for(;s.length;){if(l-=Ci(t,s.pop()||""),l<=r)break}else if(l<r)for(;null!==i;){const e=Ci(t,i);if(l+e>r)break;s.push(i),l+=e,i=o.next()}const c=s.join("").replace(/\s+$/,""),a=e.slice(c.length).replace(/^\s+/,"");return{before:c?new wi(c):null,after:a?new wi(a):null}}class wi{_content;constructor(t){this._content=null!=t?t:""}width({ctx:t}){return Ci(t,this._content)}font(){return null}color(){return null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){e.fillTextRect(t,this._content,o.left,o.top,o.width,o.height,{offset:n+1,padding:{left:r,right:s,top:i,bottom:l}})}canBreak(){return!!this._content}splitIndex(t){const e=this._content,o=S.genChars(e),n=[];let r=o.next();for(let e=0;e<t&&null!==r;e++,r=o.next())n.push(r);const s=n.join(""),i=e.slice(s.length);return{before:s?new wi(s):null,after:i?new wi(i):null}}breakWord(t,e){const o=this._content,n=this.width({ctx:t}),r=Math.floor(this._content.length*e/n);return _i(t,o,S.genWords(o),r,e)}breakAll(t,e){const o=this._content,n=this.width({ctx:t}),r=Math.floor(this._content.length*e/n);return _i(t,o,S.genChars(o),r,e)}toString(){return this._content}}class mi extends wi{_draw;_width;_color;constructor({draw:t,width:e,color:o}){super(),this._draw=t,this._width=e,this._color=o}width(t){return this._width}font(){return null}color(){return this._color??null}canDraw(){return!0}onReady(t){}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){this._draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l})}canBreak(){return!1}toString(){return""}}class yi extends wi{_icon;constructor(t){super(),this._icon=t||{}}width({ctx:t}){const e=this._icon;if(e.width)return e.width;if(e.font&&si(e.font,e.content||"")){t.save(),t.canvas.style.letterSpacing="normal";try{return t.font=e.font||t.font,t.measureText(e.content||"").width}finally{t.canvas.style.letterSpacing="",t.restore()}}return 0}font(){return this._icon.font??null}color(){return this._icon.color??null}canDraw(){const t=this._icon;return!t.font||si(t.font,t.content||"")}onReady(t){const e=this._icon;e.font&&!si(e.font,e.content||"")&&ri(e.font,e.content||"",t)}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){const c=this._icon;if(c.content){t.canvas.style.letterSpacing="normal";try{t.font=t.font,e.fillTextRect(t,c.content,o.left,o.top,o.width,o.height,{offset:n+1,padding:{left:r,right:s,top:i,bottom:l}})}finally{t.canvas.style.letterSpacing=""}}}canBreak(){return!1}toString(){return""}}class bi extends wi{_src;_width;_height;_imageLeft;_imageTop;_imageWidth;_imageHeight;_onloaded;_inlineImgPromise=null;_inlineImg=null;constructor({src:t,width:e,height:o,imageLeft:n,imageTop:r,imageWidth:s,imageHeight:i}){super(),this._src=t,this._width=e,this._height=o,this._imageLeft=n,this._imageTop=r,this._imageWidth=s,this._imageHeight=i,this._onloaded=[],x(t)?t.then((t=>{this._src=t,this._loadImage(t)})):this._loadImage(t)}_loadImage(t){const e=this._inlineImgPromise=Ze("InlineImage",50,t);x(e)?e.then((t=>{this._inlineImg=t,this._onloaded.forEach((t=>t()))})):this._inlineImg=e}width(t){return this._width||(this._inlineImg?.width??0)}font(){return null}color(){return null}canDraw(){return!!this._inlineImg}onReady(t){(x(this._src)||x(this._inlineImgPromise))&&this._onloaded.push((()=>t()))}draw({ctx:t,canvashelper:e,rect:o,offset:n,offsetLeft:r,offsetRight:s,offsetTop:i,offsetBottom:l}){const c=this._inlineImg;e.drawInlineImageRect(t,c,this._imageLeft||0,this._imageTop||0,this._imageWidth||c.width,this._imageHeight||c.height,this._width||c.width,this._height||c.height,o.left,o.top,o.width,o.height,{offset:n+1,padding:{left:r,right:s,top:i,bottom:l}})}canBreak(){return!1}toString(){return""}}class xi extends wi{_path;_width;_height;_color;constructor({path:t,width:e,height:o,color:n}){super();const r=pi();this._path=new r(t),this._width=e,this._height=o,this._color=n}width(t){return this._width}font(){return null}color(){return this._color??null}canDraw(){return!0}onReady(t){}draw({ctx:t,rect:e,offset:o,offsetLeft:n,offsetRight:r,offsetTop:s,offsetBottom:i}){o++;const l={left:n,right:r,top:s,bottom:i};t.save();try{t.beginPath(),t.rect(e.left,e.top,e.width,e.height),t.clip();const n=Ue(t,e,this._width,this._height,{offset:o,padding:l});t.translate(n.x,n.y),t.fill(this._path)}finally{t.restore()}}canBreak(){return!1}toString(){return""}}function vi(t){const e="string"==typeof t?t:(new XMLSerializer).serializeToString(t);return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function Ei(t){if("string"==typeof t){return(new DOMParser).parseFromString(t,"image/svg+xml").children[0]}return t}class Ii extends bi{constructor({svg:t,width:e,height:o}){const n=v(t,Ei),r=x(n)?void 0:n.getAttribute("width")??void 0,s=x(n)?void 0:n.getAttribute("height")??void 0,i=null!=r?Number(r):void 0,l=null!=s?Number(s):void 0;super({src:v(t,vi),width:e||i,height:o||l,imageWidth:i,imageHeight:l})}canBreak(){return!1}toString(){return""}}function Li(t,e,o,n,r,s,i,l,{offset:c=2,padding:a}={}){const h={left:r,top:s,width:i,height:l,right:r+i,bottom:s+l};t.save();try{t.beginPath(),t.rect(h.left,h.top,h.width,h.height),t.clip();const r=Ue(t,h,o,n,{offset:c,padding:a});!function(t,e,o,n,r,s){e.save();try{const{width:i,height:l}=t,{ud:c,x:a=0,y:h=0}=t,u=(r=r||i)/i,d=(s=s||l)/(c?-l:l);o=o||0,n=c?(n||0)+-l*d:n||0,e.translate(o,n),e.scale(u,d),0===a&&0===h||e.translate(a,h);const g=pi(),f=t.path2d=t.path2d||new g(t.d);e.fill(f)}finally{e.restore()}}(e,t,r.x,r.y,o,n)}finally{t.restore()}}function Ri(t){return null==t?null:t instanceof wi?t:new wi(t)}function Bi(t,e){const o=[];if(t&&o.push(...t.map((t=>function(t){if(t instanceof wi)return t;if(!t)return null;if(function(t){return!(!t.font||!t.content)}(t))return new yi(t);if(function(t){return!!t.src}(t))return new bi({src:t.src,width:t.width,height:t.width});if(t.svg)return new Ii({svg:t.svg,width:t.width,height:t.width});if(function(t){return!!t.path}(t))return new xi({path:t.path,width:t.width,height:t.width,color:t.color});const e=fi.get();if(t.name&&e[t.name]){const o=e[t.name],n=t.width||Math.max(o.width,o.height);return new mi({draw({ctx:t,rect:e,offset:r,offsetLeft:s,offsetRight:i,offsetTop:l,offsetBottom:c}){Li(t,o,n,n,e.left,e.top,e.width,e.height,{offset:r+1,padding:{left:s,right:i,top:l,bottom:c}})},width:n,height:n,color:t.color})}return new yi(t)}(t))).filter((t=>null!=t))),Array.isArray(e))o.push(...e.map((t=>Ri(t))).filter((t=>null!=t)));else{const t=Ri(e);t&&o.push(t)}return o}const Mi={};function Si(t){return parseInt(t,16)}function Ti(t,e,o,n=1){return{r:t,g:e,b:o,a:n}}function Ai({r:t,g:e,b:o,a:n}){return 0<=t&&t<=255&&0<=e&&e<=255&&0<=o&&o<=255&&0<=n&&n<=1}function ki(t){return Math.ceil(255*t/100)}function Di(t){if(/^#[0-9a-f]{3}$/i.exec(t))return function({1:t,2:e,3:o}){return Ti(Si(t+t),Si(e+e),Si(o+o))}(t);if(/^#[0-9a-f]{6}$/i.exec(t))return function({1:t,2:e,3:o,4:n,5:r,6:s}){return Ti(Si(t+e),Si(o+n),Si(r+s))}(t);let e=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(t);if(e){const t=Ti(Number(e[1]),Number(e[2]),Number(e[3]));if(Ai(t))return t}if(e=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t),e){const t=Ti(Number(e[1]),Number(e[2]),Number(e[3]),Number(e[4]));if(Ai(t))return t}if(e=/^rgb\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*\)$/i.exec(t),e){const t=Ti(ki(Number(e[1])),ki(Number(e[3])),ki(Number(e[5])));if(Ai(t))return t}if(e=/^rgba\(\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d{1,3}(\.\d)?)%\s*,\s*(\d(\.\d)?)\s*\)$/i.exec(t),e){const t=Ti(ki(Number(e[1])),ki(Number(e[3])),ki(Number(e[5])),Number(e[7]));if(Ai(t))return t}return null}function Oi(t){return"string"!=typeof t?Ti(0,0,0,0):(t=t.toLowerCase().trim(),Mi[t]?Mi[t]:Di(t)||(Mi[t]=function(t){const e=document.createElement("div"),{style:o}=e;o.color=t,o.position="fixed",o.height="1px",o.width="1px",o.opacity="0",document.body.appendChild(e);const{color:n}=(document.defaultView||window).getComputedStyle(e,"");return document.body.removeChild(e),Di(n||"")}(t)))}const{toBoxArray:Fi}=A,Pi=Ri("…");function Ni(t,e,o,n,r){return b(t,{col:e,row:o,grid:n,context:r})}function Wi(t,e,o,n,r){if(null!=t)return b(t,{col:e,row:o,grid:n,context:r})}function zi(t,...e){const o=y(t.theme,...e);if(null==o)return y(Sr(),...e);if("function"!=typeof o)return o;let n;return t=>{const r=o(t);return null!=r?r:(n=n||y(Sr(),...e),b(n,t))}}function Hi(t,e,o,n,r,i,l,c,a){function h(e,h,u){if(e.canDraw()){t.save();try{t.fillStyle=Ni(e.color()||t.fillStyle,l,c,a,t),t.font=e.font()||t.font,e.draw({ctx:t,canvashelper:s,rect:o,offset:n,offsetLeft:h,offsetRight:u,offsetTop:r,offsetBottom:i})}finally{t.restore()}}else e.onReady((()=>a.invalidateCell(l,c)))}if(1===e.length){h(e[0],0,0)}else{const o=e.map((e=>(e.width({ctx:t})||0)-0));let n=o.reduce(((t,e)=>t+e)),r=0;e.forEach(((t,e)=>{const s=o[e];n-=s,h(t,r,n),r+=s}))}}function $i(t,e){return Bi(t,e||"")}function ji(t){return function(t){return Bi(void 0,t).join("")}(t)}function Vi(t){return Ui(t)&&"ellipsis"!==t&&1===(t=t.trim()).length?Ri(t[0]):Pi}function Ui(t){return Boolean(t&&"clip"!==t&&"string"==typeof t)}function Gi(t,e,o){const n=o-3;let r=0;for(let o=0;o<e.length;o++){const s=(e[o].width({ctx:t})||0)-0;if(r+s>n)return{index:o,lineWidth:r,remWidth:n-r};r+=s}return null}function Ki(t,e,o){const n=Gi(t,e,o);if(!n)return{beforeInlines:e,overflow:!1,afterInlines:[]};const{index:r,remWidth:s}=n,i=e[r],l=e.slice(0,r),c=[];if(i.canBreak()){let{before:o,after:n}=i.breakWord(t,s);o||l.length||({before:o,after:n}=i.breakAll(t,s)),o||l.length||({before:o,after:n}=i.splitIndex(1)),o&&l.push(o),n&&c.push(n),c.push(...e.slice(r+1))}else l.length||l.push(i),c.push(...e.slice(l.length));return{beforeInlines:l,overflow:!0,afterInlines:c}}function Yi(t,e,o,n){const r=Gi(t,e,o);if(!r)return{inlines:e,overflow:!1};const{index:s,lineWidth:i}=r,l=e[s],c=Vi(n),a=o-i-c.width({ctx:t}),h=e.slice(0,s);if(l.canBreak()){const{before:e}=l.breakAll(t,a);e&&h.push(e)}return h.push(c),{inlines:h,overflow:!0}}function Zi(t,e,o,n,r,s,{offset:i,color:l,textAlign:c,textBaseline:a,font:h,textOverflow:u,icons:d}){e.fillStyle=Ni(l||e.fillStyle,r,s,t,e),e.textAlign=c,e.textBaseline=a,e.font=h||e.font;let g=$i(d,o);if(Ui(u)&&function(t,e,o){return!!Gi(t,e,o)}(e,g,n.width)){const{inlines:i,overflow:l}=Yi(e,g,n.width,u);g=i,t.setCellOverflowText(r,s,l&&ji(o))}else t.setCellOverflowText(r,s,!1);Hi(e,g,n,i,0,0,r,s,t)}function Xi(t,e,o){const n=Oi(t),r=Oi(e),s=t=>{const e=n[t],s=r[t];if(o>=1)return s;if(o<=0)return e;const i=e-s;return Math.ceil(e-i*o)};return`rgb(${s("r")}, ${s("g")}, ${s("b")})`}function qi(t,e,o,n,r,s,{animElapsedTime:i=1,uncheckBgColor:l=s.theme.checkbox.uncheckBgColor,checkBgColor:c=s.theme.checkbox.checkBgColor,borderColor:a=s.theme.checkbox.borderColor,textAlign:h="center",textBaseline:u="middle"},d={}){const g=ur(t).width;t.textAlign=h,t.textBaseline=u;const f=Ue(t,e,g+1,g+1,d);l=s.getColor(l,o,n,t),c=s.getColor(c,o,n,t),a=s.getColor(a,o,n,t),0<i&&i<1&&(l=r?l:Xi(c,l,i),c=r?Xi(l,c,i):c),gr(t,f.x,f.y,!!r&&i,{uncheckBgColor:l,checkBgColor:c,borderColor:a})}class Qi{_grid;_checkbox=null;_radioButton=null;_button=null;_header=null;_messages=null;constructor(t){this._grid=t}getThemeColor(...t){return zi(this._grid,...t)}get font(){return zi(this._grid,"font")}get underlayBackgroundColor(){return zi(this._grid,"underlayBackgroundColor")}get color(){return zi(this._grid,"color")}get frozenRowsColor(){return zi(this._grid,"frozenRowsColor")}get defaultBgColor(){return zi(this._grid,"defaultBgColor")}get frozenRowsBgColor(){return zi(this._grid,"frozenRowsBgColor")}get selectionBgColor(){return zi(this._grid,"selectionBgColor")}get highlightBgColor(){return zi(this._grid,"highlightBgColor")}get borderColor(){return zi(this._grid,"borderColor")}get frozenRowsBorderColor(){return zi(this._grid,"frozenRowsBorderColor")}get highlightBorderColor(){return zi(this._grid,"highlightBorderColor")}get checkbox(){const t=this._grid;return this._checkbox||(this._checkbox={get uncheckBgColor(){return zi(t,"checkbox","uncheckBgColor")},get checkBgColor(){return zi(t,"checkbox","checkBgColor")},get borderColor(){return zi(t,"checkbox","borderColor")}})}get radioButton(){const t=this._grid;return this._radioButton||(this._radioButton={get checkColor(){return zi(t,"radioButton","checkColor")},get uncheckBorderColor(){return zi(t,"radioButton","uncheckBorderColor")},get checkBorderColor(){return zi(t,"radioButton","checkBorderColor")},get uncheckBgColor(){return zi(t,"radioButton","uncheckBgColor")},get checkBgColor(){return zi(t,"radioButton","checkBgColor")}})}get button(){const t=this._grid;return this._button||(this._button={get color(){return zi(t,"button","color")},get bgColor(){return zi(t,"button","bgColor")}})}get header(){const t=this._grid;return this._header||(this._header={get sortArrowColor(){return zi(t,"header","sortArrowColor")}})}get messages(){const t=this._grid;return this._messages||(this._messages={get infoBgColor(){return zi(t,"messages","infoBgColor")},get errorBgColor(){return zi(t,"messages","errorBgColor")},get warnBgColor(){return zi(t,"messages","warnBgColor")}})}}function Ji(t,e,o,n,r,s){if(Array.isArray(e)){nr(t,Fi(e),o,n,r,s)}else e&&(t.strokeStyle=e,t.strokeRect(o,n,r,s))}class tl{_grid;_theme;constructor(t){this._grid=t,this._theme=new Qi(t)}createCalculator(t,e){return{calcWidth:o=>Go(o,{get full(){return t.getRect().width},get em(){return Ve(t.getContext(),e).width}}),calcHeight:o=>Go(o,{get full(){return t.getRect().height},get em(){return Ve(t.getContext(),e).height}})}}getColor(t,e,o,n){return Ni(t,e,o,this._grid,n)}toBoxArray(t){return Fi(t)}toBoxPixelArray(t,e,o){if("string"==typeof t||Array.isArray(t)){const n=this.createCalculator(e,o),r=Fi(t);return[n.calcHeight(r[0]),n.calcWidth(r[1]),n.calcHeight(r[2]),n.calcWidth(r[3])]}return Fi(t)}get theme(){return this._theme}drawWithClip(t,e){const o=t.getDrawRect();if(!o)return;const n=t.getContext();n.save();try{n.beginPath(),n.rect(o.left,o.top,o.width,o.height),n.clip(),e(n)}finally{n.restore()}}drawBorderWithClip(t,e){const o=t.getDrawRect();if(!o)return;const n=t.getRect(),r=t.getContext();r.save();try{r.beginPath();let t=o.left,s=o.width;o.left===n.left&&(t+=-1,s+=1);let i=o.top,l=o.height;o.top===n.top&&(i+=-1,l+=1),r.rect(t,i,s,l),r.clip(),e(r)}finally{r.restore()}}text(t,e,{padding:o,offset:n=2,color:r,textAlign:s="left",textBaseline:i="middle",font:l,textOverflow:c="clip",icons:a}={}){let h=e.getRect();const{col:u,row:d}=e;if(!r){({color:r}=this.theme);const t=this._grid.isFrozenCell(u,d);t&&t.row&&(r=this.theme.frozenRowsColor)}this.drawWithClip(e,(g=>{if(l=Wi(l,e.col,e.row,this._grid,g),o){const t=this.toBoxPixelArray(o,e,l),n=h.left+t[3],r=h.top+t[0],s=h.width-t[1]-t[3],i=h.height-t[0]-t[2];h=new tn(n,r,s,i)}Zi(this._grid,g,t,h,u,d,{offset:n,color:r,textAlign:s,textBaseline:i,font:l,textOverflow:c,icons:a})}))}multilineText(t,e,{padding:o,offset:n=2,color:r,textAlign:s="left",textBaseline:i="middle",font:l,lineHeight:c="1em",autoWrapText:a=!1,lineClamp:h=0,textOverflow:u="clip",icons:d}={}){let g=e.getRect();const{col:f,row:p}=e;if(!r){({color:r}=this.theme);const t=this._grid.isFrozenCell(f,p);t&&t.row&&(r=this.theme.frozenRowsColor)}this.drawWithClip(e,(C=>{if(l=Wi(l,e.col,e.row,this._grid,C),o){const t=this.toBoxPixelArray(o,e,l),n=g.left+t[3],r=g.top+t[0],s=g.width-t[1]-t[3],i=g.height-t[0]-t[2];g=new tn(n,r,s,i)}const _=this.createCalculator(e,l);c=_.calcHeight(c),function(t,e,o,n,r,s,{offset:i,color:l,textAlign:c,textBaseline:a,font:h,lineHeight:u,autoWrapText:d,lineClamp:g,textOverflow:f,icons:p}){if(e.fillStyle=Ni(l||e.fillStyle,r,s,t,e),e.textAlign=c,e.textBaseline=a,e.font=h||e.font,"auto"===g){const t=n.height-2*i-2;g=Math.max(Math.floor(t/u),1)}let C;if(d||g>0||Ui(f)){const{width:i}=n;C=[];const l=g>0?(n,l)=>{if(C.length+1>=g){if(0===n.length&&l)C.push([Vi(f)]),t.setCellOverflowText(r,s,o.map(ji).join("\n"));else{const{inlines:c,overflow:a}=Yi(e,n,i,f);C.push(l&&!a?c.concat([Vi(f)]):c),(a||l)&&t.setCellOverflowText(r,s,o.map(ji).join("\n"))}return!1}return!0}:()=>!0,c=d?(t,o)=>{if(!l(t,o))return!1;for(;t.length;){if(!l(t,o))return!1;const{beforeInlines:n,afterInlines:r}=Ki(e,t,i);C.push(n),t=r}return!0}:Ui(f)?(n,c)=>{if(!l(n,c))return!1;const{inlines:a,overflow:h}=Yi(e,n,i,f);return C.push(a),h&&t.setCellOverflowText(r,s,o.map(ji).join("\n")),!0}:(t,e)=>!!l(t,e)&&(C.push(t),!0);t.setCellOverflowText(r,s,!1);for(let t=0;t<o.length;t++){const e=o[t];if(!c($i(0===t?p:void 0,e),t+1<o.length))break}}else t.setCellOverflowText(r,s,!1),C=o.map(((t,e)=>$i(0===e?p:void 0,t)));let _=0,w=u*(C.length-1);if("top"===e.textBaseline||"hanging"===e.textBaseline){const t=Ve(e,e.font).height,o=(u-t)/2;_+=o,w-=o}else if("bottom"===e.textBaseline||"alphabetic"===e.textBaseline||"ideographic"===e.textBaseline){const t=Ve(e,e.font).height,o=(u-t)/2;_-=o,w+=o}C.forEach((o=>{Hi(e,o,n,i,_,w,r,s,t),_+=u,w-=u}))}(this._grid,C,t,g,f,p,{offset:n,color:r,textAlign:s,textBaseline:i,font:l,lineHeight:c,autoWrapText:a,lineClamp:h,textOverflow:u,icons:d})}))}fillText(t,e,o,n,{color:r,textAlign:s="left",textBaseline:i="top",font:l}={}){const{col:c,row:a}=n;if(!r){({color:r}=this.theme);const t=this._grid.isFrozenCell(c,a);t&&t.row&&(r=this.theme.frozenRowsColor)}const h=n.getContext();h.save();try{l=Wi(l,n.col,n.row,this._grid,h),h.fillStyle=Ni(r,c,a,this._grid,h),h.textAlign=s,h.textBaseline=i,h.font=l||h.font,h.fillText(t,e,o)}finally{h.restore()}}fillCell(t,{fillColor:e=this.theme.defaultBgColor}={}){const o=t.getRect();this.drawWithClip(t,(n=>{const{col:r,row:s}=t;n.fillStyle=Ni(e,r,s,this._grid,n),n.beginPath(),n.rect(o.left,o.top,o.width,o.height),n.fill()}))}fillCellWithState(t,e={}){e.fillColor=this.getFillColorState(t,e),this.fillCell(t,e)}fillRect(t,e,{fillColor:o=this.theme.defaultBgColor}={}){const n=e.getContext();n.save();try{const{col:r,row:s}=e;n.fillStyle=Ni(o,r,s,this._grid,n),n.beginPath(),n.rect(t.left,t.top,t.width,t.height),n.fill()}finally{n.restore()}}fillRectWithState(t,e,o={}){o.fillColor=this.getFillColorState(e,o),this.fillRect(t,e,o)}getFillColorState(t,e={}){const o=t.getSelection(),{col:n,row:r}=t;if(!E(o.select,t)&&I(o.range,n,r))return this.theme.selectionBgColor;if(e.fillColor)return e.fillColor;if(E(o.select,t))return this.theme.highlightBgColor;const s=this._grid.isFrozenCell(n,r);return s&&s.row?this.theme.frozenRowsBgColor:this.theme.defaultBgColor}border(t,{borderColor:e=this.theme.borderColor,lineWidth:o=1}={}){const n=t.getRect();this.drawBorderWithClip(t,(r=>{const{col:s,row:i}=t,l=Ni(e,s,i,this._grid,r);if(1===o)r.lineWidth=1,Ji(r,l,n.left-.5,n.top-.5,n.width,n.height);else if(2===o)r.lineWidth=2,Ji(r,l,n.left,n.top,n.width-1,n.height-1);else{r.lineWidth=o;const t=o/2-1;Ji(r,l,n.left+t,n.top+t,n.width-o+1,n.height-o+1)}}))}borderWithState(t,e={}){const o=t.getRect(),n=t.getSelection(),{col:r,row:s}=t;if(E(n.select,t))e.borderColor=this.theme.highlightBorderColor,e.lineWidth=2,this.border(t,e);else{this._grid.isFrozenCell(r,s)?.row&&(e.borderColor=this.theme.frozenRowsBorderColor),e.lineWidth=1,this.border(t,e);const n=this._grid.selection.select;n.col+1===r&&n.row===s?this.drawBorderWithClip(t,(t=>{const e=Fi(Ni(this.theme.highlightBorderColor,n.col,n.row,this._grid,t));t.lineWidth=1,t.strokeStyle=e[1]||t.strokeStyle,t.beginPath(),t.moveTo(o.left-.5,o.top),t.lineTo(o.left-.5,o.bottom),t.stroke()})):n.col===r&&n.row+1===s&&this.drawBorderWithClip(t,(t=>{const e=Fi(Ni(this.theme.highlightBorderColor,n.col,n.row,this._grid,t));t.lineWidth=1,t.strokeStyle=e[0]||t.strokeStyle,t.beginPath(),t.moveTo(o.left,o.top-.5),t.lineTo(o.right,o.top-.5),t.stroke()}))}}buildCheckBoxInline(t,e,o={}){const n=this,r=ur(e.getContext()).width;return new mi({draw:function({ctx:r,rect:s,offset:i,offsetLeft:l,offsetRight:c,offsetTop:a,offsetBottom:h}){const{col:u,row:d}=e;qi(r,s,u,d,t,n,o,{offset:i+1,padding:{left:l+1,right:c,top:a,bottom:h}})},width:r+3,height:r+1,color:void 0})}checkbox(t,e,o={}){this.drawWithClip(e,(n=>{const{col:r,row:s}=e;qi(n,e.getRect(),r,s,t,this,o)}))}radioButton(t,e,o={}){this.drawWithClip(e,(n=>{const{col:r,row:s}=e;!function(t,e,o,n,r,s,{animElapsedTime:i=1,checkColor:l=s.theme.radioButton.checkColor,uncheckBorderColor:c=s.theme.radioButton.uncheckBorderColor,checkBorderColor:a=s.theme.radioButton.checkBorderColor,uncheckBgColor:h=s.theme.radioButton.uncheckBgColor,checkBgColor:u=s.theme.radioButton.checkBgColor,textAlign:d="center",textBaseline:g="middle"},f={}){const p=dr(t).width;t.textAlign=d,t.textBaseline=g;const C=Ue(t,e,p+1,p+1,f);l=s.getColor(l,o,n,t),c=s.getColor(c,o,n,t),a=s.getColor(a,o,n,t),h=s.getColor(h,o,n,t),u=s.getColor(u,o,n,t);let _=r?a:c,w=r?u:h;0<i&&i<1&&(_=r?Xi(c,a,i):Xi(a,c,i),w=r?Xi(h,u,i):Xi(u,h,i)),fr(t,C.x,C.y,r?i:1-i,{checkColor:l,borderColor:_,bgColor:w})}(n,e.getRect(),r,s,t,this,o)}))}button(t,e,{bgColor:o=this.theme.button.bgColor,padding:n,offset:r=2,color:s=this.theme.button.color,textAlign:i="center",textBaseline:l="middle",shadow:c,font:a,textOverflow:h="clip",icons:u}={}){const d=e.getRect();this.drawWithClip(e,(g=>{a=Wi(a,e.col,e.row,this._grid,g);const{col:f,row:p}=e,C=this.toBoxPixelArray(n||d.height/8,e,a),_=d.left+C[3],w=d.top+C[0],m=d.width-C[1]-C[3],y=d.height-C[0]-C[2];pr(g,_,w,m,y,{bgColor:o=Ni(o,e.col,e.row,this._grid,g),radius:d.height/8,shadow:c}),Zi(this._grid,g,t,new tn(_,w,m,y),f,p,{offset:r,color:s,textAlign:i,textBaseline:l,font:a,textOverflow:h,icons:u})}))}testFontLoad(t,e,o){return function(t,e,o,n){return!(t&&!si(t,e)&&(ri(t,e,(()=>function(t,e){const{col:o,row:n}=t;e.invalidateCell(o,n)}(o,n))),1))}(t,e,o,this._grid)}}const el="cheetah-grid__tooltip-element",ol=`${el}__content`,nl=`${el}--hidden`,rl=`${el}--shown`;class sl{_handler;_rootElement;_messageElement;constructor(){this._handler=new at;const t=this._rootElement=function(){const t=ht("div",{classList:[el,nl]}),e=ht("pre",{classList:[ol]});return t.appendChild(e),t}();this._messageElement=t.querySelector(`.${ol}`)}dispose(){this.detach();const t=this._rootElement;t.parentElement&&t.parentElement.removeChild(t),this._handler.dispose(),delete this._rootElement,delete this._messageElement}attach(t,e,o,n){const r=this._rootElement,s=this._messageElement;r.classList.remove(rl),r.classList.add(nl),this._attachCell(t,e,o)?(r.classList.add(rl),r.classList.remove(nl),s.textContent=n):this._detach()}move(t,e,o){const n=this._rootElement;this._attachCell(t,e,o)?(n.classList.add(rl),n.classList.remove(nl)):this._detach()}detach(){this._detach()}_detach(){const t=this._rootElement;t.parentElement&&(t.classList.remove(rl),t.classList.add(nl))}_attachCell(t,e,o){const n=this._rootElement,{element:r,rect:s}=t.getAttachCellsArea(t.getCellRange(e,o)),{bottom:i,left:l,width:c}=s,{frozenRowCount:a,frozenColCount:h}=t;if(o>=a&&a>0){const{rect:o}=t.getAttachCellsArea(t.getCellRange(e,a-1));if(i<o.bottom)return!1}else if(i<0)return!1;if(e>=h&&h>0){const{rect:e}=t.getAttachCellsArea(t.getCellRange(h-1,o));if(l<e.right)return!1}else if(l<0)return!1;const{offsetHeight:u,offsetWidth:d}=r;return!(u<i)&&(!(d<l)&&(n.style.top=`${i.toFixed()}px`,n.style.left=`${(l+c/2).toFixed()}px`,n.style.minWidth=`${c.toFixed()}px`,n.parentElement!==r&&r.appendChild(n),!0))}}class il extends class{_grid;_tooltipElement;constructor(t){this._grid=t}dispose(){this.detachTooltipElement(),this._tooltipElement&&this._tooltipElement.dispose(),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement?this._tooltipElement:this._tooltipElement=this.createTooltipElementInternal()}attachTooltipElement(t,e,o){this._getTooltipElement().attach(this._grid,t,e,o)}moveTooltipElement(t,e){this._getTooltipElement().move(this._grid,t,e)}detachTooltipElement(){this._getTooltipElement()._detach()}}{createTooltipElementInternal(){return new sl}}const ll={"overflow-text":t=>new il(t)};class cl{_grid;_tooltipInstances;_attachInfo;constructor(t){this._grid=t,this._tooltipInstances={},this._bindGridEvent(t)}dispose(){const t=this._tooltipInstances;for(const e in t)t[e].dispose();delete this._tooltipInstances,this._attachInfo=null}_attach(t,e){const o=this._attachInfo,n=this._getTooltipInstanceInfo(t,e);if(!o||n&&o.instance===n.instance||(o.instance.detachTooltipElement(),this._attachInfo=null),!n)return;const{instance:r}=n;r.attachTooltipElement(t,e,n.content);const s=this._grid.getCellRange(t,e);this._attachInfo={range:s,instance:r}}_move(t,e){const o=this._attachInfo;if(!o||!I(o.range,t,e))return;const{instance:n}=o;n.moveTooltipElement(t,e)}_detach(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e.detachTooltipElement(),this._attachInfo=null}_isAttachCell(t,e){const o=this._attachInfo;return!!o&&I(o.range,t,e)}_bindGridEvent(t){t.listen(Hs.MOUSEOVER_CELL,(t=>{t.related&&this._isAttachCell(t.col,t.row)||this._attach(t.col,t.row)})),t.listen(Hs.MOUSEOUT_CELL,(t=>{t.related&&this._isAttachCell(t.related.col,t.related.row)||this._detach()})),t.listen(Hs.SELECTED_CELL,(t=>{this._isAttachCell(t.col,t.row)&&this._detach()})),t.listen(Hs.SCROLL,(()=>{const t=this._attachInfo;t&&this._move(t.range.start.col,t.range.start.row)})),t.listen(Hs.CHANGED_VALUE,(t=>{this._isAttachCell(t.col,t.row)&&(this._detach(),this._attach(t.col,t.row))}))}_getTooltipInstanceInfo(t,e){const o=this._grid,n=this._tooltipInstances,r=function(t,e,o){const n=t.getCellOverflowText(e,o);return n?{type:"overflow-text",content:n}:null}(o,t,e);if(!r)return null;const{type:s}=r;return{instance:n[s]||(n[s]=ll[s](o)),type:s,content:r.content}}}const al=G();function hl(t,e,o){return t[al].layoutMap.getCellRange(e,o)}function ul(t,e,o,n){n.setRectFilter((n=>{let{left:r,right:s,top:i,bottom:l}=n;const{start:{col:c,row:a},end:{col:h,row:u}}=hl(t,e,o);for(let o=e-1;o>=c;o--)r-=t.getColWidth(o);for(let o=e+1;o<=h;o++)s+=t.getColWidth(o);for(let e=o-1;e>=a;e--)i-=t.getRowHeight(e);for(let e=o+1;e<=u;e++)l+=t.getRowHeight(e);return tn.bounds(r,i,s,l)}))}function dl(t,e,o){if(o<t[al].layoutMap.headerRowCount){const{caption:n}=t[al].layoutMap.getHeader(e,o);return"function"==typeof n?n():n}{const{field:n}=t[al].layoutMap.getBody(e,o);return pl(t,n,o)}}function gl(t,e,o){if(o<t[al].layoutMap.headerRowCount)return null;{const{message:n}=t[al].layoutMap.getBody(e,o);if(!n)return null;if(!Array.isArray(n))return pl(t,n,o);const r=[];for(let e=0;e<n.length;e++){const s=pl(t,n[e],o);if(x(s))r.push(s);else if(Zs(s))return s}return r.length?new Promise(((t,e)=>{r.forEach((o=>{o.then((e=>{Zs(e)&&t(e)}),e)}))})):null}}function fl(t,e,o){if(Array.isArray(e))return e.map((e=>fl(t,e,o)));if(!M.isObject(e)||"function"==typeof e)return pl(t,e,o);const n={},r=e;return ke.forEach((e=>{if(r[e]){const s=pl(t,r[e],o);null!=s?n[e]=s:function(t,e,o){if(null==e)return!1;if(o<t[al].layoutMap.headerRowCount)return!1;{const n=xl(t,o);return t[al].dataSource.hasField(n,e)}}(t,r[e],o)||(n[e]=r[e])}})),n}function pl(t,e,o){if(null==e)return null;if(o<t[al].layoutMap.headerRowCount)return null;{const n=xl(t,o);return t[al].dataSource.getField(n,e)}}function Cl(t,e,o,{col:n,row:r},s,i){const l=t[al].gridCanvasHelper,c=({bgColor:t}={})=>{const e={fillColor:t};l.fillCellWithState(o,e)},a=()=>{if(o.col===t.frozenColCount-1){const e=o.getRect();l.drawWithClip(o,(n=>{const r=o.row>=t.frozenRowCount?l.theme.borderColor:l.theme.frozenRowsBorderColor,s=l.toBoxArray(l.getColor(r,o.col,o.row,n));s[1]&&(n.lineWidth=1,n.strokeStyle=s[1],n.beginPath(),n.moveTo(e.right-2.5,e.top),n.lineTo(e.right-2.5,e.bottom),n.stroke())}))}!function(t,e,o){const{col:n,row:r}=o,s=t.selection.select,{layoutMap:i}=t[al],l=o.getRect(),c={},a=i.getRecordIndexByRow(s.row),h=i.getCellId(s.col,s.row);function u(t,e){return t===s.col&&e===s.row||null!=h&&i.getCellId(t,e)===h&&i.getRecordIndexByRow(e)===a}if(u(n,r))c.borderColor=e.theme.highlightBorderColor,c.lineWidth=2,e.border(o,c);else{c.lineWidth=1;t.isFrozenCell(n,r)?.row&&(c.borderColor=e.theme.frozenRowsBorderColor),e.border(o,c),n>0&&u(n-1,r)?e.drawBorderWithClip(o,(t=>{const o=e.toBoxArray(e.getColor(e.theme.highlightBorderColor,s.col,s.row,t));o[1]&&(t.lineWidth=1,t.strokeStyle=o[1],t.beginPath(),t.moveTo(l.left-.5,l.top),t.lineTo(l.left-.5,l.bottom),t.stroke())})):r>0&&u(n,r-1)&&e.drawBorderWithClip(o,(t=>{const o=e.toBoxArray(e.getColor(e.theme.highlightBorderColor,s.col,s.row,t));o[0]&&(t.lineWidth=1,t.strokeStyle=o[0],t.beginPath(),t.moveTo(l.left,l.top-.5),t.lineTo(l.right,l.top-.5),t.stroke())}))}}(t,l,o)},h={getRecord:()=>t.getRowRecord(r),getIcon:()=>function(t,e,o){const{icon:n}=t[al].layoutMap.getBody(e,o);return null==n?null:fl(t,n,o)}(t,n,r),getMessage:()=>gl(t,n,r),messageHandler:t[al].messageHandler,style:s,drawCellBase:({bgColor:t}={})=>{c({bgColor:t}),a()},drawCellBg:c,drawCellBorder:a};return i(e,h,o,t)}function _l(t){const e=t[al];e.headerEvents&&e.headerEvents.forEach((e=>t.unlisten(e)));const o=t[al].headerEvents=[];let n;o.forEach((e=>t.unlisten(e))),n=e.layout&&(!Array.isArray(e.layout)||e.layout.length>0)?e.layoutMap=new Bs(e.layout):e.layoutMap=new Is(e.header??[]),n.headerObjects.forEach((e=>{const n=e.headerType.bindGridEvent(t,e.id);if(o.push(...n),e.style&&e.style instanceof is){const n=e.style.listen(is.EVENT_TYPE.CHANGE_STYLE,(()=>{t.invalidate()}));o.push(n)}if(e.action){const n=e.action.bindGridEvent(t,e.id);o.push(...n)}})),n.columnObjects.forEach((e=>{if(e.action){const n=e.action.bindGridEvent(t,e.id);o.push(...n)}if(e.columnType){const n=e.columnType.bindGridEvent(t,e.id);o.push(...n)}if(e.style&&e.style instanceof Xt){const n=e.style.listen(Xt.EVENT_TYPE.CHANGE_STYLE,(()=>{t.invalidate()}));o.push(n)}}));for(let e=0;e<n.columnWidths.length;e++){const o=n.columnWidths[e],{width:r,minWidth:s,maxWidth:i}=o;r&&(r>0||"string"==typeof r)&&t.setColWidth(e,r),s&&(s>0||"string"==typeof s)&&t.setMinColWidth(e,s),i&&(i>0||"string"==typeof i)&&t.setMaxColWidth(e,i)}const{headerRowHeight:r}=t[al];for(let e=0;e<n.headerRowCount;e++){const o=Array.isArray(r)?r[e]:r;o&&o>0&&t.setRowHeight(e,o)}t.colCount=n.colCount,wl(t),t.frozenRowCount=n.headerRowCount}function wl(t){const{layoutMap:e}=t[al];t.rowCount=t[al].dataSource.length*e.bodyRowCount+e.headerRowCount}function ml(t,e){const{dataSourceEventIds:o}=t[al];o&&o.forEach((e=>t[al].handler.off(e))),e(t),t[al].dataSourceEventIds=[t[al].handler.on(t[al].dataSource,Hr.EVENT_TYPE.UPDATED_LENGTH,(()=>{wl(t),t.invalidate()})),t[al].handler.on(t[al].dataSource,Hr.EVENT_TYPE.UPDATED_ORDER,(()=>{t.invalidate()}))]}function yl(t,e=[]){ml(t,(()=>{t[al].records=e;const o=t[al].dataSource=$r.ofArray(e);t.addDisposable(o)}))}function bl(t,e){ml(t,(()=>{if(e)if(e instanceof Hr)t[al].dataSource=e;else{const o=t[al].dataSource=new $r(e);t.addDisposable(o)}else t[al].dataSource=Hr.EMPTY;t[al].records=null}))}function xl(t,e){const{layoutMap:o}=t[al];return o.getRecordIndexByRow(e)}function vl(t,e=(()=>!0)){const{layoutMap:o}=this[al],n=this.selection.range,{start:r}=this.getCellRange(n.start.col,n.start.row),{end:s}=this.getCellRange(n.end.col,n.end.row),i=nn(t),l=Math.min(Math.max(s.row-r.row+1,i.rowCount),this.rowCount-r.row),c=Math.min(Math.max(s.col-r.col+1,i.colCount),this.colCount-r.col);let a=!1;const h=[];for(let t=0;t<o.bodyRowCount;t++){const e=[];h.push(e);for(let n=0;n<c;n++){const s=o.getBody(r.col+n,t+o.headerRowCount);e[n]=s,!a&&s.action?.editable&&(a=!0)}}if(!a)return;const u=o.getRecordStartRowByRecordIndex(o.getRecordIndexByRow(r.row));let d={},g=r.row-u,f=0;for(let t=0;t<l;t++){let n=0;for(let o=0;o<c;o++){const{action:s,id:l}=h[g][o];if(!d[l]&&s?.editable){d[l]=!0;const c=r.col+o,a=r.row+t,h=i.getCellValue(n,f);v(this.getRowRecord(a),(t=>{v(dl(this,c,a),(o=>{e({grid:this,record:t,col:c,row:a,value:h,oldValue:o})&&s.onPasteCellRangeBox(this,{col:c,row:a},h)}))}))}n++,n>=i.colCount&&(n=0)}g++,g>=o.bodyRowCount&&(g=0,d={}),f++,f>=i.rowCount&&(f=0)}const p={col:r.col+c-1,row:r.row+l-1};this.selection.range={start:r,end:p},this.invalidateCellRange(this.selection.range)}function El(){const{layoutMap:t}=this[al],e=this.selection.range,{start:o}=this.getCellRange(e.start.col,e.start.row),{end:n}=this.getCellRange(e.end.col,e.end.row),r=Math.min(n.row-o.row+1,this.rowCount-o.row),s=Math.min(n.col-o.col+1,this.colCount-o.col);let i=!1;const l=[];for(let e=0;e<t.bodyRowCount;e++){const n=[];l.push(n);for(let r=0;r<s;r++){const s=t.getBody(o.col+r,e+t.headerRowCount);n[r]=s,!i&&s.action?.editable&&(i=!0)}}if(!i)return;const c=t.getRecordStartRowByRecordIndex(t.getRecordIndexByRow(o.row));let a={},h=o.row-c;for(let e=0;e<r;e++){for(let t=0;t<s;t++){const{action:n,id:r}=l[h][t];if(!a[r]&&n?.editable){a[r]=!0;const s=o.col+t,i=o.row+e;v(this.getRowRecord(i),(t=>{v(dl(this,s,i),(t=>{n.onDeleteCellRangeBox(this,{col:s,row:i})}))}))}}h++,h>=t.bodyRowCount&&(h=0,a={})}this.invalidateCellRange(e)}class Il{_dataSource;_curIndex;_data;constructor(t){this._dataSource=t,this._curIndex=-1,this._data=[]}hasNext(){const t=this._curIndex+1;return this._dataSource.length>t}next(){const t=this._curIndex+1,e=this._getIndexData(t);return this._curIndex=t,e}movePrev(){this._curIndex--}_getIndexData(t,e){const o=this._dataSource,n=this._data;if(t<n.length)return n[t];if(o.length<=t)return;const r=this._dataSource.get(t);if(n[t]=r,x(r)&&(r.then((e=>{n[t]=e})),!e))for(let e=1;e<=100;e++)this._getIndexData(t+e,!0);return r}}class Ll{_owner;_dataSourceItr;_filter;_filterdList;_queues;_cancel=!1;constructor(t,e,o){this._owner=t,this._dataSourceItr=new Il(e),this._filter=o,this._filterdList=[],this._queues=[]}get(t){if(this._cancel)return;const e=this._filterdList;if(t<e.length)return e[t];const o=this._queues,n=o[t];return n||(o[t]||this._findIndex(t))}cancel(){this._cancel=!0}_findIndex(t){if(window.Promise){const e=Date.now()+100;let o=0;return this._findIndexWithTimeout(t,(()=>(o++,o>=100&&(o=0,e<Date.now()))))}return this._findIndexWithTimeout(t,(()=>!1))}_findIndexWithTimeout(t,e){const o=this._filterdList,n=this._filter,r=this._dataSourceItr,s=this._queues;for(;r.hasNext();){if(this._cancel)return;const i=r.next();if(x(i)){r.movePrev();const e=i.then((e=>(s[t]=null,this.get(t))));return s[t]=e,e}if(n(i)&&(o.push(i),t<o.length))return o[t];if(e()){const e=new Promise((t=>{setTimeout((()=>{t()}),300)})).then((()=>(s[t]=null,this.get(t))));return s[t]=e,e}}this._owner.length=o.length}}const Rl={DataSource:Hr,CachedDataSource:$r,FilterDataSource:class extends Hr{_dataSource;_handler;_filterData=null;static get EVENT_TYPE(){return Hr.EVENT_TYPE}constructor(t,e){super(t),this._dataSource=t,this.filter=e;const o=this._handler=new at;o.on(t,Hr.EVENT_TYPE.UPDATED_ORDER,(()=>{this.filter=this.filter})),p(Hr.EVENT_TYPE,(e=>{o.on(t,e,((...t)=>this.fireListeners(e,...t)))}))}get filter(){return this._filterData?._filter||null}set filter(t){this._filterData&&this._filterData.cancel(),this._filterData=t?new Ll(this,this._dataSource,t):null,this.length=this._dataSource.length}getOriginal(t){return this._filterData?this._filterData.get(t):super.getOriginal(t)}sort(t,e){return this._dataSource.sort(t,e)}get source(){return this._dataSource.source}get dataSource(){return this._dataSource}dispose(){this._handler.dispose(),super.dispose()}}},Bl={action:{ACTIONS:Xr,BaseAction:jr,SortHeaderAction:Yr,CheckHeaderAction:Kr,of:qr,ofCell:Qr},type:{TYPES:ms,BaseHeader:gs,Header:Cs,SortHeader:ws,CheckHeader:ps,MultilineTextHeader:_s,of:ys,ofCell:bs},style:{BaseStyle:is,Style:cs,SortHeaderStyle:us,CheckHeaderStyle:as,MultilineTextHeaderStyle:hs,of:ds}};function Ml(t,e,o){const n=t[e];return t[e]=o,n}const Sl={theme:function(t,e){return null!=e?Ml(Er,t,e):Er[t]},icon:function(t,e){return null!=e?Ml(ii,t,e):ii[t]},icons:function(t){return function(t,e){for(const o in e)t[o]=e[o]}(ii,t)}},Tl={version:"1.0.1",core:tr,tools:_r,ListGrid:class extends Jn{[al];disabled=!1;readOnly=!1;static get EVENT_TYPE(){return Hs}constructor(t={}){super(function(t,e){const o={};for(const n in t)e.indexOf(n)>=0||Object.defineProperty(o,n,{get:()=>t[n],set(e){t[n]=e},configurable:!0,enumerable:!0});return o}(t,["colCount","rowCount","frozenRowCount"]));const e=this[al];e.header=t.header||[],e.layout=t.layout||[],e.headerRowHeight=t.headerRowHeight||[],t.dataSource?bl(this,t.dataSource):yl(this,t.records),e.allowRangePaste=t.allowRangePaste??!1,_l(this),e.sortState={col:-1,row:-1,order:void 0},e.gridCanvasHelper=new tl(this),e.theme=Mr(t.theme),e.messageHandler=new Xs(this,((t,e)=>gl(this,t,e))),e.tooltipHandler=new cl(this),this.invalidate(),e.handler.on(window,"resize",(()=>{this.updateSize(),this.updateScroll(),this.invalidate()}))}dispose(){const t=this[al];t.messageHandler.dispose(),t.tooltipHandler.dispose(),super.dispose()}get header(){return this[al].header}set header(t){this[al].header=t,_l(this)}get layout(){return this[al].layout}set layout(t){this[al].layout=t,_l(this)}get recordRowCount(){return this[al].layoutMap.bodyRowCount}get records(){return this[al].records||null}set records(t){null!=t&&(yl(this,t),wl(this),this.invalidate())}get dataSource(){return this[al].dataSource}set dataSource(t){bl(this,t),wl(this),this.invalidate()}get theme(){return this[al].theme}set theme(t){this[al].theme=Mr(t),this.invalidate()}get allowRangePaste(){return this[al].allowRangePaste}set allowRangePaste(t){this[al].allowRangePaste=t}get font(){return""}set font(t){}get underlayBackgroundColor(){return"transparent"}set underlayBackgroundColor(t){}get sortState(){return this[al].sortState}set sortState(t){const e=this.sortState;let o;e.col>=0&&e.row>=0&&(o=this.getHeaderField(e.col,e.row));const n=this[al].sortState=null!=t?t:{col:-1,row:-1,order:void 0};let r;n.col>=0&&n.row>=0&&(r=this.getHeaderField(n.col,n.row)),null!=o&&o!==r&&this.setHeaderValue(e.col,e.row,void 0),null!=r&&this.setHeaderValue(n.col,n.row,n.order)}get headerValues(){return this[al].headerValues||(this[al].headerValues=new Map)}set headerValues(t){this[al].headerValues=t||new Map}getField(t,e){return this[al].layoutMap.getBody(t,e??this[al].layoutMap.headerRowCount).field}getColumnDefine(t,e){return this[al].layoutMap.getBody(t,e??this[al].layoutMap.headerRowCount).define}getColumnType(t,e){return this[al].layoutMap.getBody(t,e).columnType}getHeaderField(t,e){return this[al].layoutMap.getHeader(t,e).field}getHeaderDefine(t,e){return this[al].layoutMap.getHeader(t,e).define}getRowRecord(t){return t<this[al].layoutMap.headerRowCount?void 0:this[al].dataSource.get(xl(this,t))}getRecordIndexByRow(t){return xl(this,t)}getRecordStartRowByRecordIndex(t){return this[al].layoutMap.getRecordStartRowByRecordIndex(t)}getColumnIndexByField(t){return this.getCellRangeByField(t,0)?.start.col??null}getCellRangeByField(t,e){const{layoutMap:o}=this[al],n=o.columnObjects.find((e=>e.field===t));if(n){const t=o.getBodyLayoutRangeById(n.id),r=o.getRecordStartRowByRecordIndex(e);return{start:{col:t.start.col,row:r+t.start.row},end:{col:t.end.col,row:r+t.end.row}}}return null}focusGridCell(t,e){const{start:{col:o,row:n},end:{col:r,row:s}}=this.selection.range,i=this.getCellRangeByField(t,e)?.start;null!=i&&(this.focusCell(i.col,i.row),this.selection.select=i,this.invalidateGridRect(o,n,r,s),this.invalidateCell(i.col,i.row))}makeVisibleGridCell(t,e){const o=this.getCellRangeByField(t,e)?.start;this.makeVisibleCell(o?.col??0,o?.row??this[al].layoutMap.headerRowCount)}getGridCanvasHelper(){return this[al].gridCanvasHelper}getCellRange(t,e){return hl(this,t,e)}getHeaderCellRange(t,e){return this.getCellRange(t,e)}getCopyCellValue(t,e,o){const n=hl(this,t,e),r=o?Math.max(o.start.col,n.start.col):n.start.col,s=o?Math.max(o.start.row,n.start.row):n.start.row;if(r!==t||s!==e)return"";const i=dl(this,t,e);if(e<this[al].layoutMap.headerRowCount)return i;return this[al].layoutMap.getBody(t,e).columnType.getCopyCellValue(i,this,{col:t,row:e})??i}onDrawCell(t,e,o){const{layoutMap:n}=this[al];let r,s;if(e<n.headerRowCount){const i=n.getHeader(t,e);r=i.headerType.onDrawCell,({style:s}=i),ul(this,t,e,o)}else{const i=n.getBody(t,e);r=i.columnType.onDrawCell,({style:s}=i),ul(this,t,e,o)}const i=dl(this,t,e);if(!(this.rowCount<=e))return Cl(this,i,o,{col:t,row:e},s,r)}doGetCellValue(t,e,o){if(e<this[al].layoutMap.headerRowCount)return!1;{const n=dl(this,t,e);if(x(n))return!1;o(n)}return!0}doChangeValue(t,e,o){if(e<this[al].layoutMap.headerRowCount)return!1;{const n=this.getRowRecord(e);if(x(n))return!1;const r=dl(this,t,e);if(x(r))return!1;const s=o(r);return void 0!==s&&v(function(t,e,o,n){if(o<t[al].layoutMap.headerRowCount)return!1;{const{field:r}=t[al].layoutMap.getBody(e,o);if(null==r)return!1;const s=xl(t,o);return t[al].dataSource.setField(s,r,n)}}(this,t,e,s),(o=>{if(o){const{field:o}=this[al].layoutMap.getBody(t,e);this.fireListeners(Hs.CHANGED_VALUE,{col:t,row:e,record:n,field:o,value:s,oldValue:r})}return o}))}}doSetPasteValue(t,e){vl.call(this,t,e)}getHeaderValue(t,e){const o=this.getHeaderField(t,e);return this.headerValues.get(o)}setHeaderValue(t,e,o){const n=this.getHeaderField(t,e),r=this.headerValues.get(n);this.headerValues.set(n,o),this.fireListeners(Hs.CHANGED_HEADER_VALUE,{col:t,row:e,field:n,value:o,oldValue:r})}getLayoutCellId(t,e){return this[al].layoutMap.getCellId(t,e)}bindEventsInternal(){const t=this;t.listen(Hs.SELECTED_CELL,(t=>{const e=hl(this,t.col,t.row),{start:{col:o,row:n},end:{col:r,row:s}}=e;o===r&&n===s||this.invalidateCellRange(e)})),t.listen(Hs.PASTE_CELL,(t=>{if(!this[al].allowRangePaste)return;const{start:e,end:o}=this.selection.range;if(!t.multi&&E(e,o))return;const{layoutMap:n}=this[al];e.row<n.headerRowCount||(T.cancel(t.event),vl.call(this,t.normalizeValue))})),t.listen(Hs.DELETE_CELL,(t=>{const{start:e}=this.selection.range,{layoutMap:o}=this[al];e.row<o.headerRowCount||(T.cancel(t.event),El.call(this))}))}getMoveLeftColByKeyDownInternal({col:t,row:e}){const{start:{col:o}}=hl(this,t,e);return t=o,super.getMoveLeftColByKeyDownInternal({col:t,row:e})}getMoveRightColByKeyDownInternal({col:t,row:e}){const{end:{col:o}}=hl(this,t,e);return t=o,super.getMoveRightColByKeyDownInternal({col:t,row:e})}getMoveUpRowByKeyDownInternal({col:t,row:e}){const{start:{row:o}}=hl(this,t,e);return e=o,super.getMoveUpRowByKeyDownInternal({col:t,row:e})}getMoveDownRowByKeyDownInternal({col:t,row:e}){const{end:{row:o}}=hl(this,t,e);return e=o,super.getMoveDownRowByKeyDownInternal({col:t,row:e})}getOffsetInvalidateCells(){return 1}getCopyRangeInternal(t){const{start:e}=this.getCellRange(t.start.col,t.start.row),{end:o}=this.getCellRange(t.end.col,t.end.row);return{start:e,end:o}}fireListeners(t,...e){return super.fireListeners(t,...e)}},columns:Oo,data:Rl,headers:Bl,themes:Ar,GridCanvasHelper:tl,get icons(){return fi.get()},register:Sl},Al=Tl})(),n})()}));
//# sourceMappingURL=index.js.map